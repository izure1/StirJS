!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=82)}([,,,,,,,,,,,,,,,,,function(module,exports){var Prototype={Version:"1.6.0.2",Browser:{IE:!(!window.attachEvent||window.opera),Opera:!!window.opera,WebKit:navigator.userAgent.indexOf("AppleWebKit/")>-1,Gecko:navigator.userAgent.indexOf("Gecko")>-1&&-1==navigator.userAgent.indexOf("KHTML"),MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/)},BrowserFeatures:{XPath:!!document.evaluate,ElementExtensions:!!window.HTMLElement,SpecificElementExtensions:document.createElement("div").__proto__&&document.createElement("div").__proto__!==document.createElement("form").__proto__},ScriptFragment:"<script[^>]*>([\\S\\s]*?)<\/script>",JSONFilter:/^\/\*-secure-([\s\S]*)\*\/\s*$/,emptyFunction:function(){},K:function(t){return t}};Prototype.Browser.MobileSafari&&(Prototype.BrowserFeatures.SpecificElementExtensions=!1);var Class={create:function(){var t=null,e=$A(arguments);function i(){this.initialize.apply(this,arguments)}if(Object.isFunction(e[0])&&(t=e.shift()),Object.extend(i,Class.Methods),i.superclass=t,i.subclasses=[],t){var n=function(){};n.prototype=t.prototype,i.prototype=new n,t.subclasses.push(i)}for(var o=0;o<e.length;o++)i.addMethods(e[o]);return i.prototype.initialize||(i.prototype.initialize=Prototype.emptyFunction),i.prototype.constructor=i,i}};Class.Methods={addMethods:function(t){var e=this.superclass&&this.superclass.prototype,i=Object.keys(t);Object.keys({toString:!0}).length||i.push("toString","valueOf");for(var n=0,o=i.length;n<o;n++){var s=i[n],r=t[s];if(e&&Object.isFunction(r)&&"$super"==r.argumentNames().first()){var a=r;r=Object.extend(function(t){return function(){return e[t].apply(this,arguments)}}(s).wrap(a),{valueOf:function(){return a},toString:function(){return a.toString()}})}this.prototype[s]=r}return this}};var Abstract={};Object.extend=function(t,e){for(var i in e)t[i]=e[i];return t},Object.extend(Object,{inspect:function(t){try{return Object.isUndefined(t)?"undefined":null===t?"null":t.inspect?t.inspect():String(t)}catch(t){if(t instanceof RangeError)return"...";throw t}},toJSON:function(t){switch(typeof t){case"undefined":case"function":case"unknown":return;case"boolean":return t.toString()}if(null===t)return"null";if(t.toJSON)return t.toJSON();if(!Object.isElement(t)){var e=[];for(var i in t){var n=Object.toJSON(t[i]);Object.isUndefined(n)||e.push(i.toJSON()+": "+n)}return"{"+e.join(", ")+"}"}},toQueryString:function(t){return $H(t).toQueryString()},toHTML:function(t){return t&&t.toHTML?t.toHTML():String.interpret(t)},keys:function(t){var e=[];for(var i in t)e.push(i);return e},values:function(t){var e=[];for(var i in t)e.push(t[i]);return e},clone:function(t){return Object.extend({},t)},isElement:function(t){return t&&1==t.nodeType},isArray:function(t){return null!=t&&"object"==typeof t&&"splice"in t&&"join"in t},isHash:function(t){return t instanceof Hash},isFunction:function(t){return"function"==typeof t},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isUndefined:function(t){return void 0===t}}),Object.extend(Function.prototype,{argumentNames:function(){var t=this.toString().match(/^[\s\(]*function[^(]*\((.*?)\)/)[1].split(",").invoke("strip");return 1!=t.length||t[0]?t:[]},bind:function(){if(arguments.length<2&&Object.isUndefined(arguments[0]))return this;var t=this,e=$A(arguments),i=e.shift();return function(){return t.apply(i,e.concat($A(arguments)))}},bindAsEventListener:function(){var t=this,e=$A(arguments),i=e.shift();return function(n){return t.apply(i,[n||window.event].concat(e))}},curry:function(){if(!arguments.length)return this;var t=this,e=$A(arguments);return function(){return t.apply(this,e.concat($A(arguments)))}},delay:function(){var t=this,e=$A(arguments),i=1e3*e.shift();return window.setTimeout(function(){return t.apply(t,e)},i)},wrap:function(t){var e=this;return function(){return t.apply(this,[e.bind(this)].concat($A(arguments)))}},methodize:function(){if(this._methodized)return this._methodized;var t=this;return this._methodized=function(){return t.apply(null,[this].concat($A(arguments)))}}}),Function.prototype.defer=Function.prototype.delay.curry(.01),Date.prototype.toJSON=function(){return'"'+this.getUTCFullYear()+"-"+(this.getUTCMonth()+1).toPaddedString(2)+"-"+this.getUTCDate().toPaddedString(2)+"T"+this.getUTCHours().toPaddedString(2)+":"+this.getUTCMinutes().toPaddedString(2)+":"+this.getUTCSeconds().toPaddedString(2)+'Z"'};var Try={these:function(){for(var t,e=0,i=arguments.length;e<i;e++){var n=arguments[e];try{t=n();break}catch(t){}}return t}};RegExp.prototype.match=RegExp.prototype.test,RegExp.escape=function(t){return String(t).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")};var PeriodicalExecuter=Class.create({initialize:function(t,e){this.callback=t,this.frequency=e,this.currentlyExecuting=!1,this.registerCallback()},registerCallback:function(){this.timer=setInterval(this.onTimerEvent.bind(this),1e3*this.frequency)},execute:function(){this.callback(this)},stop:function(){this.timer&&(clearInterval(this.timer),this.timer=null)},onTimerEvent:function(){if(!this.currentlyExecuting)try{this.currentlyExecuting=!0,this.execute()}finally{this.currentlyExecuting=!1}}});with(Object.extend(String,{interpret:function(t){return null==t?"":String(t)},specialChar:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\\":"\\\\"}}),Object.extend(String.prototype,{gsub:function(t,e){var i,n="",o=this;for(e=arguments.callee.prepareReplacement(e);o.length>0;)(i=o.match(t))?(n+=o.slice(0,i.index),n+=String.interpret(e(i)),o=o.slice(i.index+i[0].length)):(n+=o,o="");return n},sub:function(t,e,i){return e=this.gsub.prepareReplacement(e),i=Object.isUndefined(i)?1:i,this.gsub(t,function(t){return--i<0?t[0]:e(t)})},scan:function(t,e){return this.gsub(t,e),String(this)},truncate:function(t,e){return t=t||30,e=Object.isUndefined(e)?"...":e,this.length>t?this.slice(0,t-e.length)+e:String(this)},strip:function(){return this.replace(/^\s+/,"").replace(/\s+$/,"")},stripTags:function(){return this.replace(/<\/?[^>]+>/gi,"")},stripScripts:function(){return this.replace(new RegExp(Prototype.ScriptFragment,"img"),"")},extractScripts:function(){var t=new RegExp(Prototype.ScriptFragment,"img"),e=new RegExp(Prototype.ScriptFragment,"im");return(this.match(t)||[]).map(function(t){return(t.match(e)||["",""])[1]})},evalScripts:function(){return this.extractScripts().map(function(script){return eval(script)})},escapeHTML:function(){var t=arguments.callee;return t.text.data=this,t.div.innerHTML},unescapeHTML:function(){var t=new Element("div");return t.innerHTML=this.stripTags(),t.childNodes[0]?t.childNodes.length>1?$A(t.childNodes).inject("",function(t,e){return t+e.nodeValue}):t.childNodes[0].nodeValue:""},toQueryParams:function(t){var e=this.strip().match(/([^?#]*)(#.*)?$/);return e?e[1].split(t||"&").inject({},function(t,e){if((e=e.split("="))[0]){var i=decodeURIComponent(e.shift()),n=e.length>1?e.join("="):e[0];void 0!=n&&(n=decodeURIComponent(n)),i in t?(Object.isArray(t[i])||(t[i]=[t[i]]),t[i].push(n)):t[i]=n}return t}):{}},toArray:function(){return this.split("")},succ:function(){return this.slice(0,this.length-1)+String.fromCharCode(this.charCodeAt(this.length-1)+1)},times:function(t){return t<1?"":new Array(t+1).join(this)},camelize:function(){var t=this.split("-"),e=t.length;if(1==e)return t[0];for(var i="-"==this.charAt(0)?t[0].charAt(0).toUpperCase()+t[0].substring(1):t[0],n=1;n<e;n++)i+=t[n].charAt(0).toUpperCase()+t[n].substring(1);return i},capitalize:function(){return this.charAt(0).toUpperCase()+this.substring(1).toLowerCase()},underscore:function(){return this.gsub(/::/,"/").gsub(/([A-Z]+)([A-Z][a-z])/,"#{1}_#{2}").gsub(/([a-z\d])([A-Z])/,"#{1}_#{2}").gsub(/-/,"_").toLowerCase()},dasherize:function(){return this.gsub(/_/,"-")},inspect:function(t){var e=this.gsub(/[\x00-\x1f\\]/,function(t){var e=String.specialChar[t[0]];return e||"\\u00"+t[0].charCodeAt().toPaddedString(2,16)});return t?'"'+e.replace(/"/g,'\\"')+'"':"'"+e.replace(/'/g,"\\'")+"'"},toJSON:function(){return this.inspect(!0)},unfilterJSON:function(t){return this.sub(t||Prototype.JSONFilter,"#{1}")},isJSON:function(){var t=this;return!t.blank()&&(t=this.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,""),/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/.test(t))},evalJSON:function(sanitize){var json=this.unfilterJSON();try{if(!sanitize||json.isJSON())return eval("("+json+")")}catch(t){}throw new SyntaxError("Badly formed JSON string: "+this.inspect())},include:function(t){return this.indexOf(t)>-1},startsWith:function(t){return 0===this.indexOf(t)},endsWith:function(t){var e=this.length-t.length;return e>=0&&this.lastIndexOf(t)===e},empty:function(){return""==this},blank:function(){return/^\s*$/.test(this)},interpolate:function(t,e){return new Template(this,e).evaluate(t)}}),(Prototype.Browser.WebKit||Prototype.Browser.IE)&&Object.extend(String.prototype,{escapeHTML:function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},unescapeHTML:function(){return this.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")}}),String.prototype.gsub.prepareReplacement=function(t){if(Object.isFunction(t))return t;var e=new Template(t);return function(t){return e.evaluate(t)}},String.prototype.parseQuery=String.prototype.toQueryParams,Object.extend(String.prototype.escapeHTML,{div:document.createElement("div"),text:document.createTextNode("")}),String.prototype.escapeHTML)div.appendChild(text);var Template=Class.create({initialize:function(t,e){this.template=t.toString(),this.pattern=e||Template.Pattern},evaluate:function(t){return Object.isFunction(t.toTemplateReplacements)&&(t=t.toTemplateReplacements()),this.template.gsub(this.pattern,function(e){if(null==t)return"";var i=e[1]||"";if("\\"==i)return e[2];var n=t,o=e[3],s=/^([^.[]+|\[((?:.*?[^\\])?)\])(\.|\[|$)/;if(null==(e=s.exec(o)))return i;for(;null!=e;){if(null==(n=n[e[1].startsWith("[")?e[2].gsub("\\\\]","]"):e[1]])||""==e[3])break;o=o.substring("["==e[3]?e[1].length:e[0].length),e=s.exec(o)}return i+String.interpret(n)})}});Template.Pattern=/(^|.|\r|\n)(#\{(.*?)\})/;var $break={},Enumerable={each:function(t,e){var i=0;t=t.bind(e);try{this._each(function(e){t(e,i++)})}catch(t){if(t!=$break)throw t}return this},eachSlice:function(t,e,i){e=e?e.bind(i):Prototype.K;for(var n=-t,o=[],s=this.toArray();(n+=t)<s.length;)o.push(s.slice(n,n+t));return o.collect(e,i)},all:function(t,e){t=t?t.bind(e):Prototype.K;var i=!0;return this.each(function(e,n){if(!(i=i&&!!t(e,n)))throw $break}),i},any:function(t,e){t=t?t.bind(e):Prototype.K;var i=!1;return this.each(function(e,n){if(i=!!t(e,n))throw $break}),i},collect:function(t,e){t=t?t.bind(e):Prototype.K;var i=[];return this.each(function(e,n){i.push(t(e,n))}),i},detect:function(t,e){var i;return t=t.bind(e),this.each(function(e,n){if(t(e,n))throw i=e,$break}),i},findAll:function(t,e){t=t.bind(e);var i=[];return this.each(function(e,n){t(e,n)&&i.push(e)}),i},grep:function(t,e,i){e=e?e.bind(i):Prototype.K;var n=[];return Object.isString(t)&&(t=new RegExp(t)),this.each(function(i,o){t.match(i)&&n.push(e(i,o))}),n},include:function(t){if(Object.isFunction(this.indexOf)&&-1!=this.indexOf(t))return!0;var e=!1;return this.each(function(i){if(i==t)throw e=!0,$break}),e},inGroupsOf:function(t,e){return e=Object.isUndefined(e)?null:e,this.eachSlice(t,function(i){for(;i.length<t;)i.push(e);return i})},inject:function(t,e,i){return e=e.bind(i),this.each(function(i,n){t=e(t,i,n)}),t},invoke:function(t){var e=$A(arguments).slice(1);return this.map(function(i){return i[t].apply(i,e)})},max:function(t,e){var i;return t=t?t.bind(e):Prototype.K,this.each(function(e,n){e=t(e,n),(null==i||e>=i)&&(i=e)}),i},min:function(t,e){var i;return t=t?t.bind(e):Prototype.K,this.each(function(e,n){e=t(e,n),(null==i||e<i)&&(i=e)}),i},partition:function(t,e){t=t?t.bind(e):Prototype.K;var i=[],n=[];return this.each(function(e,o){(t(e,o)?i:n).push(e)}),[i,n]},pluck:function(t){var e=[];return this.each(function(i){e.push(i[t])}),e},reject:function(t,e){t=t.bind(e);var i=[];return this.each(function(e,n){t(e,n)||i.push(e)}),i},sortBy:function(t,e){return t=t.bind(e),this.map(function(e,i){return{value:e,criteria:t(e,i)}}).sort(function(t,e){var i=t.criteria,n=e.criteria;return i<n?-1:i>n?1:0}).pluck("value")},toArray:function(){return this.map()},zip:function(){var t=Prototype.K,e=$A(arguments);Object.isFunction(e.last())&&(t=e.pop());var i=[this].concat(e).map($A);return this.map(function(e,n){return t(i.pluck(n))})},size:function(){return this.toArray().length},inspect:function(){return"#<Enumerable:"+this.toArray().inspect()+">"}};function $A(t){if(!t)return[];if(t.toArray)return t.toArray();for(var e=t.length||0,i=new Array(e);e--;)i[e]=t[e];return i}function $w(t){return Object.isString(t)&&(t=t.strip())?t.split(/\s+/):[]}function $H(t){return new Hash(t)}Object.extend(Enumerable,{map:Enumerable.collect,find:Enumerable.detect,select:Enumerable.findAll,filter:Enumerable.findAll,member:Enumerable.include,entries:Enumerable.toArray,every:Enumerable.all,some:Enumerable.any}),Prototype.Browser.WebKit&&($A=function(t){if(!t)return[];if((!Object.isFunction(t)||"[object NodeList]"!=t)&&t.toArray)return t.toArray();for(var e=t.length||0,i=new Array(e);e--;)i[e]=t[e];return i}),Array.from=$A,Object.extend(Array.prototype,Enumerable),Array.prototype._reverse||(Array.prototype._reverse=Array.prototype.reverse),Object.extend(Array.prototype,{_each:function(t){for(var e=0,i=this.length;e<i;e++)t(this[e])},clear:function(){return this.length=0,this},first:function(){return this[0]},last:function(){return this[this.length-1]},compact:function(){return this.select(function(t){return null!=t})},flatten:function(){return this.inject([],function(t,e){return t.concat(Object.isArray(e)?e.flatten():[e])})},without:function(){var t=$A(arguments);return this.select(function(e){return!t.include(e)})},reverse:function(t){return(!1!==t?this:this.toArray())._reverse()},reduce:function(){return this.length>1?this:this[0]},uniq:function(t){return this.inject([],function(e,i,n){return 0!=n&&(t?e.last()==i:e.include(i))||e.push(i),e})},intersect:function(t){return this.uniq().findAll(function(e){return t.detect(function(t){return e===t})})},clone:function(){return[].concat(this)},size:function(){return this.length},inspect:function(){return"["+this.map(Object.inspect).join(", ")+"]"},toJSON:function(){var t=[];return this.each(function(e){var i=Object.toJSON(e);Object.isUndefined(i)||t.push(i)}),"["+t.join(", ")+"]"}}),Object.isFunction(Array.prototype.forEach)&&(Array.prototype._each=Array.prototype.forEach),Array.prototype.indexOf||(Array.prototype.indexOf=function(t,e){e||(e=0);var i=this.length;for(e<0&&(e=i+e);e<i;e++)if(this[e]===t)return e;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(t,e){e=isNaN(e)?this.length:(e<0?this.length+e:e)+1;var i=this.slice(0,e).reverse().indexOf(t);return i<0?i:e-i-1}),Array.prototype.toArray=Array.prototype.clone,Prototype.Browser.Opera&&(Array.prototype.concat=function(){for(var t=[],e=0,i=this.length;e<i;e++)t.push(this[e]);for(e=0,i=arguments.length;e<i;e++)if(Object.isArray(arguments[e]))for(var n=0,o=arguments[e].length;n<o;n++)t.push(arguments[e][n]);else t.push(arguments[e]);return t}),Object.extend(Number.prototype,{toColorPart:function(){return this.toPaddedString(2,16)},succ:function(){return this+1},times:function(t){return $R(0,this,!0).each(t),this},toPaddedString:function(t,e){var i=this.toString(e||10);return"0".times(t-i.length)+i},toJSON:function(){return isFinite(this)?this.toString():"null"}}),$w("abs round ceil floor").each(function(t){Number.prototype[t]=Math[t].methodize()});var Hash=Class.create(Enumerable,function(){function t(t,e){return Object.isUndefined(e)?t:t+"="+encodeURIComponent(String.interpret(e))}return{initialize:function(t){this._object=Object.isHash(t)?t.toObject():Object.clone(t)},_each:function(t){for(var e in this._object){var i=this._object[e],n=[e,i];n.key=e,n.value=i,t(n)}},set:function(t,e){return this._object[t]=e},get:function(t){return this._object[t]},unset:function(t){var e=this._object[t];return delete this._object[t],e},toObject:function(){return Object.clone(this._object)},keys:function(){return this.pluck("key")},values:function(){return this.pluck("value")},index:function(t){var e=this.detect(function(e){return e.value===t});return e&&e.key},merge:function(t){return this.clone().update(t)},update:function(t){return new Hash(t).inject(this,function(t,e){return t.set(e.key,e.value),t})},toQueryString:function(){return this.map(function(e){var i=encodeURIComponent(e.key),n=e.value;return n&&"object"==typeof n&&Object.isArray(n)?n.map(t.curry(i)).join("&"):t(i,n)}).join("&")},inspect:function(){return"#<Hash:{"+this.map(function(t){return t.map(Object.inspect).join(": ")}).join(", ")+"}>"},toJSON:function(){return Object.toJSON(this.toObject())},clone:function(){return new Hash(this)}}}());Hash.prototype.toTemplateReplacements=Hash.prototype.toObject,Hash.from=$H;var ObjectRange=Class.create(Enumerable,{initialize:function(t,e,i){this.start=t,this.end=e,this.exclusive=i},_each:function(t){for(var e=this.start;this.include(e);)t(e),e=e.succ()},include:function(t){return!(t<this.start)&&(this.exclusive?t<this.end:t<=this.end)}}),$R=function(t,e,i){return new ObjectRange(t,e,i)},Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||!1},activeRequestCount:0},v;function $(t){if(arguments.length>1){for(var e=0,i=[],n=arguments.length;e<n;e++)i.push($(arguments[e]));return i}return Object.isString(t)&&(t=document.getElementById(t)),Element.extend(t)}if(Ajax.Responders={responders:[],_each:function(t){this.responders._each(t)},register:function(t){this.include(t)||this.responders.push(t)},unregister:function(t){this.responders=this.responders.without(t)},dispatch:function(t,e,i,n){this.each(function(o){if(Object.isFunction(o[t]))try{o[t].apply(o,[e,i,n])}catch(t){}})}},Object.extend(Ajax.Responders,Enumerable),Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}}),Ajax.Base=Class.create({initialize:function(t){this.options={method:"post",asynchronous:!0,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:!0,evalJS:!0},Object.extend(this.options,t||{}),this.options.method=this.options.method.toLowerCase(),Object.isString(this.options.parameters)?this.options.parameters=this.options.parameters.toQueryParams():Object.isHash(this.options.parameters)&&(this.options.parameters=this.options.parameters.toObject())}}),Ajax.Request=Class.create(Ajax.Base,{_complete:!1,initialize:function(t,e,i){t(i),this.transport=Ajax.getTransport(),this.request(e)},request:function(t){this.url=t,this.method=this.options.method;var e=Object.clone(this.options.parameters);["get","post"].include(this.method)||(e._method=this.method,this.method="post"),this.parameters=e,(e=Object.toQueryString(e))&&("get"==this.method?this.url+=(this.url.include("?")?"&":"?")+e:/Konqueror|Safari|KHTML/.test(navigator.userAgent)&&(e+="&_="));try{var i=new Ajax.Response(this);this.options.onCreate&&this.options.onCreate(i),Ajax.Responders.dispatch("onCreate",this,i),this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous),this.options.asynchronous&&this.respondToReadyState.bind(this).defer(1),this.transport.onreadystatechange=this.onStateChange.bind(this),this.setRequestHeaders(),this.body="post"==this.method?this.options.postBody||e:null,this.transport.send(this.body),!this.options.asynchronous&&this.transport.overrideMimeType&&this.onStateChange()}catch(t){this.dispatchException(t)}},onStateChange:function(){var t=this.transport.readyState;t>1&&(4!=t||!this._complete)&&this.respondToReadyState(this.transport.readyState)},setRequestHeaders:function(){var t={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if("post"==this.method&&(t["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:""),this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005&&(t.Connection="close")),"object"==typeof this.options.requestHeaders){var e=this.options.requestHeaders;if(Object.isFunction(e.push))for(var i=0,n=e.length;i<n;i+=2)t[e[i]]=e[i+1];else $H(e).each(function(e){t[e.key]=e.value})}for(var o in t)this.transport.setRequestHeader(o,t[o])},success:function(){var t=this.getStatus();return!t||t>=200&&t<300},getStatus:function(){try{return this.transport.status||0}catch(t){return 0}},respondToReadyState:function(t){var e=Ajax.Request.Events[t],i=new Ajax.Response(this);if("Complete"==e){try{this._complete=!0,(this.options["on"+i.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(i,i.headerJSON)}catch(t){this.dispatchException(t)}var n=i.getHeader("Content-type");("force"==this.options.evalJS||this.options.evalJS&&this.isSameOrigin()&&n&&n.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))&&this.evalResponse()}try{(this.options["on"+e]||Prototype.emptyFunction)(i,i.headerJSON),Ajax.Responders.dispatch("on"+e,this,i,i.headerJSON)}catch(t){this.dispatchException(t)}"Complete"==e&&(this.transport.onreadystatechange=Prototype.emptyFunction)},isSameOrigin:function(){var t=this.url.match(/^\s*https?:\/\/[^\/]*/);return!t||t[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""})},getHeader:function(t){try{return this.transport.getResponseHeader(t)||null}catch(t){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(t){this.dispatchException(t)}},dispatchException:function(t){(this.options.onException||Prototype.emptyFunction)(this,t),Ajax.Responders.dispatch("onException",this,t)}}),Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"],Ajax.Response=Class.create({initialize:function(t){this.request=t;var e=this.transport=t.transport,i=this.readyState=e.readyState;if((i>2&&!Prototype.Browser.IE||4==i)&&(this.status=this.getStatus(),this.statusText=this.getStatusText(),this.responseText=String.interpret(e.responseText),this.headerJSON=this._getHeaderJSON()),4==i){var n=e.responseXML;this.responseXML=Object.isUndefined(n)?null:n,this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(t){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(t){return null}},getResponseHeader:function(t){return this.transport.getResponseHeader(t)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var t=this.getHeader("X-JSON");if(!t)return null;t=decodeURIComponent(escape(t));try{return t.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(t){this.request.dispatchException(t)}},_getResponseJSON:function(){var t=this.request.options;if(!t.evalJSON||"force"!=t.evalJSON&&!(this.getHeader("Content-type")||"").include("application/json")||this.responseText.blank())return null;try{return this.responseText.evalJSON(t.sanitizeJSON||!this.request.isSameOrigin())}catch(t){this.request.dispatchException(t)}}}),Ajax.Updater=Class.create(Ajax.Request,{initialize:function(t,e,i,n){this.container={success:e.success||e,failure:e.failure||(e.success?null:e)};var o=(n=Object.clone(n)).onComplete;n.onComplete=function(t,e){this.updateContent(t.responseText),Object.isFunction(o)&&o(t,e)}.bind(this),t(i,n)},updateContent:function(t){var e=this.container[this.success()?"success":"failure"],i=this.options;if(i.evalScripts||(t=t.stripScripts()),e=$(e))if(i.insertion)if(Object.isString(i.insertion)){var n={};n[i.insertion]=t,e.insert(n)}else i.insertion(e,t);else e.update(t)}}),Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function(t,e,i,n){t(n),this.onComplete=this.options.onComplete,this.frequency=this.options.frequency||2,this.decay=this.options.decay||1,this.updater={},this.container=e,this.url=i,this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this),this.onTimerEvent()},stop:function(){this.updater.options.onComplete=void 0,clearTimeout(this.timer),(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(t){this.options.decay&&(this.decay=t.responseText==this.lastText?this.decay*this.options.decay:1,this.lastText=t.responseText),this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}}),Prototype.BrowserFeatures.XPath&&(document._getElementsByXPath=function(t,e){for(var i=[],n=document.evaluate(t,$(e)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),o=0,s=n.snapshotLength;o<s;o++)i.push(Element.extend(n.snapshotItem(o)));return i}),!window.Node)var Node={};Node.ELEMENT_NODE||Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}),function(){var t=this.Element;this.Element=function(t,e){e=e||{},t=t.toLowerCase();var i=Element.cache;return Prototype.Browser.IE&&e.name?(t="<"+t+' name="'+e.name+'">',delete e.name,Element.writeAttribute(document.createElement(t),e)):(i[t]||(i[t]=Element.extend(document.createElement(t))),Element.writeAttribute(i[t].cloneNode(!1),e))},Object.extend(this.Element,t||{})}.call(window),Element.cache={},Element.Methods={visible:function(t){return"none"!=$(t).style.display},toggle:function(t){return t=$(t),Element[Element.visible(t)?"hide":"show"](t),t},hide:function(t){return $(t).style.display="none",t},show:function(t){return $(t).style.display="",t},remove:function(t){return(t=$(t)).parentNode.removeChild(t),t},update:function(t,e){return t=$(t),e&&e.toElement&&(e=e.toElement()),Object.isElement(e)?t.update().insert(e):(e=Object.toHTML(e),t.innerHTML=e.stripScripts(),e.evalScripts.bind(e).defer(),t)},replace:function(t,e){if(t=$(t),e&&e.toElement)e=e.toElement();else if(!Object.isElement(e)){e=Object.toHTML(e);var i=t.ownerDocument.createRange();i.selectNode(t),e.evalScripts.bind(e).defer(),e=i.createContextualFragment(e.stripScripts())}return t.parentNode.replaceChild(e,t),t},insert:function(t,e){var i,n,o,s;for(var r in t=$(t),(Object.isString(e)||Object.isNumber(e)||Object.isElement(e)||e&&(e.toElement||e.toHTML))&&(e={bottom:e}),e)i=e[r],r=r.toLowerCase(),n=Element._insertionTranslations[r],i&&i.toElement&&(i=i.toElement()),Object.isElement(i)?n(t,i):(i=Object.toHTML(i),o=("before"==r||"after"==r?t.parentNode:t).tagName.toUpperCase(),s=Element._getContentFromAnonymousElement(o,i.stripScripts()),"top"!=r&&"after"!=r||s.reverse(),s.each(n.curry(t)),i.evalScripts.bind(i).defer());return t},wrap:function(t,e,i){return t=$(t),Object.isElement(e)?$(e).writeAttribute(i||{}):e=Object.isString(e)?new Element(e,i):new Element("div",e),t.parentNode&&t.parentNode.replaceChild(e,t),e.appendChild(t),e},inspect:function(t){var e="<"+(t=$(t)).tagName.toLowerCase();return $H({id:"id",className:"class"}).each(function(i){var n=i.first(),o=i.last(),s=(t[n]||"").toString();s&&(e+=" "+o+"="+s.inspect(!0))}),e+">"},recursivelyCollect:function(t,e){t=$(t);for(var i=[];t=t[e];)1==t.nodeType&&i.push(Element.extend(t));return i},ancestors:function(t){return $(t).recursivelyCollect("parentNode")},descendants:function(t){return $(t).select("*")},firstDescendant:function(t){for(t=$(t).firstChild;t&&1!=t.nodeType;)t=t.nextSibling;return $(t)},immediateDescendants:function(t){if(!(t=$(t).firstChild))return[];for(;t&&1!=t.nodeType;)t=t.nextSibling;return t?[t].concat($(t).nextSiblings()):[]},previousSiblings:function(t){return $(t).recursivelyCollect("previousSibling")},nextSiblings:function(t){return $(t).recursivelyCollect("nextSibling")},siblings:function(t){return(t=$(t)).previousSiblings().reverse().concat(t.nextSiblings())},match:function(t,e){return Object.isString(e)&&(e=new Selector(e)),e.match($(t))},up:function(t,e,i){if(t=$(t),1==arguments.length)return $(t.parentNode);var n=t.ancestors();return Object.isNumber(e)?n[e]:Selector.findElement(n,e,i)},down:function(t,e,i){return t=$(t),1==arguments.length?t.firstDescendant():Object.isNumber(e)?t.descendants()[e]:t.select(e)[i||0]},previous:function(t,e,i){if(t=$(t),1==arguments.length)return $(Selector.handlers.previousElementSibling(t));var n=t.previousSiblings();return Object.isNumber(e)?n[e]:Selector.findElement(n,e,i)},next:function(t,e,i){if(t=$(t),1==arguments.length)return $(Selector.handlers.nextElementSibling(t));var n=t.nextSiblings();return Object.isNumber(e)?n[e]:Selector.findElement(n,e,i)},select:function(){var t=$A(arguments),e=$(t.shift());return Selector.findChildElements(e,t)},adjacent:function(){var t=$A(arguments),e=$(t.shift());return Selector.findChildElements(e.parentNode,t).without(e)},identify:function(t){var e=(t=$(t)).readAttribute("id"),i=arguments.callee;if(e)return e;do{e="anonymous_element_"+i.counter++}while($(e));return t.writeAttribute("id",e),e},readAttribute:function(t,e){if(t=$(t),Prototype.Browser.IE){var i=Element._attributeTranslations.read;if(i.values[e])return i.values[e](t,e);if(i.names[e]&&(e=i.names[e]),e.include(":"))return t.attributes&&t.attributes[e]?t.attributes[e].value:null}return t.getAttribute(e)},writeAttribute:function(t,e,i){t=$(t);var n={},o=Element._attributeTranslations.write;for(var s in"object"==typeof e?n=e:n[e]=!!Object.isUndefined(i)||i,n)e=o.names[s]||s,i=n[s],o.values[s]&&(e=o.values[s](t,i)),!1===i||null===i?t.removeAttribute(e):!0===i?t.setAttribute(e,e):t.setAttribute(e,i);return t},getHeight:function(t){return $(t).getDimensions().height},getWidth:function(t){return $(t).getDimensions().width},classNames:function(t){return new Element.ClassNames(t)},hasClassName:function(t,e){if(t=$(t)){var i=t.className;return i.length>0&&(i==e||new RegExp("(^|\\s)"+e+"(\\s|$)").test(i))}},addClassName:function(t,e){if(t=$(t))return t.hasClassName(e)||(t.className+=(t.className?" ":"")+e),t},removeClassName:function(t,e){if(t=$(t))return t.className=t.className.replace(new RegExp("(^|\\s+)"+e+"(\\s+|$)")," ").strip(),t},toggleClassName:function(t,e){if(t=$(t))return t[t.hasClassName(e)?"removeClassName":"addClassName"](e)},cleanWhitespace:function(t){for(var e=(t=$(t)).firstChild;e;){var i=e.nextSibling;3!=e.nodeType||/\S/.test(e.nodeValue)||t.removeChild(e),e=i}return t},empty:function(t){return $(t).innerHTML.blank()},descendantOf:function(t,e){t=$(t);var i=e=$(e);if(t.compareDocumentPosition)return 8==(8&t.compareDocumentPosition(e));if(t.sourceIndex&&!Prototype.Browser.Opera){var n=t.sourceIndex,o=e.sourceIndex,s=e.nextSibling;if(!s)do{e=e.parentNode}while(!(s=e.nextSibling)&&e.parentNode);if(s&&s.sourceIndex)return n>o&&n<s.sourceIndex}for(;t=t.parentNode;)if(t==i)return!0;return!1},scrollTo:function(t){var e=(t=$(t)).cumulativeOffset();return window.scrollTo(e[0],e[1]),t},getStyle:function(t,e){t=$(t),e="float"==e?"cssFloat":e.camelize();var i=t.style[e];if(!i){var n=document.defaultView.getComputedStyle(t,null);i=n?n[e]:null}return"opacity"==e?i?parseFloat(i):1:"auto"==i?null:i},getOpacity:function(t){return $(t).getStyle("opacity")},setStyle:function(t,e){var i=(t=$(t)).style;if(Object.isString(e))return t.style.cssText+=";"+e,e.include("opacity")?t.setOpacity(e.match(/opacity:\s*(\d?\.?\d*)/)[1]):t;for(var n in e)"opacity"==n?t.setOpacity(e[n]):i["float"==n||"cssFloat"==n?Object.isUndefined(i.styleFloat)?"cssFloat":"styleFloat":n]=e[n];return t},setOpacity:function(t,e){return(t=$(t)).style.opacity=1==e||""===e?"":e<1e-5?0:e,t},getDimensions:function(t){var e=$(t=$(t)).getStyle("display");if("none"!=e&&null!=e)return{width:t.offsetWidth,height:t.offsetHeight};var i=t.style,n=i.visibility,o=i.position,s=i.display;i.visibility="hidden",i.position="absolute",i.display="block";var r=t.clientWidth,a=t.clientHeight;return i.display=s,i.position=o,i.visibility=n,{width:r,height:a}},makePositioned:function(t){t=$(t);var e=Element.getStyle(t,"position");return"static"!=e&&e||(t._madePositioned=!0,t.style.position="relative",window.opera&&(t.style.top=0,t.style.left=0)),t},undoPositioned:function(t){return(t=$(t))._madePositioned&&(t._madePositioned=void 0,t.style.position=t.style.top=t.style.left=t.style.bottom=t.style.right=""),t},makeClipping:function(t){return(t=$(t))._overflow?t:(t._overflow=Element.getStyle(t,"overflow")||"auto","hidden"!==t._overflow&&(t.style.overflow="hidden"),t)},undoClipping:function(t){return(t=$(t))._overflow?(t.style.overflow="auto"==t._overflow?"":t._overflow,t._overflow=null,t):t},cumulativeOffset:function(t){var e=0,i=0;do{e+=t.offsetTop||0,i+=t.offsetLeft||0,t=t.offsetParent}while(t);return Element._returnOffset(i,e)},positionedOffset:function(t){var e=0,i=0;do{if(e+=t.offsetTop||0,i+=t.offsetLeft||0,t=t.offsetParent){if("BODY"==t.tagName)break;if("static"!==Element.getStyle(t,"position"))break}}while(t);return Element._returnOffset(i,e)},absolutize:function(t){if("absolute"!=(t=$(t)).getStyle("position")){var e=t.positionedOffset(),i=e[1],n=e[0],o=t.clientWidth,s=t.clientHeight;return t._originalLeft=n-parseFloat(t.style.left||0),t._originalTop=i-parseFloat(t.style.top||0),t._originalWidth=t.style.width,t._originalHeight=t.style.height,t.style.position="absolute",t.style.top=i+"px",t.style.left=n+"px",t.style.width=o+"px",t.style.height=s+"px",t}},relativize:function(t){if("relative"!=(t=$(t)).getStyle("position")){t.style.position="relative";var e=parseFloat(t.style.top||0)-(t._originalTop||0),i=parseFloat(t.style.left||0)-(t._originalLeft||0);return t.style.top=e+"px",t.style.left=i+"px",t.style.height=t._originalHeight,t.style.width=t._originalWidth,t}},cumulativeScrollOffset:function(t){var e=0,i=0;do{e+=t.scrollTop||0,i+=t.scrollLeft||0,t=t.parentNode}while(t);return Element._returnOffset(i,e)},getOffsetParent:function(t){if(t.offsetParent)return $(t.offsetParent);if(t==document.body)return $(t);for(;(t=t.parentNode)&&t!=document.body;)if("static"!=Element.getStyle(t,"position"))return $(t);return $(document.body)},viewportOffset:function(t){var e=0,i=0,n=t;do{if(e+=n.offsetTop||0,i+=n.offsetLeft||0,n.offsetParent==document.body&&"absolute"==Element.getStyle(n,"position"))break}while(n=n.offsetParent);n=t;do{Prototype.Browser.Opera&&"BODY"!=n.tagName||(e-=n.scrollTop||0,i-=n.scrollLeft||0)}while(n=n.parentNode);return Element._returnOffset(i,e)},clonePosition:function(t,e){var i=Object.extend({setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,offsetLeft:0},arguments[2]||{}),n=(e=$(e)).viewportOffset();t=$(t);var o=[0,0],s=null;return"absolute"==Element.getStyle(t,"position")&&(o=(s=t.getOffsetParent()).viewportOffset()),s==document.body&&(o[0]-=document.body.offsetLeft,o[1]-=document.body.offsetTop),i.setLeft&&(t.style.left=n[0]-o[0]+i.offsetLeft+"px"),i.setTop&&(t.style.top=n[1]-o[1]+i.offsetTop+"px"),i.setWidth&&(t.style.width=e.offsetWidth+"px"),i.setHeight&&(t.style.height=e.offsetHeight+"px"),t}},Element.Methods.identify.counter=1,Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants}),Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}},Prototype.Browser.Opera?(Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(t,e,i){switch(i){case"left":case"top":case"right":case"bottom":if("static"===t(e,"position"))return null;case"height":case"width":if(!Element.visible(e))return null;var n=parseInt(t(e,i),10);return n!==e["offset"+i.capitalize()]?n+"px":("height"===i?["border-top-width","padding-top","padding-bottom","border-bottom-width"]:["border-left-width","padding-left","padding-right","border-right-width"]).inject(n,function(i,n){var o=t(e,n);return null===o?i:i-parseInt(o,10)})+"px";default:return t(e,i)}}),Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(t,e,i){return"title"===i?e.title:t(e,i)})):Prototype.Browser.IE?(Element.Methods.getOffsetParent=Element.Methods.getOffsetParent.wrap(function(t,e){var i=(e=$(e)).getStyle("position");if("static"!==i)return t(e);e.setStyle({position:"relative"});var n=t(e);return e.setStyle({position:i}),n}),$w("positionedOffset viewportOffset").each(function(t){Element.Methods[t]=Element.Methods[t].wrap(function(t,e){var i=(e=$(e)).getStyle("position");if("static"!==i)return t(e);var n=e.getOffsetParent();n&&"fixed"===n.getStyle("position")&&n.setStyle({zoom:1}),e.setStyle({position:"relative"});var o=t(e);return e.setStyle({position:i}),o})}),Element.Methods.getStyle=function(t,e){t=$(t),e="float"==e||"cssFloat"==e?"styleFloat":e.camelize();var i=t.style[e];return!i&&t.currentStyle&&(i=t.currentStyle[e]),"opacity"==e?(i=(t.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/))&&i[1]?parseFloat(i[1])/100:1:"auto"==i?"width"!=e&&"height"!=e||"none"==t.getStyle("display")?null:t["offset"+e.capitalize()]+"px":i},Element.Methods.setOpacity=function(t,e){function i(t){return t.replace(/alpha\([^\)]*\)/gi,"")}var n=(t=$(t)).currentStyle;(n&&!n.hasLayout||!n&&"normal"==t.style.zoom)&&(t.style.zoom=1);var o=t.getStyle("filter"),s=t.style;return 1==e||""===e?((o=i(o))?s.filter=o:s.removeAttribute("filter"),t):(e<1e-5&&(e=0),s.filter=i(o)+"alpha(opacity="+100*e+")",t)},Element._attributeTranslations={read:{names:{class:"className",for:"htmlFor"},values:{_getAttr:function(t,e){return t.getAttribute(e,2)},_getAttrNode:function(t,e){var i=t.getAttributeNode(e);return i?i.value:""},_getEv:function(t,e){return(e=t.getAttribute(e))?e.toString().slice(23,-2):null},_flag:function(t,e){return $(t).hasAttribute(e)?e:null},style:function(t){return t.style.cssText.toLowerCase()},title:function(t){return t.title}}}},Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(t,e){t.checked=!!e},style:function(t,e){t.style.cssText=e||""}}},Element._attributeTranslations.has={},$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc").each(function(t){Element._attributeTranslations.write.names[t.toLowerCase()]=t,Element._attributeTranslations.has[t.toLowerCase()]=t}),v=Element._attributeTranslations.read.values,Object.extend(v,{href:v._getAttr,src:v._getAttr,type:v._getAttr,action:v._getAttrNode,disabled:v._flag,checked:v._flag,readonly:v._flag,multiple:v._flag,onload:v._getEv,onunload:v._getEv,onclick:v._getEv,ondblclick:v._getEv,onmousedown:v._getEv,onmouseup:v._getEv,onmouseover:v._getEv,onmousemove:v._getEv,onmouseout:v._getEv,onfocus:v._getEv,onblur:v._getEv,onkeypress:v._getEv,onkeydown:v._getEv,onkeyup:v._getEv,onsubmit:v._getEv,onreset:v._getEv,onselect:v._getEv,onchange:v._getEv})):Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)?Element.Methods.setOpacity=function(t,e){return(t=$(t)).style.opacity=1==e?.999999:""===e?"":e<1e-5?0:e,t}:Prototype.Browser.WebKit&&(Element.Methods.setOpacity=function(t,e){if((t=$(t)).style.opacity=1==e||""===e?"":e<1e-5?0:e,1==e)if("IMG"==t.tagName&&t.width)t.width++,t.width--;else try{var i=document.createTextNode(" ");t.appendChild(i),t.removeChild(i)}catch(t){}return t},Element.Methods.cumulativeOffset=function(t){var e=0,i=0;do{if(e+=t.offsetTop||0,i+=t.offsetLeft||0,t.offsetParent==document.body&&"absolute"==Element.getStyle(t,"position"))break;t=t.offsetParent}while(t);return Element._returnOffset(i,e)}),(Prototype.Browser.IE||Prototype.Browser.Opera)&&(Element.Methods.update=function(t,e){if(t=$(t),e&&e.toElement&&(e=e.toElement()),Object.isElement(e))return t.update().insert(e);e=Object.toHTML(e);var i=t.tagName.toUpperCase();return i in Element._insertionTranslations.tags?($A(t.childNodes).each(function(e){t.removeChild(e)}),Element._getContentFromAnonymousElement(i,e.stripScripts()).each(function(e){t.appendChild(e)})):t.innerHTML=e.stripScripts(),e.evalScripts.bind(e).defer(),t}),"outerHTML"in document.createElement("div")&&(Element.Methods.replace=function(t,e){if(t=$(t),e&&e.toElement&&(e=e.toElement()),Object.isElement(e))return t.parentNode.replaceChild(e,t),t;e=Object.toHTML(e);var i=t.parentNode,n=i.tagName.toUpperCase();if(Element._insertionTranslations.tags[n]){var o=t.next(),s=Element._getContentFromAnonymousElement(n,e.stripScripts());i.removeChild(t),o?s.each(function(t){i.insertBefore(t,o)}):s.each(function(t){i.appendChild(t)})}else t.outerHTML=e.stripScripts();return e.evalScripts.bind(e).defer(),t}),Element._returnOffset=function(t,e){var i=[t,e];return i.left=t,i.top=e,i},Element._getContentFromAnonymousElement=function(t,e){var i=new Element("div"),n=Element._insertionTranslations.tags[t];return n?(i.innerHTML=n[0]+e+n[1],n[2].times(function(){i=i.firstChild})):i.innerHTML=e,$A(i.childNodes)},Element._insertionTranslations={before:function(t,e){t.parentNode.insertBefore(e,t)},top:function(t,e){t.insertBefore(e,t.firstChild)},bottom:function(t,e){t.appendChild(e)},after:function(t,e){t.parentNode.insertBefore(e,t.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}},function(){Object.extend(this.tags,{THEAD:this.tags.TBODY,TFOOT:this.tags.TBODY,TH:this.tags.TD})}.call(Element._insertionTranslations),Element.Methods.Simulated={hasAttribute:function(t,e){e=Element._attributeTranslations.has[e]||e;var i=$(t).getAttributeNode(e);return i&&i.specified}},Element.Methods.ByTag={},Object.extend(Element,Element.Methods),!Prototype.BrowserFeatures.ElementExtensions&&document.createElement("div").__proto__&&(window.HTMLElement={},window.HTMLElement.prototype=document.createElement("div").__proto__,Prototype.BrowserFeatures.ElementExtensions=!0),Element.extend=function(){if(Prototype.BrowserFeatures.SpecificElementExtensions)return Prototype.K;var t={},e=Element.Methods.ByTag,i=Object.extend(function(i){if(!i||i._extendedByPrototype||1!=i.nodeType||i==window)return i;var n,o,s=Object.clone(t),r=i.tagName;for(n in e[r]&&Object.extend(s,e[r]),s)o=s[n],!Object.isFunction(o)||n in i||(i[n]=o.methodize());return i._extendedByPrototype=Prototype.emptyFunction,i},{refresh:function(){Prototype.BrowserFeatures.ElementExtensions||(Object.extend(t,Element.Methods),Object.extend(t,Element.Methods.Simulated))}});return i.refresh(),i}(),Element.hasAttribute=function(t,e){return t.hasAttribute?t.hasAttribute(e):Element.Methods.Simulated.hasAttribute(t,e)},Element.addMethods=function(t){var e=Prototype.BrowserFeatures,i=Element.Methods.ByTag;if(t||(Object.extend(Form,Form.Methods),Object.extend(Form.Element,Form.Element.Methods),Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods)})),2==arguments.length){var n=t;t=arguments[1]}function o(e){e=e.toUpperCase(),Element.Methods.ByTag[e]||(Element.Methods.ByTag[e]={}),Object.extend(Element.Methods.ByTag[e],t)}function s(t,e,i){for(var n in i=i||!1,t){var o=t[n];Object.isFunction(o)&&(i&&n in e||(e[n]=o.methodize()))}}function r(t){var e,i={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};return i[t]&&(e="HTML"+i[t]+"Element"),window[e]?window[e]:(e="HTML"+t+"Element",window[e]?window[e]:(e="HTML"+t.capitalize()+"Element",window[e]?window[e]:(window[e]={},window[e].prototype=document.createElement(t).__proto__,window[e])))}if(n?Object.isArray(n)?n.each(o):o(n):Object.extend(Element.Methods,t||{}),e.ElementExtensions&&(s(Element.Methods,HTMLElement.prototype),s(Element.Methods.Simulated,HTMLElement.prototype,!0)),e.SpecificElementExtensions)for(var a in Element.Methods.ByTag){var l=r(a);Object.isUndefined(l)||s(i[a],l.prototype)}Object.extend(Element,Element.Methods),delete Element.ByTag,Element.extend.refresh&&Element.extend.refresh(),Element.cache={}},document.viewport={getDimensions:function(){var t={},e=Prototype.Browser;return $w("width height").each(function(i){var n=i.capitalize();t[i]=e.WebKit&&!document.evaluate?self["inner"+n]:e.Opera?document.body["client"+n]:document.documentElement["client"+n]}),t},getWidth:function(){return this.getDimensions().width},getHeight:function(){return this.getDimensions().height},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};var Selector=Class.create({initialize:function(t){this.expression=t.strip(),this.compileMatcher()},shouldUseXPath:function(){if(!Prototype.BrowserFeatures.XPath)return!1;var t=this.expression;return(!Prototype.Browser.WebKit||!t.include("-of-type")&&!t.include(":empty"))&&!/(\[[\w-]*?:|:checked)/.test(this.expression)},compileMatcher:function(){if(this.shouldUseXPath())return this.compileXPathMatcher();var e=this.expression,ps=Selector.patterns,h=Selector.handlers,c=Selector.criteria,le,p,m;if(Selector._cache[e])this.matcher=Selector._cache[e];else{for(this.matcher=["this.matcher = function(root) {","var r = root, h = Selector.handlers, c = false, n;"];e&&le!=e&&/\S/.test(e);)for(var i in le=e,ps)if(p=ps[i],m=e.match(p)){this.matcher.push(Object.isFunction(c[i])?c[i](m):new Template(c[i]).evaluate(m)),e=e.replace(m[0],"");break}this.matcher.push("return h.unique(n);\n}"),eval(this.matcher.join("\n")),Selector._cache[this.expression]=this.matcher}},compileXPathMatcher:function(){var t,e,i=this.expression,n=Selector.patterns,o=Selector.xpath;if(Selector._cache[i])this.xpath=Selector._cache[i];else{for(this.matcher=[".//*"];i&&t!=i&&/\S/.test(i);)for(var s in t=i,n)if(e=i.match(n[s])){this.matcher.push(Object.isFunction(o[s])?o[s](e):new Template(o[s]).evaluate(e)),i=i.replace(e[0],"");break}this.xpath=this.matcher.join(""),Selector._cache[this.expression]=this.xpath}},findElements:function(t){return t=t||document,this.xpath?document._getElementsByXPath(this.xpath,t):this.matcher(t)},match:function(t){this.tokens=[];for(var e,i,n,o=this.expression,s=Selector.patterns,r=Selector.assertions;o&&e!==o&&/\S/.test(o);)for(var a in e=o,s)if(i=s[a],n=o.match(i)){if(!r[a])return this.findElements(document).include(t);this.tokens.push([a,Object.clone(n)]),o=o.replace(n[0],"")}var l,m,c,h=!0;for(a=0;c=this.tokens[a];a++)if(l=c[0],m=c[1],!Selector.assertions[l](t,m)){h=!1;break}return h},toString:function(){return this.expression},inspect:function(){return"#<Selector:"+this.expression.inspect()+">"}});function $$(){return Selector.findChildElements(document,$A(arguments))}Object.extend(Selector,{_cache:{},xpath:{descendant:"//*",child:"/*",adjacent:"/following-sibling::*[1]",laterSibling:"/following-sibling::*",tagName:function(t){return"*"==t[1]?"":"[local-name()='"+t[1].toLowerCase()+"' or local-name()='"+t[1].toUpperCase()+"']"},className:"[contains(concat(' ', @class, ' '), ' #{1} ')]",id:"[@id='#{1}']",attrPresence:function(t){return t[1]=t[1].toLowerCase(),new Template("[@#{1}]").evaluate(t)},attr:function(t){return t[1]=t[1].toLowerCase(),t[3]=t[5]||t[6],new Template(Selector.xpath.operators[t[2]]).evaluate(t)},pseudo:function(t){var e=Selector.xpath.pseudos[t[1]];return e?Object.isFunction(e)?e(t):new Template(Selector.xpath.pseudos[t[1]]).evaluate(t):""},operators:{"=":"[@#{1}='#{3}']","!=":"[@#{1}!='#{3}']","^=":"[starts-with(@#{1}, '#{3}')]","$=":"[substring(@#{1}, (string-length(@#{1}) - string-length('#{3}') + 1))='#{3}']","*=":"[contains(@#{1}, '#{3}')]","~=":"[contains(concat(' ', @#{1}, ' '), ' #{3} ')]","|=":"[contains(concat('-', @#{1}, '-'), '-#{3}-')]"},pseudos:{"first-child":"[not(preceding-sibling::*)]","last-child":"[not(following-sibling::*)]","only-child":"[not(preceding-sibling::* or following-sibling::*)]",empty:"[count(*) = 0 and (count(text()) = 0 or translate(text(), ' \t\r\n', '') = '')]",checked:"[@checked]",disabled:"[@disabled]",enabled:"[not(@disabled)]",not:function(t){for(var e,i,n=t[6],o=Selector.patterns,s=Selector.xpath,r=[];n&&e!=n&&/\S/.test(n);)for(var a in e=n,o)if(t=n.match(o[a])){i=Object.isFunction(s[a])?s[a](t):new Template(s[a]).evaluate(t),r.push("("+i.substring(1,i.length-1)+")"),n=n.replace(t[0],"");break}return"[not("+r.join(" and ")+")]"},"nth-child":function(t){return Selector.xpath.pseudos.nth("(count(./preceding-sibling::*) + 1) ",t)},"nth-last-child":function(t){return Selector.xpath.pseudos.nth("(count(./following-sibling::*) + 1) ",t)},"nth-of-type":function(t){return Selector.xpath.pseudos.nth("position() ",t)},"nth-last-of-type":function(t){return Selector.xpath.pseudos.nth("(last() + 1 - position()) ",t)},"first-of-type":function(t){return t[6]="1",Selector.xpath.pseudos["nth-of-type"](t)},"last-of-type":function(t){return t[6]="1",Selector.xpath.pseudos["nth-last-of-type"](t)},"only-of-type":function(t){var e=Selector.xpath.pseudos;return e["first-of-type"](t)+e["last-of-type"](t)},nth:function(t,e){var i,n=e[6];if("even"==n&&(n="2n+0"),"odd"==n&&(n="2n+1"),i=n.match(/^(\d+)$/))return"["+t+"= "+i[1]+"]";if(i=n.match(/^(-?\d*)?n(([+-])(\d+))?/)){"-"==i[1]&&(i[1]=-1);var o=i[1]?Number(i[1]):1,s=i[2]?Number(i[2]):0;return new Template("[((#{fragment} - #{b}) mod #{a} = 0) and ((#{fragment} - #{b}) div #{a} >= 0)]").evaluate({fragment:t,a:o,b:s})}}}},criteria:{tagName:'n = h.tagName(n, r, "#{1}", c);      c = false;',className:'n = h.className(n, r, "#{1}", c);    c = false;',id:'n = h.id(n, r, "#{1}", c);           c = false;',attrPresence:'n = h.attrPresence(n, r, "#{1}", c); c = false;',attr:function(t){return t[3]=t[5]||t[6],new Template('n = h.attr(n, r, "#{1}", "#{3}", "#{2}", c); c = false;').evaluate(t)},pseudo:function(t){return t[6]&&(t[6]=t[6].replace(/"/g,'\\"')),new Template('n = h.pseudo(n, "#{1}", "#{6}", r, c); c = false;').evaluate(t)},descendant:'c = "descendant";',child:'c = "child";',adjacent:'c = "adjacent";',laterSibling:'c = "laterSibling";'},patterns:{laterSibling:/^\s*~\s*/,child:/^\s*>\s*/,adjacent:/^\s*\+\s*/,descendant:/^\s/,tagName:/^\s*(\*|[\w\-]+)(\b|$)?/,id:/^#([\w\-\*]+)(\b|$)/,className:/^\.([\w\-\*]+)(\b|$)/,pseudo:/^:((first|last|nth|nth-last|only)(-child|-of-type)|empty|checked|(en|dis)abled|not)(\((.*?)\))?(\b|$|(?=\s|[:+~>]))/,attrPresence:/^\[([\w]+)\]/,attr:/\[((?:[\w-]*:)?[\w-]+)\s*(?:([!^$*~|]?=)\s*((['"])([^\4]*?)\4|([^'"][^\]]*?)))?\]/},assertions:{tagName:function(t,e){return e[1].toUpperCase()==t.tagName.toUpperCase()},className:function(t,e){return Element.hasClassName(t,e[1])},id:function(t,e){return t.id===e[1]},attrPresence:function(t,e){return Element.hasAttribute(t,e[1])},attr:function(t,e){var i=Element.readAttribute(t,e[1]);return i&&Selector.operators[e[2]](i,e[5]||e[6])}},handlers:{concat:function(t,e){for(var i,n=0;i=e[n];n++)t.push(i);return t},mark:function(t){for(var e,i=Prototype.emptyFunction,n=0;e=t[n];n++)e._countedByPrototype=i;return t},unmark:function(t){for(var e,i=0;e=t[i];i++)e._countedByPrototype=void 0;return t},index:function(t,e,i){if(t._countedByPrototype=Prototype.emptyFunction,e)for(var n=(r=t.childNodes).length-1,o=1;n>=0;n--){var s=r[n];1!=s.nodeType||i&&!s._countedByPrototype||(s.nodeIndex=o++)}else{n=0,o=1;for(var r=t.childNodes;s=r[n];n++)1!=s.nodeType||i&&!s._countedByPrototype||(s.nodeIndex=o++)}},unique:function(t){if(0==t.length)return t;for(var e,i=[],n=0,o=t.length;n<o;n++)(e=t[n])._countedByPrototype||(e._countedByPrototype=Prototype.emptyFunction,i.push(Element.extend(e)));return Selector.handlers.unmark(i)},descendant:function(t){for(var e,i=Selector.handlers,n=0,o=[];e=t[n];n++)i.concat(o,e.getElementsByTagName("*"));return o},child:function(t){Selector.handlers;for(var e,i=0,n=[];e=t[i];i++)for(var o,s=0;o=e.childNodes[s];s++)1==o.nodeType&&"!"!=o.tagName&&n.push(o);return n},adjacent:function(t){for(var e,i=0,n=[];e=t[i];i++){var o=this.nextElementSibling(e);o&&n.push(o)}return n},laterSibling:function(t){for(var e,i=Selector.handlers,n=0,o=[];e=t[n];n++)i.concat(o,Element.nextSiblings(e));return o},nextElementSibling:function(t){for(;t=t.nextSibling;)if(1==t.nodeType)return t;return null},previousElementSibling:function(t){for(;t=t.previousSibling;)if(1==t.nodeType)return t;return null},tagName:function(t,e,i,n){var o=i.toUpperCase(),s=[],r=Selector.handlers;if(t){if(n){if("descendant"==n){for(var a=0;l=t[a];a++)r.concat(s,l.getElementsByTagName(i));return s}if(t=this[n](t),"*"==i)return t}var l;for(a=0;l=t[a];a++)l.tagName.toUpperCase()===o&&s.push(l);return s}return e.getElementsByTagName(i)},id:function(t,e,i,n){var o=$(i),s=Selector.handlers;if(!o)return[];if(!t&&e==document)return[o];if(t){if(n)if("child"==n){for(var r=0;a=t[r];r++)if(o.parentNode==a)return[o]}else if("descendant"==n){for(r=0;a=t[r];r++)if(Element.descendantOf(o,a))return[o]}else if("adjacent"==n){for(r=0;a=t[r];r++)if(Selector.handlers.previousElementSibling(o)==a)return[o]}else t=s[n](t);var a;for(r=0;a=t[r];r++)if(a==o)return[o];return[]}return o&&Element.descendantOf(o,e)?[o]:[]},className:function(t,e,i,n){return t&&n&&(t=this[n](t)),Selector.handlers.byClassName(t,e,i)},byClassName:function(t,e,i){t||(t=Selector.handlers.descendant([e]));for(var n,o,s=" "+i+" ",r=0,a=[];n=t[r];r++)0!=(o=n.className).length&&(o==i||(" "+o+" ").include(s))&&a.push(n);return a},attrPresence:function(t,e,i,n){t||(t=e.getElementsByTagName("*")),t&&n&&(t=this[n](t));for(var o,s=[],r=0;o=t[r];r++)Element.hasAttribute(o,i)&&s.push(o);return s},attr:function(t,e,i,n,o,s){t||(t=e.getElementsByTagName("*")),t&&s&&(t=this[s](t));for(var r,a=Selector.operators[o],l=[],m=0;r=t[m];m++){var c=Element.readAttribute(r,i);null!==c&&(a(c,n)&&l.push(r))}return l},pseudo:function(t,e,i,n,o){return t&&o&&(t=this[o](t)),t||(t=n.getElementsByTagName("*")),Selector.pseudos[e](t,i,n)}},pseudos:{"first-child":function(t,e,i){for(var n,o=0,s=[];n=t[o];o++)Selector.handlers.previousElementSibling(n)||s.push(n);return s},"last-child":function(t,e,i){for(var n,o=0,s=[];n=t[o];o++)Selector.handlers.nextElementSibling(n)||s.push(n);return s},"only-child":function(t,e,i){for(var n,o=Selector.handlers,s=0,r=[];n=t[s];s++)o.previousElementSibling(n)||o.nextElementSibling(n)||r.push(n);return r},"nth-child":function(t,e,i){return Selector.pseudos.nth(t,e,i)},"nth-last-child":function(t,e,i){return Selector.pseudos.nth(t,e,i,!0)},"nth-of-type":function(t,e,i){return Selector.pseudos.nth(t,e,i,!1,!0)},"nth-last-of-type":function(t,e,i){return Selector.pseudos.nth(t,e,i,!0,!0)},"first-of-type":function(t,e,i){return Selector.pseudos.nth(t,"1",i,!1,!0)},"last-of-type":function(t,e,i){return Selector.pseudos.nth(t,"1",i,!0,!0)},"only-of-type":function(t,e,i){var n=Selector.pseudos;return n["last-of-type"](n["first-of-type"](t,e,i),e,i)},getIndices:function(t,e,i){return 0==t?e>0?[e]:[]:$R(1,i).inject([],function(i,n){return 0==(n-e)%t&&(n-e)/t>=0&&i.push(n),i})},nth:function(t,e,i,n,o){if(0==t.length)return[];"even"==e&&(e="2n+0"),"odd"==e&&(e="2n+1");var s,r=Selector.handlers,a=[],l=[];r.mark(t);for(var m=0;c=t[m];m++)c.parentNode._countedByPrototype||(r.index(c.parentNode,n,o),l.push(c.parentNode));if(e.match(/^\d+$/)){e=Number(e);for(m=0;c=t[m];m++)c.nodeIndex==e&&a.push(c)}else if(s=e.match(/^(-?\d*)?n(([+-])(\d+))?/)){"-"==s[1]&&(s[1]=-1);for(var c,h=s[1]?Number(s[1]):1,u=s[2]?Number(s[2]):0,_=Selector.pseudos.getIndices(h,u,t.length),p=(m=0,_.length);c=t[m];m++)for(var y=0;y<p;y++)c.nodeIndex==_[y]&&a.push(c)}return r.unmark(t),r.unmark(l),a},empty:function(t,e,i){for(var n,o=0,s=[];n=t[o];o++)"!"==n.tagName||n.firstChild&&!n.innerHTML.match(/^\s*$/)||s.push(n);return s},not:function(t,e,i){var n=Selector.handlers,o=new Selector(e).findElements(i);n.mark(o);for(var s,r=0,a=[];s=t[r];r++)s._countedByPrototype||a.push(s);return n.unmark(o),a},enabled:function(t,e,i){for(var n,o=0,s=[];n=t[o];o++)n.disabled||s.push(n);return s},disabled:function(t,e,i){for(var n,o=0,s=[];n=t[o];o++)n.disabled&&s.push(n);return s},checked:function(t,e,i){for(var n,o=0,s=[];n=t[o];o++)n.checked&&s.push(n);return s}},operators:{"=":function(t,e){return t==e},"!=":function(t,e){return t!=e},"^=":function(t,e){return t.startsWith(e)},"$=":function(t,e){return t.endsWith(e)},"*=":function(t,e){return t.include(e)},"~=":function(t,e){return(" "+t+" ").include(" "+e+" ")},"|=":function(t,e){return("-"+t.toUpperCase()+"-").include("-"+e.toUpperCase()+"-")}},split:function(t){var e=[];return t.scan(/(([\w#:.~>+()\s-]+|\*|\[.*?\])+)\s*(,|$)/,function(t){e.push(t[1].strip())}),e},matchElements:function(t,e){var i=$$(e),n=Selector.handlers;n.mark(i);for(var o,s=0,r=[];o=t[s];s++)o._countedByPrototype&&r.push(o);return n.unmark(i),r},findElement:function(t,e,i){return Object.isNumber(e)&&(i=e,e=!1),Selector.matchElements(t,e||"*")[i||0]},findChildElements:function(t,e){e=Selector.split(e.join(","));for(var i,n=[],o=Selector.handlers,s=0,r=e.length;s<r;s++)i=new Selector(e[s].strip()),o.concat(n,i.findElements(t));return r>1?o.unique(n):n}}),Prototype.Browser.IE&&Object.extend(Selector.handlers,{concat:function(t,e){for(var i,n=0;i=e[n];n++)"!"!==i.tagName&&t.push(i);return t},unmark:function(t){for(var e,i=0;e=t[i];i++)e.removeAttribute("_countedByPrototype");return t}});var Form={reset:function(t){return $(t).reset(),t},serializeElements:function(t,e){"object"!=typeof e?e={hash:!!e}:Object.isUndefined(e.hash)&&(e.hash=!0);var i,n,o=!1,s=e.submit,r=t.inject({},function(t,e){return!e.disabled&&e.name&&(i=e.name,null==(n=$(e).getValue())||"submit"==e.type&&(o||!1===s||s&&i!=s||!(o=!0))||(i in t?(Object.isArray(t[i])||(t[i]=[t[i]]),t[i].push(n)):t[i]=n)),t});return e.hash?r:Object.toQueryString(r)}};Form.Methods={serialize:function(t,e){return Form.serializeElements(Form.getElements(t),e)},getElements:function(t){return $A($(t).getElementsByTagName("*")).inject([],function(t,e){return Form.Element.Serializers[e.tagName.toLowerCase()]&&t.push(Element.extend(e)),t})},getInputs:function(t,e,i){var n=(t=$(t)).getElementsByTagName("input");if(!e&&!i)return $A(n).map(Element.extend);for(var o=0,s=[],r=n.length;o<r;o++){var a=n[o];e&&a.type!=e||i&&a.name!=i||s.push(Element.extend(a))}return s},disable:function(t){return t=$(t),Form.getElements(t).invoke("disable"),t},enable:function(t){return t=$(t),Form.getElements(t).invoke("enable"),t},findFirstElement:function(t){var e=$(t).getElements().findAll(function(t){return"hidden"!=t.type&&!t.disabled}),i=e.findAll(function(t){return t.hasAttribute("tabIndex")&&t.tabIndex>=0}).sortBy(function(t){return t.tabIndex}).first();return i||e.find(function(t){return["input","select","textarea"].include(t.tagName.toLowerCase())})},focusFirstElement:function(t){return(t=$(t)).findFirstElement().activate(),t},request:function(t,e){t=$(t);var i=(e=Object.clone(e||{})).parameters,n=t.readAttribute("action")||"";return n.blank()&&(n=window.location.href),e.parameters=t.serialize(!0),i&&(Object.isString(i)&&(i=i.toQueryParams()),Object.extend(e.parameters,i)),t.hasAttribute("method")&&!e.method&&(e.method=t.method),new Ajax.Request(n,e)}},Form.Element={focus:function(t){return $(t).focus(),t},select:function(t){return $(t).select(),t}},Form.Element.Methods={serialize:function(t){if(!(t=$(t)).disabled&&t.name){var e=t.getValue();if(void 0!=e){var i={};return i[t.name]=e,Object.toQueryString(i)}}return""},getValue:function(t){var e=(t=$(t)).tagName.toLowerCase();return Form.Element.Serializers[e](t)},setValue:function(t,e){var i=(t=$(t)).tagName.toLowerCase();return Form.Element.Serializers[i](t,e),t},clear:function(t){return $(t).value="",t},present:function(t){return""!=$(t).value},activate:function(t){t=$(t);try{t.focus(),!t.select||"input"==t.tagName.toLowerCase()&&["button","reset","submit"].include(t.type)||t.select()}catch(t){}return t},disable:function(t){return(t=$(t)).blur(),t.disabled=!0,t},enable:function(t){return(t=$(t)).disabled=!1,t}};var Field=Form.Element,$F=Form.Element.Methods.getValue,methods;if(Form.Element.Serializers={input:function(t,e){switch(t.type.toLowerCase()){case"checkbox":case"radio":return Form.Element.Serializers.inputSelector(t,e);default:return Form.Element.Serializers.textarea(t,e)}},inputSelector:function(t,e){if(Object.isUndefined(e))return t.checked?t.value:null;t.checked=!!e},textarea:function(t,e){if(Object.isUndefined(e))return t.value;t.value=e},select:function(t,e){if(Object.isUndefined(e))return this["select-one"==t.type?"selectOne":"selectMany"](t);for(var i,n,o=!Object.isArray(e),s=0,r=t.length;s<r;s++)if(i=t.options[s],n=this.optionValue(i),o){if(n==e)return void(i.selected=!0)}else i.selected=e.include(n)},selectOne:function(t){var e=t.selectedIndex;return e>=0?this.optionValue(t.options[e]):null},selectMany:function(t){var e=t.length;if(!e)return null;for(var i=0,n=[];i<e;i++){var o=t.options[i];o.selected&&n.push(this.optionValue(o))}return n},optionValue:function(t){return Element.extend(t).hasAttribute("value")?t.value:t.text}},Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function(t,e,i,n){t(n,i),this.element=$(e),this.lastValue=this.getValue()},execute:function(){var t=this.getValue();(Object.isString(this.lastValue)&&Object.isString(t)?this.lastValue!=t:String(this.lastValue)!=String(t))&&(this.callback(this.element,t),this.lastValue=t)}}),Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}}),Abstract.EventObserver=Class.create({initialize:function(t,e){this.element=$(t),this.callback=e,this.lastValue=this.getValue(),"form"==this.element.tagName.toLowerCase()?this.registerFormCallbacks():this.registerCallback(this.element)},onElementEvent:function(){var t=this.getValue();this.lastValue!=t&&(this.callback(this.element,t),this.lastValue=t)},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(t){if(t.type)switch(t.type.toLowerCase()){case"checkbox":case"radio":Event.observe(t,"click",this.onElementEvent.bind(this));break;default:Event.observe(t,"change",this.onElementEvent.bind(this))}}}),Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}}),Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}}),!window.Event)var Event={};Object.extend(Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{},relatedTarget:function(t){var e;switch(t.type){case"mouseover":e=t.fromElement;break;case"mouseout":e=t.toElement;break;default:return null}return Element.extend(e)}}),Event.Methods=function(){var t;if(Prototype.Browser.IE){var e={0:1,1:4,2:2};t=function(t,i){return t.button==e[i]}}else t=Prototype.Browser.WebKit?function(t,e){switch(e){case 0:return 1==t.which&&!t.metaKey;case 1:return 1==t.which&&t.metaKey;default:return!1}}:function(t,e){return t.which?t.which===e+1:t.button===e};return{isLeftClick:function(e){return t(e,0)},isMiddleClick:function(e){return t(e,1)},isRightClick:function(e){return t(e,2)},element:function(t){var e=Event.extend(t).target;return Element.extend(e.nodeType==Node.TEXT_NODE?e.parentNode:e)},findElement:function(t,e){var i=Event.element(t);if(!e)return i;var n=[i].concat(i.ancestors());return Selector.findElement(n,e,0)},pointer:function(t){return{x:t.pageX||t.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft),y:t.pageY||t.clientY+(document.documentElement.scrollTop||document.body.scrollTop)}},pointerX:function(t){return Event.pointer(t).x},pointerY:function(t){return Event.pointer(t).y},stop:function(t){Event.extend(t),t.preventDefault(),t.stopPropagation(),t.stopped=!0}}}(),Event.extend=(methods=Object.keys(Event.Methods).inject({},function(t,e){return t[e]=Event.Methods[e].methodize(),t}),Prototype.Browser.IE?(Object.extend(methods,{stopPropagation:function(){this.cancelBubble=!0},preventDefault:function(){this.returnValue=!1},inspect:function(){return"[object Event]"}}),function(t){if(!t)return!1;if(t._extendedByPrototype)return t;t._extendedByPrototype=Prototype.emptyFunction;var e=Event.pointer(t);return Object.extend(t,{target:t.srcElement,relatedTarget:Event.relatedTarget(t),pageX:e.x,pageY:e.y}),Object.extend(t,methods)}):(Event.prototype=Event.prototype||document.createEvent("HTMLEvents").__proto__,Object.extend(Event.prototype,methods),Prototype.K)),Object.extend(Event,function(){var t=Event.cache;function e(t){return t._prototypeEventID?t._prototypeEventID[0]:(arguments.callee.id=arguments.callee.id||1,t._prototypeEventID=[++arguments.callee.id])}function i(t){return t&&t.include(":")?"dataavailable":t}function n(e){return t[e]=t[e]||{}}function o(t,e){var i=n(t);return i[e]=i[e]||[]}function s(t,e,i){return o(t,e).find(function(t){return t.handler==i})}return window.attachEvent&&window.attachEvent("onunload",function(){for(var e in t)for(var i in t[e])t[e][i]=null}),{observe:function(t,n,s){t=$(t);var r=i(n),a=function(t,i,n){var s=o(e(t),i);if(s.pluck("handler").include(n))return!1;var r=function(e){if(!Event||!Event.extend||e.eventName&&e.eventName!=i)return!1;Event.extend(e),n.call(t,e)};return r.handler=n,s.push(r),r}(t,n,s);return a?(t.addEventListener?t.addEventListener(r,a,!1):t.attachEvent("on"+r,a),t):t},stopObserving:function(t,r,a){var l=e(t=$(t)),m=i(r);if(!a&&r)return o(l,r).each(function(e){t.stopObserving(r,e.handler)}),t;if(!r)return Object.keys(n(l)).each(function(e){t.stopObserving(e)}),t;var c=s(l,r,a);return c?(t.removeEventListener?t.removeEventListener(m,c,!1):t.detachEvent("on"+m,c),function(t,e,i){var o=n(t);if(!o[e])return!1;o[e]=o[e].without(s(t,e,i))}(l,r,a),t):t},fire:function(t,e,i){var n;return(t=$(t))==document&&document.createEvent&&!t.dispatchEvent&&(t=document.documentElement),document.createEvent?(n=document.createEvent("HTMLEvents")).initEvent("dataavailable",!0,!0):(n=document.createEventObject()).eventType="ondataavailable",n.eventName=e,n.memo=i||{},document.createEvent?t.dispatchEvent(n):t.fireEvent(n.eventType,n),Event.extend(n)}}}()),Object.extend(Event,Event.Methods),Element.addMethods({fire:Event.fire,observe:Event.observe,stopObserving:Event.stopObserving}),Object.extend(document,{fire:Element.Methods.fire.methodize(),observe:Element.Methods.observe.methodize(),stopObserving:Element.Methods.stopObserving.methodize(),loaded:!1}),function(){var t;function e(){document.loaded||(t&&window.clearInterval(t),document.fire("dom:loaded"),document.loaded=!0)}document.addEventListener?Prototype.Browser.WebKit?(t=window.setInterval(function(){/loaded|complete/.test(document.readyState)&&e()},0),Event.observe(window,"load",e)):document.addEventListener("DOMContentLoaded",e,!1):(document.write("<script id=__onDOMContentLoaded defer src=//:><\/script>"),$("__onDOMContentLoaded").onreadystatechange=function(){"complete"==this.readyState&&(this.onreadystatechange=null,e())})}(),Hash.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(t,e){return Element.insert(t,{before:e})},Top:function(t,e){return Element.insert(t,{top:e})},Bottom:function(t,e){return Element.insert(t,{bottom:e})},After:function(t,e){return Element.insert(t,{after:e})}},$continue=new Error('"throw $continue" is deprecated, use "return" instead'),Position={includeScrollOffsets:!1,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0,this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},within:function(t,e,i){return this.includeScrollOffsets?this.withinIncludingScrolloffsets(t,e,i):(this.xcomp=e,this.ycomp=i,this.offset=Element.cumulativeOffset(t),i>=this.offset[1]&&i<this.offset[1]+t.offsetHeight&&e>=this.offset[0]&&e<this.offset[0]+t.offsetWidth)},withinIncludingScrolloffsets:function(t,e,i){var n=Element.cumulativeScrollOffset(t);return this.xcomp=e+n[0]-this.deltaX,this.ycomp=i+n[1]-this.deltaY,this.offset=Element.cumulativeOffset(t),this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+t.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+t.offsetWidth},overlap:function(t,e){return t?"vertical"==t?(this.offset[1]+e.offsetHeight-this.ycomp)/e.offsetHeight:"horizontal"==t?(this.offset[0]+e.offsetWidth-this.xcomp)/e.offsetWidth:void 0:0},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(t){return Position.prepare(),Element.absolutize(t)},relativize:function(t){return Position.prepare(),Element.relativize(t)},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(t,e,i){return i=i||{},Element.clonePosition(e,t,i)}};document.getElementsByClassName||(document.getElementsByClassName=function(t){function e(t){return t.blank()?null:"[contains(concat(' ', @class, ' '), ' "+t+" ')]"}return Element.Methods.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(t,i){i=i.toString().strip();var n=/\s/.test(i)?$w(i).map(e).join(""):e(i);return n?document._getElementsByXPath(".//*"+n,t):[]}:function(t,e){e=e.toString().strip();var i=[],n=/\s/.test(e)?$w(e):null;if(!n&&!e)return i;var o=$(t).getElementsByTagName("*");e=" "+e+" ";for(var s,r,a=0;s=o[a];a++)s.className&&(r=" "+s.className+" ")&&(r.include(e)||n&&n.all(function(t){return!t.toString().blank()&&r.include(" "+t+" ")}))&&i.push(Element.extend(s));return i},function(t,e){return $(e||document.body).getElementsByClassName(t)}}()),Element.ClassNames=Class.create(),Element.ClassNames.prototype={initialize:function(t){this.element=$(t)},_each:function(t){this.element.className.split(/\s+/).select(function(t){return t.length>0})._each(t)},set:function(t){this.element.className=t},add:function(t){this.include(t)||this.set($A(this).concat(t).join(" "))},remove:function(t){this.include(t)&&this.set($A(this).without(t).join(" "))},toString:function(){return $A(this).join(" ")}},Object.extend(Element.ClassNames.prototype,Enumerable),Element.addMethods()},function(t,e){var i=Class.create();Object.extend(i.prototype,b2JointDef.prototype),Object.extend(i.prototype,{initialize:function(){this.type=b2Joint.e_unknownJoint,this.userData=null,this.body1=null,this.body2=null,this.collideConnected=!1,this.type=b2Joint.e_revoluteJoint,this.anchorPoint=new b2Vec2(0,0),this.lowerAngle=0,this.upperAngle=0,this.motorTorque=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},anchorPoint:null,lowerAngle:null,upperAngle:null,motorTorque:null,motorSpeed:null,enableLimit:null,enableMotor:null})},function(t,e){var i=Class.create();Object.extend(i.prototype,b2Joint.prototype),Object.extend(i.prototype,{GetAnchor1:function(){var t=this.m_body1.m_R;return new b2Vec2(this.m_body1.m_position.x+(t.col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y),this.m_body1.m_position.y+(t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y))},GetAnchor2:function(){var t=this.m_body2.m_R;return new b2Vec2(this.m_body2.m_position.x+(t.col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y),this.m_body2.m_position.y+(t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y))},GetJointAngle:function(){return this.m_body2.m_rotation-this.m_body1.m_rotation},GetJointSpeed:function(){return this.m_body2.m_angularVelocity-this.m_body1.m_angularVelocity},GetMotorTorque:function(t){return t*this.m_motorImpulse},SetMotorSpeed:function(t){this.m_motorSpeed=t},SetMotorTorque:function(t){this.m_maxMotorTorque=t},GetReactionForce:function(t){var e=this.m_ptpImpulse.Copy();return e.Multiply(t),e},GetReactionTorque:function(t){return t*this.m_limitImpulse},initialize:function(t){var e,i,n;this.m_node1=new b2JointNode,this.m_node2=new b2JointNode,this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_body1=t.body1,this.m_body2=t.body2,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData,this.K=new b2Mat22,this.K1=new b2Mat22,this.K2=new b2Mat22,this.K3=new b2Mat22,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_ptpImpulse=new b2Vec2,this.m_ptpMass=new b2Mat22,e=this.m_body1.m_R,i=t.anchorPoint.x-this.m_body1.m_position.x,n=t.anchorPoint.y-this.m_body1.m_position.y,this.m_localAnchor1.x=i*e.col1.x+n*e.col1.y,this.m_localAnchor1.y=i*e.col2.x+n*e.col2.y,e=this.m_body2.m_R,i=t.anchorPoint.x-this.m_body2.m_position.x,n=t.anchorPoint.y-this.m_body2.m_position.y,this.m_localAnchor2.x=i*e.col1.x+n*e.col1.y,this.m_localAnchor2.y=i*e.col2.x+n*e.col2.y,this.m_intialAngle=this.m_body2.m_rotation-this.m_body1.m_rotation,this.m_ptpImpulse.Set(0,0),this.m_motorImpulse=0,this.m_limitImpulse=0,this.m_limitPositionImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.motorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor},K:new b2Mat22,K1:new b2Mat22,K2:new b2Mat22,K3:new b2Mat22,PrepareVelocitySolver:function(){var t,e=this.m_body1,i=this.m_body2,n=(t=e.m_R).col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y,o=t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y,s=(t=i.m_R).col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y,r=t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y,a=e.m_invMass,l=i.m_invMass,m=e.m_invI,c=i.m_invI;if(this.K1.col1.x=a+l,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=a+l,this.K2.col1.x=m*o*o,this.K2.col2.x=-m*n*o,this.K2.col1.y=-m*n*o,this.K2.col2.y=m*n*n,this.K3.col1.x=c*r*r,this.K3.col2.x=-c*s*r,this.K3.col1.y=-c*s*r,this.K3.col2.y=c*s*s,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Invert(this.m_ptpMass),this.m_motorMass=1/(m+c),0==this.m_enableMotor&&(this.m_motorImpulse=0),this.m_enableLimit){var h=i.m_rotation-e.m_rotation-this.m_intialAngle;b2Math.b2Abs(this.m_upperAngle-this.m_lowerAngle)<2*b2Settings.b2_angularSlop?this.m_limitState=b2Joint.e_equalLimits:h<=this.m_lowerAngle?(this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_limitImpulse=0),this.m_limitState=b2Joint.e_atLowerLimit):h>=this.m_upperAngle?(this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_limitImpulse=0),this.m_limitState=b2Joint.e_atUpperLimit):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_limitImpulse=0)}else this.m_limitImpulse=0;b2World.s_enableWarmStarting?(e.m_linearVelocity.x-=a*this.m_ptpImpulse.x,e.m_linearVelocity.y-=a*this.m_ptpImpulse.y,e.m_angularVelocity-=m*(n*this.m_ptpImpulse.y-o*this.m_ptpImpulse.x+this.m_motorImpulse+this.m_limitImpulse),i.m_linearVelocity.x+=l*this.m_ptpImpulse.x,i.m_linearVelocity.y+=l*this.m_ptpImpulse.y,i.m_angularVelocity+=c*(s*this.m_ptpImpulse.y-r*this.m_ptpImpulse.x+this.m_motorImpulse+this.m_limitImpulse)):(this.m_ptpImpulse.SetZero(),this.m_motorImpulse=0,this.m_limitImpulse=0),this.m_limitPositionImpulse=0},SolveVelocityConstraints:function(t){var e,i,n=this.m_body1,o=this.m_body2,s=(e=n.m_R).col1.x*this.m_localAnchor1.x+e.col2.x*this.m_localAnchor1.y,r=e.col1.y*this.m_localAnchor1.x+e.col2.y*this.m_localAnchor1.y,a=(e=o.m_R).col1.x*this.m_localAnchor2.x+e.col2.x*this.m_localAnchor2.y,l=e.col1.y*this.m_localAnchor2.x+e.col2.y*this.m_localAnchor2.y,m=o.m_linearVelocity.x+-o.m_angularVelocity*l-n.m_linearVelocity.x- -n.m_angularVelocity*r,c=o.m_linearVelocity.y+o.m_angularVelocity*a-n.m_linearVelocity.y-n.m_angularVelocity*s,h=-(this.m_ptpMass.col1.x*m+this.m_ptpMass.col2.x*c),u=-(this.m_ptpMass.col1.y*m+this.m_ptpMass.col2.y*c);if(this.m_ptpImpulse.x+=h,this.m_ptpImpulse.y+=u,n.m_linearVelocity.x-=n.m_invMass*h,n.m_linearVelocity.y-=n.m_invMass*u,n.m_angularVelocity-=n.m_invI*(s*u-r*h),o.m_linearVelocity.x+=o.m_invMass*h,o.m_linearVelocity.y+=o.m_invMass*u,o.m_angularVelocity+=o.m_invI*(a*u-l*h),this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits){var _=o.m_angularVelocity-n.m_angularVelocity-this.m_motorSpeed,p=-this.m_motorMass*_,y=this.m_motorImpulse;this.m_motorImpulse=b2Math.b2Clamp(this.m_motorImpulse+p,-t.dt*this.m_maxMotorTorque,t.dt*this.m_maxMotorTorque),p=this.m_motorImpulse-y,n.m_angularVelocity-=n.m_invI*p,o.m_angularVelocity+=o.m_invI*p}if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){var d=o.m_angularVelocity-n.m_angularVelocity,b=-this.m_motorMass*d;this.m_limitState==b2Joint.e_equalLimits?this.m_limitImpulse+=b:this.m_limitState==b2Joint.e_atLowerLimit?(i=this.m_limitImpulse,this.m_limitImpulse=b2Math.b2Max(this.m_limitImpulse+b,0),b=this.m_limitImpulse-i):this.m_limitState==b2Joint.e_atUpperLimit&&(i=this.m_limitImpulse,this.m_limitImpulse=b2Math.b2Min(this.m_limitImpulse+b,0),b=this.m_limitImpulse-i),n.m_angularVelocity-=n.m_invI*b,o.m_angularVelocity+=o.m_invI*b}},SolvePositionConstraints:function(){var t,e,n,o,s=this.m_body1,r=this.m_body2,a=(o=s.m_R).col1.x*this.m_localAnchor1.x+o.col2.x*this.m_localAnchor1.y,l=o.col1.y*this.m_localAnchor1.x+o.col2.y*this.m_localAnchor1.y,m=(o=r.m_R).col1.x*this.m_localAnchor2.x+o.col2.x*this.m_localAnchor2.y,c=o.col1.y*this.m_localAnchor2.x+o.col2.y*this.m_localAnchor2.y,h=s.m_position.x+a,u=s.m_position.y+l,_=r.m_position.x+m-h,p=r.m_position.y+c-u;n=Math.sqrt(_*_+p*p);var y=s.m_invMass,d=r.m_invMass,b=s.m_invI,f=r.m_invI;this.K1.col1.x=y+d,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=y+d,this.K2.col1.x=b*l*l,this.K2.col2.x=-b*a*l,this.K2.col1.y=-b*a*l,this.K2.col2.y=b*a*a,this.K3.col1.x=f*c*c,this.K3.col2.x=-f*m*c,this.K3.col1.y=-f*m*c,this.K3.col2.y=f*m*m,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(i.tImpulse,-_,-p);var x=i.tImpulse.x,v=i.tImpulse.y;s.m_position.x-=s.m_invMass*x,s.m_position.y-=s.m_invMass*v,s.m_rotation-=s.m_invI*(a*v-l*x),s.m_R.Set(s.m_rotation),r.m_position.x+=r.m_invMass*x,r.m_position.y+=r.m_invMass*v,r.m_rotation+=r.m_invI*(m*v-c*x),r.m_R.Set(r.m_rotation);var g=0;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){var S=r.m_rotation-s.m_rotation-this.m_intialAngle,M=0;this.m_limitState==b2Joint.e_equalLimits?(e=b2Math.b2Clamp(S,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection),M=-this.m_motorMass*e,g=b2Math.b2Abs(e)):this.m_limitState==b2Joint.e_atLowerLimit?(e=S-this.m_lowerAngle,g=b2Math.b2Max(0,-e),e=b2Math.b2Clamp(e+b2Settings.b2_angularSlop,-b2Settings.b2_maxAngularCorrection,0),M=-this.m_motorMass*e,t=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+M,0),M=this.m_limitPositionImpulse-t):this.m_limitState==b2Joint.e_atUpperLimit&&(e=S-this.m_upperAngle,g=b2Math.b2Max(0,e),e=b2Math.b2Clamp(e-b2Settings.b2_angularSlop,0,b2Settings.b2_maxAngularCorrection),M=-this.m_motorMass*e,t=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+M,0),M=this.m_limitPositionImpulse-t),s.m_rotation-=s.m_invI*M,s.m_R.Set(s.m_rotation),r.m_rotation+=r.m_invI*M,r.m_R.Set(r.m_rotation)}return n<=b2Settings.b2_linearSlop&&g<=b2Settings.b2_angularSlop},m_localAnchor1:new b2Vec2,m_localAnchor2:new b2Vec2,m_ptpImpulse:new b2Vec2,m_motorImpulse:null,m_limitImpulse:null,m_limitPositionImpulse:null,m_ptpMass:new b2Mat22,m_motorMass:null,m_intialAngle:null,m_lowerAngle:null,m_upperAngle:null,m_maxMotorTorque:null,m_motorSpeed:null,m_enableLimit:null,m_enableMotor:null,m_limitState:0}),i.tImpulse=new b2Vec2},function(t,e){var i=Class.create();Object.extend(i.prototype,b2JointDef.prototype),Object.extend(i.prototype,{initialize:function(){this.type=b2Joint.e_unknownJoint,this.userData=null,this.body1=null,this.body2=null,this.collideConnected=!1,this.groundPoint1=new b2Vec2,this.groundPoint2=new b2Vec2,this.anchorPoint1=new b2Vec2,this.anchorPoint2=new b2Vec2,this.type=b2Joint.e_pulleyJoint,this.groundPoint1.Set(-1,1),this.groundPoint2.Set(1,1),this.anchorPoint1.Set(-1,0),this.anchorPoint2.Set(1,0),this.maxLength1=.5*b2PulleyJoint.b2_minPulleyLength,this.maxLength2=.5*b2PulleyJoint.b2_minPulleyLength,this.ratio=1,this.collideConnected=!0},groundPoint1:new b2Vec2,groundPoint2:new b2Vec2,anchorPoint1:new b2Vec2,anchorPoint2:new b2Vec2,maxLength1:null,maxLength2:null,ratio:null})},function(t,e){var i=Class.create();Object.extend(i.prototype,b2Joint.prototype),Object.extend(i.prototype,{GetAnchor1:function(){var t=this.m_body1.m_R;return new b2Vec2(this.m_body1.m_position.x+(t.col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y),this.m_body1.m_position.y+(t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y))},GetAnchor2:function(){var t=this.m_body2.m_R;return new b2Vec2(this.m_body2.m_position.x+(t.col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y),this.m_body2.m_position.y+(t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y))},GetGroundPoint1:function(){return new b2Vec2(this.m_ground.m_position.x+this.m_groundAnchor1.x,this.m_ground.m_position.y+this.m_groundAnchor1.y)},GetGroundPoint2:function(){return new b2Vec2(this.m_ground.m_position.x+this.m_groundAnchor2.x,this.m_ground.m_position.y+this.m_groundAnchor2.y)},GetReactionForce:function(t){return new b2Vec2},GetReactionTorque:function(t){return 0},GetLength1:function(){var t;t=this.m_body1.m_R;var e=this.m_body1.m_position.x+(t.col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y),i=this.m_body1.m_position.y+(t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y),n=e-(this.m_ground.m_position.x+this.m_groundAnchor1.x),o=i-(this.m_ground.m_position.y+this.m_groundAnchor1.y);return Math.sqrt(n*n+o*o)},GetLength2:function(){var t;t=this.m_body2.m_R;var e=this.m_body2.m_position.x+(t.col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y),i=this.m_body2.m_position.y+(t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y),n=e-(this.m_ground.m_position.x+this.m_groundAnchor2.x),o=i-(this.m_ground.m_position.y+this.m_groundAnchor2.y);return Math.sqrt(n*n+o*o)},GetRatio:function(){return this.m_ratio},initialize:function(t){var e,n,o;this.m_node1=new b2JointNode,this.m_node2=new b2JointNode,this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_body1=t.body1,this.m_body2=t.body2,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData,this.m_groundAnchor1=new b2Vec2,this.m_groundAnchor2=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_u1=new b2Vec2,this.m_u2=new b2Vec2,this.m_ground=this.m_body1.m_world.m_groundBody,this.m_groundAnchor1.x=t.groundPoint1.x-this.m_ground.m_position.x,this.m_groundAnchor1.y=t.groundPoint1.y-this.m_ground.m_position.y,this.m_groundAnchor2.x=t.groundPoint2.x-this.m_ground.m_position.x,this.m_groundAnchor2.y=t.groundPoint2.y-this.m_ground.m_position.y,e=this.m_body1.m_R,n=t.anchorPoint1.x-this.m_body1.m_position.x,o=t.anchorPoint1.y-this.m_body1.m_position.y,this.m_localAnchor1.x=n*e.col1.x+o*e.col1.y,this.m_localAnchor1.y=n*e.col2.x+o*e.col2.y,e=this.m_body2.m_R,n=t.anchorPoint2.x-this.m_body2.m_position.x,o=t.anchorPoint2.y-this.m_body2.m_position.y,this.m_localAnchor2.x=n*e.col1.x+o*e.col1.y,this.m_localAnchor2.y=n*e.col2.x+o*e.col2.y,this.m_ratio=t.ratio,n=t.groundPoint1.x-t.anchorPoint1.x,o=t.groundPoint1.y-t.anchorPoint1.y;var s=Math.sqrt(n*n+o*o);n=t.groundPoint2.x-t.anchorPoint2.x,o=t.groundPoint2.y-t.anchorPoint2.y;var r=Math.sqrt(n*n+o*o),a=b2Math.b2Max(.5*i.b2_minPulleyLength,s),l=b2Math.b2Max(.5*i.b2_minPulleyLength,r);this.m_constant=a+this.m_ratio*l,this.m_maxLength1=b2Math.b2Clamp(t.maxLength1,a,this.m_constant-this.m_ratio*i.b2_minPulleyLength),this.m_maxLength2=b2Math.b2Clamp(t.maxLength2,l,(this.m_constant-i.b2_minPulleyLength)/this.m_ratio),this.m_pulleyImpulse=0,this.m_limitImpulse1=0,this.m_limitImpulse2=0},PrepareVelocitySolver:function(){var t,e=this.m_body1,i=this.m_body2,n=(t=e.m_R).col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y,o=t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y,s=(t=i.m_R).col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y,r=t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y,a=e.m_position.x+n,l=e.m_position.y+o,m=i.m_position.x+s,c=i.m_position.y+r,h=this.m_ground.m_position.x+this.m_groundAnchor1.x,u=this.m_ground.m_position.y+this.m_groundAnchor1.y,_=this.m_ground.m_position.x+this.m_groundAnchor2.x,p=this.m_ground.m_position.y+this.m_groundAnchor2.y;this.m_u1.Set(a-h,l-u),this.m_u2.Set(m-_,c-p);var y=this.m_u1.Length(),d=this.m_u2.Length();y>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/y):this.m_u1.SetZero(),d>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/d):this.m_u2.SetZero(),y<this.m_maxLength1?(this.m_limitState1=b2Joint.e_inactiveLimit,this.m_limitImpulse1=0):(this.m_limitState1=b2Joint.e_atUpperLimit,this.m_limitPositionImpulse1=0),d<this.m_maxLength2?(this.m_limitState2=b2Joint.e_inactiveLimit,this.m_limitImpulse2=0):(this.m_limitState2=b2Joint.e_atUpperLimit,this.m_limitPositionImpulse2=0);var b=n*this.m_u1.y-o*this.m_u1.x,f=s*this.m_u2.y-r*this.m_u2.x;this.m_limitMass1=e.m_invMass+e.m_invI*b*b,this.m_limitMass2=i.m_invMass+i.m_invI*f*f,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass;var x=(-this.m_pulleyImpulse-this.m_limitImpulse1)*this.m_u1.x,v=(-this.m_pulleyImpulse-this.m_limitImpulse1)*this.m_u1.y,g=(-this.m_ratio*this.m_pulleyImpulse-this.m_limitImpulse2)*this.m_u2.x,S=(-this.m_ratio*this.m_pulleyImpulse-this.m_limitImpulse2)*this.m_u2.y;e.m_linearVelocity.x+=e.m_invMass*x,e.m_linearVelocity.y+=e.m_invMass*v,e.m_angularVelocity+=e.m_invI*(n*v-o*x),i.m_linearVelocity.x+=i.m_invMass*g,i.m_linearVelocity.y+=i.m_invMass*S,i.m_angularVelocity+=i.m_invI*(s*S-r*g)},SolveVelocityConstraints:function(t){var e,i,n,o,s,r,a,l,m,c,h,u,_=this.m_body1,p=this.m_body2,y=(e=_.m_R).col1.x*this.m_localAnchor1.x+e.col2.x*this.m_localAnchor1.y,d=e.col1.y*this.m_localAnchor1.x+e.col2.y*this.m_localAnchor1.y,b=(e=p.m_R).col1.x*this.m_localAnchor2.x+e.col2.x*this.m_localAnchor2.y,f=e.col1.y*this.m_localAnchor2.x+e.col2.y*this.m_localAnchor2.y;i=_.m_linearVelocity.x+-_.m_angularVelocity*d,n=_.m_linearVelocity.y+_.m_angularVelocity*y,o=p.m_linearVelocity.x+-p.m_angularVelocity*f,s=p.m_linearVelocity.y+p.m_angularVelocity*b,c=-(this.m_u1.x*i+this.m_u1.y*n)-this.m_ratio*(this.m_u2.x*o+this.m_u2.y*s),h=-this.m_pulleyMass*c,this.m_pulleyImpulse+=h,r=-h*this.m_u1.x,a=-h*this.m_u1.y,l=-this.m_ratio*h*this.m_u2.x,m=-this.m_ratio*h*this.m_u2.y,_.m_linearVelocity.x+=_.m_invMass*r,_.m_linearVelocity.y+=_.m_invMass*a,_.m_angularVelocity+=_.m_invI*(y*a-d*r),p.m_linearVelocity.x+=p.m_invMass*l,p.m_linearVelocity.y+=p.m_invMass*m,p.m_angularVelocity+=p.m_invI*(b*m-f*l),this.m_limitState1==b2Joint.e_atUpperLimit&&(i=_.m_linearVelocity.x+-_.m_angularVelocity*d,n=_.m_linearVelocity.y+_.m_angularVelocity*y,c=-(this.m_u1.x*i+this.m_u1.y*n),h=-this.m_limitMass1*c,u=this.m_limitImpulse1,this.m_limitImpulse1=b2Math.b2Max(0,this.m_limitImpulse1+h),r=-(h=this.m_limitImpulse1-u)*this.m_u1.x,a=-h*this.m_u1.y,_.m_linearVelocity.x+=_.m_invMass*r,_.m_linearVelocity.y+=_.m_invMass*a,_.m_angularVelocity+=_.m_invI*(y*a-d*r)),this.m_limitState2==b2Joint.e_atUpperLimit&&(o=p.m_linearVelocity.x+-p.m_angularVelocity*f,s=p.m_linearVelocity.y+p.m_angularVelocity*b,c=-(this.m_u2.x*o+this.m_u2.y*s),h=-this.m_limitMass2*c,u=this.m_limitImpulse2,this.m_limitImpulse2=b2Math.b2Max(0,this.m_limitImpulse2+h),l=-(h=this.m_limitImpulse2-u)*this.m_u2.x,m=-h*this.m_u2.y,p.m_linearVelocity.x+=p.m_invMass*l,p.m_linearVelocity.y+=p.m_invMass*m,p.m_angularVelocity+=p.m_invI*(b*m-f*l))},SolvePositionConstraints:function(){var t,e,i,n,o,s,r,a,l,m,c,h,u,_,p=this.m_body1,y=this.m_body2,d=this.m_ground.m_position.x+this.m_groundAnchor1.x,b=this.m_ground.m_position.y+this.m_groundAnchor1.y,f=this.m_ground.m_position.x+this.m_groundAnchor2.x,x=this.m_ground.m_position.y+this.m_groundAnchor2.y,v=0;return e=(t=p.m_R).col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y,i=t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y,n=(t=y.m_R).col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y,o=t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y,s=p.m_position.x+e,r=p.m_position.y+i,a=y.m_position.x+n,l=y.m_position.y+o,this.m_u1.Set(s-d,r-b),this.m_u2.Set(a-f,l-x),m=this.m_u1.Length(),c=this.m_u2.Length(),m>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/m):this.m_u1.SetZero(),c>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/c):this.m_u2.SetZero(),h=this.m_constant-m-this.m_ratio*c,v=b2Math.b2Max(v,Math.abs(h)),h=b2Math.b2Clamp(h,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),s=-(u=-this.m_pulleyMass*h)*this.m_u1.x,r=-u*this.m_u1.y,a=-this.m_ratio*u*this.m_u2.x,l=-this.m_ratio*u*this.m_u2.y,p.m_position.x+=p.m_invMass*s,p.m_position.y+=p.m_invMass*r,p.m_rotation+=p.m_invI*(e*r-i*s),y.m_position.x+=y.m_invMass*a,y.m_position.y+=y.m_invMass*l,y.m_rotation+=y.m_invI*(n*l-o*a),p.m_R.Set(p.m_rotation),y.m_R.Set(y.m_rotation),this.m_limitState1==b2Joint.e_atUpperLimit&&(e=(t=p.m_R).col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y,i=t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y,s=p.m_position.x+e,r=p.m_position.y+i,this.m_u1.Set(s-d,r-b),(m=this.m_u1.Length())>b2Settings.b2_linearSlop?(this.m_u1.x*=1/m,this.m_u1.y*=1/m):this.m_u1.SetZero(),h=this.m_maxLength1-m,v=b2Math.b2Max(v,-h),h=b2Math.b2Clamp(h+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),u=-this.m_limitMass1*h,_=this.m_limitPositionImpulse1,this.m_limitPositionImpulse1=b2Math.b2Max(0,this.m_limitPositionImpulse1+u),s=-(u=this.m_limitPositionImpulse1-_)*this.m_u1.x,r=-u*this.m_u1.y,p.m_position.x+=p.m_invMass*s,p.m_position.y+=p.m_invMass*r,p.m_rotation+=p.m_invI*(e*r-i*s),p.m_R.Set(p.m_rotation)),this.m_limitState2==b2Joint.e_atUpperLimit&&(n=(t=y.m_R).col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y,o=t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y,a=y.m_position.x+n,l=y.m_position.y+o,this.m_u2.Set(a-f,l-x),(c=this.m_u2.Length())>b2Settings.b2_linearSlop?(this.m_u2.x*=1/c,this.m_u2.y*=1/c):this.m_u2.SetZero(),h=this.m_maxLength2-c,v=b2Math.b2Max(v,-h),h=b2Math.b2Clamp(h+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),u=-this.m_limitMass2*h,_=this.m_limitPositionImpulse2,this.m_limitPositionImpulse2=b2Math.b2Max(0,this.m_limitPositionImpulse2+u),a=-(u=this.m_limitPositionImpulse2-_)*this.m_u2.x,l=-u*this.m_u2.y,y.m_position.x+=y.m_invMass*a,y.m_position.y+=y.m_invMass*l,y.m_rotation+=y.m_invI*(n*l-o*a),y.m_R.Set(y.m_rotation)),v<b2Settings.b2_linearSlop},m_ground:null,m_groundAnchor1:new b2Vec2,m_groundAnchor2:new b2Vec2,m_localAnchor1:new b2Vec2,m_localAnchor2:new b2Vec2,m_u1:new b2Vec2,m_u2:new b2Vec2,m_constant:null,m_ratio:null,m_maxLength1:null,m_maxLength2:null,m_pulleyMass:null,m_limitMass1:null,m_limitMass2:null,m_pulleyImpulse:null,m_limitImpulse1:null,m_limitImpulse2:null,m_limitPositionImpulse1:null,m_limitPositionImpulse2:null,m_limitState1:0,m_limitState2:0}),i.b2_minPulleyLength=b2Settings.b2_lengthUnitsPerMeter},function(t,e){var i=Class.create();Object.extend(i.prototype,b2JointDef.prototype),Object.extend(i.prototype,{initialize:function(){this.type=b2Joint.e_unknownJoint,this.userData=null,this.body1=null,this.body2=null,this.collideConnected=!1,this.type=b2Joint.e_prismaticJoint,this.anchorPoint=new b2Vec2(0,0),this.axis=new b2Vec2(0,0),this.lowerTranslation=0,this.upperTranslation=0,this.motorForce=0,this.motorSpeed=0,this.enableLimit=!1,this.enableMotor=!1},anchorPoint:null,axis:null,lowerTranslation:null,upperTranslation:null,motorForce:null,motorSpeed:null,enableLimit:null,enableMotor:null})},function(t,e){var i=Class.create();Object.extend(i.prototype,b2Joint.prototype),Object.extend(i.prototype,{GetAnchor1:function(){var t=this.m_body1,e=new b2Vec2;return e.SetV(this.m_localAnchor1),e.MulM(t.m_R),e.Add(t.m_position),e},GetAnchor2:function(){var t=this.m_body2,e=new b2Vec2;return e.SetV(this.m_localAnchor2),e.MulM(t.m_R),e.Add(t.m_position),e},GetJointTranslation:function(){var t,e=this.m_body1,i=this.m_body2,n=(t=e.m_R).col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y,o=t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y,s=(t=i.m_R).col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y,r=t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y,a=e.m_position.x+n,l=e.m_position.y+o,m=i.m_position.x+s-a,c=i.m_position.y+r-l;return((t=e.m_R).col1.x*this.m_localXAxis1.x+t.col2.x*this.m_localXAxis1.y)*m+(t.col1.y*this.m_localXAxis1.x+t.col2.y*this.m_localXAxis1.y)*c},GetJointSpeed:function(){var t,e=this.m_body1,i=this.m_body2,n=(t=e.m_R).col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y,o=t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y,s=(t=i.m_R).col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y,r=t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y,a=e.m_position.x+n,l=e.m_position.y+o,m=i.m_position.x+s-a,c=i.m_position.y+r-l,h=(t=e.m_R).col1.x*this.m_localXAxis1.x+t.col2.x*this.m_localXAxis1.y,u=t.col1.y*this.m_localXAxis1.x+t.col2.y*this.m_localXAxis1.y,_=e.m_linearVelocity,p=i.m_linearVelocity,y=e.m_angularVelocity,d=i.m_angularVelocity;return m*(-y*u)+c*(y*h)+(h*(p.x+-d*r-_.x- -y*o)+u*(p.y+d*s-_.y-y*n))},GetMotorForce:function(t){return t*this.m_motorImpulse},SetMotorSpeed:function(t){this.m_motorSpeed=t},SetMotorForce:function(t){this.m_maxMotorForce=t},GetReactionForce:function(t){var e,i=t*this.m_limitImpulse,n=i*((e=this.m_body1.m_R).col1.x*this.m_localXAxis1.x+e.col2.x*this.m_localXAxis1.y),o=i*(e.col1.y*this.m_localXAxis1.x+e.col2.y*this.m_localXAxis1.y),s=i*(e.col1.x*this.m_localYAxis1.x+e.col2.x*this.m_localYAxis1.y),r=i*(e.col1.y*this.m_localYAxis1.x+e.col2.y*this.m_localYAxis1.y);return new b2Vec2(n+s,o+r)},GetReactionTorque:function(t){return t*this.m_angularImpulse},initialize:function(t){var e,i,n;this.m_node1=new b2JointNode,this.m_node2=new b2JointNode,this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_body1=t.body1,this.m_body2=t.body2,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_localXAxis1=new b2Vec2,this.m_localYAxis1=new b2Vec2,this.m_linearJacobian=new b2Jacobian,this.m_motorJacobian=new b2Jacobian,e=this.m_body1.m_R,i=t.anchorPoint.x-this.m_body1.m_position.x,n=t.anchorPoint.y-this.m_body1.m_position.y,this.m_localAnchor1.Set(i*e.col1.x+n*e.col1.y,i*e.col2.x+n*e.col2.y),e=this.m_body2.m_R,i=t.anchorPoint.x-this.m_body2.m_position.x,n=t.anchorPoint.y-this.m_body2.m_position.y,this.m_localAnchor2.Set(i*e.col1.x+n*e.col1.y,i*e.col2.x+n*e.col2.y),e=this.m_body1.m_R,i=t.axis.x,n=t.axis.y,this.m_localXAxis1.Set(i*e.col1.x+n*e.col1.y,i*e.col2.x+n*e.col2.y),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_initialAngle=this.m_body2.m_rotation-this.m_body1.m_rotation,this.m_linearJacobian.SetZero(),this.m_linearMass=0,this.m_linearImpulse=0,this.m_angularMass=0,this.m_angularImpulse=0,this.m_motorJacobian.SetZero(),this.m_motorMass=0,this.m_motorImpulse=0,this.m_limitImpulse=0,this.m_limitPositionImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.motorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor},PrepareVelocitySolver:function(){var t,e=this.m_body1,i=this.m_body2,n=(t=e.m_R).col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y,o=t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y,s=(t=i.m_R).col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y,r=t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y,a=e.m_invMass,l=i.m_invMass,m=e.m_invI,c=i.m_invI,h=(t=e.m_R).col1.x*this.m_localYAxis1.x+t.col2.x*this.m_localYAxis1.y,u=t.col1.y*this.m_localYAxis1.x+t.col2.y*this.m_localYAxis1.y,_=i.m_position.x+s-e.m_position.x,p=i.m_position.y+r-e.m_position.y;if(this.m_linearJacobian.linear1.x=-h,this.m_linearJacobian.linear1.y=-u,this.m_linearJacobian.linear2.x=h,this.m_linearJacobian.linear2.y=u,this.m_linearJacobian.angular1=-(_*u-p*h),this.m_linearJacobian.angular2=s*u-r*h,this.m_linearMass=a+m*this.m_linearJacobian.angular1*this.m_linearJacobian.angular1+l+c*this.m_linearJacobian.angular2*this.m_linearJacobian.angular2,this.m_linearMass=1/this.m_linearMass,this.m_angularMass=1/(m+c),this.m_enableLimit||this.m_enableMotor){var y=(t=e.m_R).col1.x*this.m_localXAxis1.x+t.col2.x*this.m_localXAxis1.y,d=t.col1.y*this.m_localXAxis1.x+t.col2.y*this.m_localXAxis1.y;if(this.m_motorJacobian.linear1.x=-y,this.m_motorJacobian.linear1.y=-d,this.m_motorJacobian.linear2.x=y,this.m_motorJacobian.linear2.y=d,this.m_motorJacobian.angular1=-(_*d-p*y),this.m_motorJacobian.angular2=s*d-r*y,this.m_motorMass=a+m*this.m_motorJacobian.angular1*this.m_motorJacobian.angular1+l+c*this.m_motorJacobian.angular2*this.m_motorJacobian.angular2,this.m_motorMass=1/this.m_motorMass,this.m_enableLimit){var b=y*(_-n)+d*(p-o);b2Math.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?this.m_limitState=b2Joint.e_equalLimits:b<=this.m_lowerTranslation?(this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_limitImpulse=0),this.m_limitState=b2Joint.e_atLowerLimit):b>=this.m_upperTranslation?(this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_limitImpulse=0),this.m_limitState=b2Joint.e_atUpperLimit):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_limitImpulse=0)}}if(0==this.m_enableMotor&&(this.m_motorImpulse=0),0==this.m_enableLimit&&(this.m_limitImpulse=0),b2World.s_enableWarmStarting){var f=this.m_linearImpulse*this.m_linearJacobian.linear1.x+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear1.x,x=this.m_linearImpulse*this.m_linearJacobian.linear1.y+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear1.y,v=this.m_linearImpulse*this.m_linearJacobian.linear2.x+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear2.x,g=this.m_linearImpulse*this.m_linearJacobian.linear2.y+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.linear2.y,S=this.m_linearImpulse*this.m_linearJacobian.angular1-this.m_angularImpulse+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.angular1,M=this.m_linearImpulse*this.m_linearJacobian.angular2+this.m_angularImpulse+(this.m_motorImpulse+this.m_limitImpulse)*this.m_motorJacobian.angular2;e.m_linearVelocity.x+=a*f,e.m_linearVelocity.y+=a*x,e.m_angularVelocity+=m*S,i.m_linearVelocity.x+=l*v,i.m_linearVelocity.y+=l*g,i.m_angularVelocity+=c*M}else this.m_linearImpulse=0,this.m_angularImpulse=0,this.m_limitImpulse=0,this.m_motorImpulse=0;this.m_limitPositionImpulse=0},SolveVelocityConstraints:function(t){var e,i=this.m_body1,n=this.m_body2,o=i.m_invMass,s=n.m_invMass,r=i.m_invI,a=n.m_invI,l=this.m_linearJacobian.Compute(i.m_linearVelocity,i.m_angularVelocity,n.m_linearVelocity,n.m_angularVelocity),m=-this.m_linearMass*l;this.m_linearImpulse+=m,i.m_linearVelocity.x+=o*m*this.m_linearJacobian.linear1.x,i.m_linearVelocity.y+=o*m*this.m_linearJacobian.linear1.y,i.m_angularVelocity+=r*m*this.m_linearJacobian.angular1,n.m_linearVelocity.x+=s*m*this.m_linearJacobian.linear2.x,n.m_linearVelocity.y+=s*m*this.m_linearJacobian.linear2.y,n.m_angularVelocity+=a*m*this.m_linearJacobian.angular2;var c=n.m_angularVelocity-i.m_angularVelocity,h=-this.m_angularMass*c;if(this.m_angularImpulse+=h,i.m_angularVelocity-=r*h,n.m_angularVelocity+=a*h,this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits){var u=this.m_motorJacobian.Compute(i.m_linearVelocity,i.m_angularVelocity,n.m_linearVelocity,n.m_angularVelocity)-this.m_motorSpeed,_=-this.m_motorMass*u,p=this.m_motorImpulse;this.m_motorImpulse=b2Math.b2Clamp(this.m_motorImpulse+_,-t.dt*this.m_maxMotorForce,t.dt*this.m_maxMotorForce),_=this.m_motorImpulse-p,i.m_linearVelocity.x+=o*_*this.m_motorJacobian.linear1.x,i.m_linearVelocity.y+=o*_*this.m_motorJacobian.linear1.y,i.m_angularVelocity+=r*_*this.m_motorJacobian.angular1,n.m_linearVelocity.x+=s*_*this.m_motorJacobian.linear2.x,n.m_linearVelocity.y+=s*_*this.m_motorJacobian.linear2.y,n.m_angularVelocity+=a*_*this.m_motorJacobian.angular2}if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){var y=this.m_motorJacobian.Compute(i.m_linearVelocity,i.m_angularVelocity,n.m_linearVelocity,n.m_angularVelocity),d=-this.m_motorMass*y;this.m_limitState==b2Joint.e_equalLimits?this.m_limitImpulse+=d:this.m_limitState==b2Joint.e_atLowerLimit?(e=this.m_limitImpulse,this.m_limitImpulse=b2Math.b2Max(this.m_limitImpulse+d,0),d=this.m_limitImpulse-e):this.m_limitState==b2Joint.e_atUpperLimit&&(e=this.m_limitImpulse,this.m_limitImpulse=b2Math.b2Min(this.m_limitImpulse+d,0),d=this.m_limitImpulse-e),i.m_linearVelocity.x+=o*d*this.m_motorJacobian.linear1.x,i.m_linearVelocity.y+=o*d*this.m_motorJacobian.linear1.y,i.m_angularVelocity+=r*d*this.m_motorJacobian.angular1,n.m_linearVelocity.x+=s*d*this.m_motorJacobian.linear2.x,n.m_linearVelocity.y+=s*d*this.m_motorJacobian.linear2.y,n.m_angularVelocity+=a*d*this.m_motorJacobian.angular2}},SolvePositionConstraints:function(){var t,e,i,n=this.m_body1,o=this.m_body2,s=n.m_invMass,r=o.m_invMass,a=n.m_invI,l=o.m_invI,m=(i=n.m_R).col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y,c=i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y,h=(i=o.m_R).col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y,u=i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y,_=n.m_position.x+m,p=n.m_position.y+c,y=o.m_position.x+h,d=o.m_position.y+u,b=y-_,f=d-p,x=((i=n.m_R).col1.x*this.m_localYAxis1.x+i.col2.x*this.m_localYAxis1.y)*b+(i.col1.y*this.m_localYAxis1.x+i.col2.y*this.m_localYAxis1.y)*f;x=b2Math.b2Clamp(x,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);var v=-this.m_linearMass*x;n.m_position.x+=s*v*this.m_linearJacobian.linear1.x,n.m_position.y+=s*v*this.m_linearJacobian.linear1.y,n.m_rotation+=a*v*this.m_linearJacobian.angular1,o.m_position.x+=r*v*this.m_linearJacobian.linear2.x,o.m_position.y+=r*v*this.m_linearJacobian.linear2.y,o.m_rotation+=l*v*this.m_linearJacobian.angular2;var g=b2Math.b2Abs(x),S=o.m_rotation-n.m_rotation-this.m_initialAngle;S=b2Math.b2Clamp(S,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection);var M=-this.m_angularMass*S;n.m_rotation-=n.m_invI*M,n.m_R.Set(n.m_rotation),o.m_rotation+=o.m_invI*M,o.m_R.Set(o.m_rotation);var A=b2Math.b2Abs(S);if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){m=(i=n.m_R).col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y,c=i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y,h=(i=o.m_R).col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y,u=i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y,_=n.m_position.x+m,p=n.m_position.y+c,b=(y=o.m_position.x+h)-_,f=(d=o.m_position.y+u)-p;var w=((i=n.m_R).col1.x*this.m_localXAxis1.x+i.col2.x*this.m_localXAxis1.y)*b+(i.col1.y*this.m_localXAxis1.x+i.col2.y*this.m_localXAxis1.y)*f,C=0;this.m_limitState==b2Joint.e_equalLimits?(t=b2Math.b2Clamp(w,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),C=-this.m_motorMass*t,g=b2Math.b2Max(g,b2Math.b2Abs(S))):this.m_limitState==b2Joint.e_atLowerLimit?(t=w-this.m_lowerTranslation,g=b2Math.b2Max(g,-t),t=b2Math.b2Clamp(t+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),C=-this.m_motorMass*t,e=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Max(this.m_limitPositionImpulse+C,0),C=this.m_limitPositionImpulse-e):this.m_limitState==b2Joint.e_atUpperLimit&&(t=w-this.m_upperTranslation,g=b2Math.b2Max(g,t),t=b2Math.b2Clamp(t-b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection),C=-this.m_motorMass*t,e=this.m_limitPositionImpulse,this.m_limitPositionImpulse=b2Math.b2Min(this.m_limitPositionImpulse+C,0),C=this.m_limitPositionImpulse-e),n.m_position.x+=s*C*this.m_motorJacobian.linear1.x,n.m_position.y+=s*C*this.m_motorJacobian.linear1.y,n.m_rotation+=a*C*this.m_motorJacobian.angular1,n.m_R.Set(n.m_rotation),o.m_position.x+=r*C*this.m_motorJacobian.linear2.x,o.m_position.y+=r*C*this.m_motorJacobian.linear2.y,o.m_rotation+=l*C*this.m_motorJacobian.angular2,o.m_R.Set(o.m_rotation)}return g<=b2Settings.b2_linearSlop&&A<=b2Settings.b2_angularSlop},m_localAnchor1:new b2Vec2,m_localAnchor2:new b2Vec2,m_localXAxis1:new b2Vec2,m_localYAxis1:new b2Vec2,m_initialAngle:null,m_linearJacobian:new b2Jacobian,m_linearMass:null,m_linearImpulse:null,m_angularMass:null,m_angularImpulse:null,m_motorJacobian:new b2Jacobian,m_motorMass:null,m_motorImpulse:null,m_limitImpulse:null,m_limitPositionImpulse:null,m_lowerTranslation:null,m_upperTranslation:null,m_maxMotorForce:null,m_motorSpeed:null,m_enableLimit:null,m_enableMotor:null,m_limitState:0})},function(t,e){var i=Class.create();Object.extend(i.prototype,b2JointDef.prototype),Object.extend(i.prototype,{initialize:function(){this.type=b2Joint.e_unknownJoint,this.userData=null,this.body1=null,this.body2=null,this.collideConnected=!1,this.target=new b2Vec2,this.type=b2Joint.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7,this.timeStep=1/60},target:new b2Vec2,maxForce:null,frequencyHz:null,dampingRatio:null,timeStep:null})},function(t,e){var i=Class.create();Object.extend(i.prototype,b2Joint.prototype),Object.extend(i.prototype,{GetAnchor1:function(){return this.m_target},GetAnchor2:function(){var t=b2Math.b2MulMV(this.m_body2.m_R,this.m_localAnchor);return t.Add(this.m_body2.m_position),t},GetReactionForce:function(t){var e=new b2Vec2;return e.SetV(this.m_impulse),e.Multiply(t),e},GetReactionTorque:function(t){return 0},SetTarget:function(t){this.m_body2.WakeUp(),this.m_target=t},initialize:function(t){this.m_node1=new b2JointNode,this.m_node2=new b2JointNode,this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_body1=t.body1,this.m_body2=t.body2,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData,this.K=new b2Mat22,this.K1=new b2Mat22,this.K2=new b2Mat22,this.m_localAnchor=new b2Vec2,this.m_target=new b2Vec2,this.m_impulse=new b2Vec2,this.m_ptpMass=new b2Mat22,this.m_C=new b2Vec2,this.m_target.SetV(t.target);var e=this.m_target.x-this.m_body2.m_position.x,i=this.m_target.y-this.m_body2.m_position.y;this.m_localAnchor.x=e*this.m_body2.m_R.col1.x+i*this.m_body2.m_R.col1.y,this.m_localAnchor.y=e*this.m_body2.m_R.col2.x+i*this.m_body2.m_R.col2.y,this.m_maxForce=t.maxForce,this.m_impulse.SetZero();var n=this.m_body2.m_mass,o=2*b2Settings.b2_pi*t.frequencyHz,s=2*n*t.dampingRatio*o,r=n*o*o;this.m_gamma=1/(s+t.timeStep*r),this.m_beta=t.timeStep*r/(s+t.timeStep*r)},K:new b2Mat22,K1:new b2Mat22,K2:new b2Mat22,PrepareVelocitySolver:function(){var t,e=this.m_body2,i=(t=e.m_R).col1.x*this.m_localAnchor.x+t.col2.x*this.m_localAnchor.y,n=t.col1.y*this.m_localAnchor.x+t.col2.y*this.m_localAnchor.y,o=e.m_invMass,s=e.m_invI;this.K1.col1.x=o,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=o,this.K2.col1.x=s*n*n,this.K2.col2.x=-s*i*n,this.K2.col1.y=-s*i*n,this.K2.col2.y=s*i*i,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.Invert(this.m_ptpMass),this.m_C.x=e.m_position.x+i-this.m_target.x,this.m_C.y=e.m_position.y+n-this.m_target.y,e.m_angularVelocity*=.98;var r=this.m_impulse.x,a=this.m_impulse.y;e.m_linearVelocity.x+=o*r,e.m_linearVelocity.y+=o*a,e.m_angularVelocity+=s*(i*a-n*r)},SolveVelocityConstraints:function(t){var e,i=this.m_body2,n=(e=i.m_R).col1.x*this.m_localAnchor.x+e.col2.x*this.m_localAnchor.y,o=e.col1.y*this.m_localAnchor.x+e.col2.y*this.m_localAnchor.y,s=i.m_linearVelocity.x+-i.m_angularVelocity*o,r=i.m_linearVelocity.y+i.m_angularVelocity*n;e=this.m_ptpMass;var a=s+this.m_beta*t.inv_dt*this.m_C.x+this.m_gamma*this.m_impulse.x,l=r+this.m_beta*t.inv_dt*this.m_C.y+this.m_gamma*this.m_impulse.y,m=-(e.col1.x*a+e.col2.x*l),c=-(e.col1.y*a+e.col2.y*l),h=this.m_impulse.x,u=this.m_impulse.y;this.m_impulse.x+=m,this.m_impulse.y+=c;var _=this.m_impulse.Length();_>t.dt*this.m_maxForce&&this.m_impulse.Multiply(t.dt*this.m_maxForce/_),m=this.m_impulse.x-h,c=this.m_impulse.y-u,i.m_linearVelocity.x+=i.m_invMass*m,i.m_linearVelocity.y+=i.m_invMass*c,i.m_angularVelocity+=i.m_invI*(n*c-o*m)},SolvePositionConstraints:function(){return!0},m_localAnchor:new b2Vec2,m_target:new b2Vec2,m_impulse:new b2Vec2,m_ptpMass:new b2Mat22,m_C:new b2Vec2,m_maxForce:null,m_beta:null,m_gamma:null})},function(t,e){Class.create().prototype={other:null,joint:null,prev:null,next:null,initialize:function(){}}},function(t,e){Class.create().prototype={initialize:function(){this.type=b2Joint.e_unknownJoint,this.userData=null,this.body1=null,this.body2=null,this.collideConnected=!1},type:0,userData:null,body1:null,body2:null,collideConnected:null}},function(t,e){var i=Class.create();i.prototype={GetType:function(){return this.m_type},GetAnchor1:function(){return null},GetAnchor2:function(){return null},GetReactionForce:function(t){return null},GetReactionTorque:function(t){return 0},GetBody1:function(){return this.m_body1},GetBody2:function(){return this.m_body2},GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},initialize:function(t){this.m_node1=new b2JointNode,this.m_node2=new b2JointNode,this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_body1=t.body1,this.m_body2=t.body2,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData},PrepareVelocitySolver:function(){},SolveVelocityConstraints:function(t){},PreparePositionSolver:function(){},SolvePositionConstraints:function(){return!1},m_type:0,m_prev:null,m_next:null,m_node1:new b2JointNode,m_node2:new b2JointNode,m_body1:null,m_body2:null,m_islandFlag:null,m_collideConnected:null,m_userData:null},i.Create=function(t,e){var n=null;switch(t.type){case i.e_distanceJoint:n=new b2DistanceJoint(t);break;case i.e_mouseJoint:n=new b2MouseJoint(t);break;case i.e_prismaticJoint:n=new b2PrismaticJoint(t);break;case i.e_revoluteJoint:n=new b2RevoluteJoint(t);break;case i.e_pulleyJoint:n=new b2PulleyJoint(t);break;case i.e_gearJoint:n=new b2GearJoint(t)}return n},i.Destroy=function(t,e){},i.e_unknownJoint=0,i.e_revoluteJoint=1,i.e_prismaticJoint=2,i.e_distanceJoint=3,i.e_pulleyJoint=4,i.e_mouseJoint=5,i.e_gearJoint=6,i.e_inactiveLimit=0,i.e_atLowerLimit=1,i.e_atUpperLimit=2,i.e_equalLimits=3},function(t,e){Class.create().prototype={linear1:new b2Vec2,angular1:null,linear2:new b2Vec2,angular2:null,SetZero:function(){this.linear1.SetZero(),this.angular1=0,this.linear2.SetZero(),this.angular2=0},Set:function(t,e,i,n){this.linear1.SetV(t),this.angular1=e,this.linear2.SetV(i),this.angular2=n},Compute:function(t,e,i,n){return this.linear1.x*t.x+this.linear1.y*t.y+this.angular1*e+(this.linear2.x*i.x+this.linear2.y*i.y)+this.angular2*n},initialize:function(){this.linear1=new b2Vec2,this.linear2=new b2Vec2}}},function(t,e){var i=Class.create();Object.extend(i.prototype,b2JointDef.prototype),Object.extend(i.prototype,{initialize:function(){this.type=b2Joint.e_gearJoint,this.joint1=null,this.joint2=null,this.ratio=1},joint1:null,joint2:null,ratio:null})},function(t,e){var i=Class.create();Object.extend(i.prototype,b2Joint.prototype),Object.extend(i.prototype,{GetAnchor1:function(){var t=this.m_body1.m_R;return new b2Vec2(this.m_body1.m_position.x+(t.col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y),this.m_body1.m_position.y+(t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y))},GetAnchor2:function(){var t=this.m_body2.m_R;return new b2Vec2(this.m_body2.m_position.x+(t.col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y),this.m_body2.m_position.y+(t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y))},GetReactionForce:function(t){return new b2Vec2},GetReactionTorque:function(t){return 0},GetRatio:function(){return this.m_ratio},initialize:function(t){var e,i;this.m_node1=new b2JointNode,this.m_node2=new b2JointNode,this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_body1=t.body1,this.m_body2=t.body2,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData,this.m_groundAnchor1=new b2Vec2,this.m_groundAnchor2=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_J=new b2Jacobian,this.m_revolute1=null,this.m_prismatic1=null,this.m_revolute2=null,this.m_prismatic2=null,this.m_ground1=t.joint1.m_body1,this.m_body1=t.joint1.m_body2,t.joint1.m_type==b2Joint.e_revoluteJoint?(this.m_revolute1=t.joint1,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),e=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=t.joint1,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),e=this.m_prismatic1.GetJointTranslation()),this.m_ground2=t.joint2.m_body1,this.m_body2=t.joint2.m_body2,t.joint2.m_type==b2Joint.e_revoluteJoint?(this.m_revolute2=t.joint2,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),i=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=t.joint2,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),i=this.m_prismatic2.GetJointTranslation()),this.m_ratio=t.ratio,this.m_constant=e+this.m_ratio*i,this.m_impulse=0},PrepareVelocitySolver:function(){var t,e,i,n,o,s=this.m_ground1,r=this.m_ground2,a=this.m_body1,l=this.m_body2,m=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angular1=-1,m+=a.m_invI):(i=s.m_R,n=this.m_prismatic1.m_localXAxis1,t=i.col1.x*n.x+i.col2.x*n.y,e=i.col1.y*n.x+i.col2.y*n.y,o=((i=a.m_R).col1.x*this.m_localAnchor1.x+i.col2.x*this.m_localAnchor1.y)*e-(i.col1.y*this.m_localAnchor1.x+i.col2.y*this.m_localAnchor1.y)*t,this.m_J.linear1.Set(-t,-e),this.m_J.angular1=-o,m+=a.m_invMass+a.m_invI*o*o),this.m_revolute2?(this.m_J.angular2=-this.m_ratio,m+=this.m_ratio*this.m_ratio*l.m_invI):(i=r.m_R,n=this.m_prismatic2.m_localXAxis1,t=i.col1.x*n.x+i.col2.x*n.y,e=i.col1.y*n.x+i.col2.y*n.y,o=((i=l.m_R).col1.x*this.m_localAnchor2.x+i.col2.x*this.m_localAnchor2.y)*e-(i.col1.y*this.m_localAnchor2.x+i.col2.y*this.m_localAnchor2.y)*t,this.m_J.linear2.Set(-this.m_ratio*t,-this.m_ratio*e),this.m_J.angular2=-this.m_ratio*o,m+=this.m_ratio*this.m_ratio*(l.m_invMass+l.m_invI*o*o)),this.m_mass=1/m,a.m_linearVelocity.x+=a.m_invMass*this.m_impulse*this.m_J.linear1.x,a.m_linearVelocity.y+=a.m_invMass*this.m_impulse*this.m_J.linear1.y,a.m_angularVelocity+=a.m_invI*this.m_impulse*this.m_J.angular1,l.m_linearVelocity.x+=l.m_invMass*this.m_impulse*this.m_J.linear2.x,l.m_linearVelocity.y+=l.m_invMass*this.m_impulse*this.m_J.linear2.y,l.m_angularVelocity+=l.m_invI*this.m_impulse*this.m_J.angular2},SolveVelocityConstraints:function(t){var e=this.m_body1,i=this.m_body2,n=this.m_J.Compute(e.m_linearVelocity,e.m_angularVelocity,i.m_linearVelocity,i.m_angularVelocity),o=-this.m_mass*n;this.m_impulse+=o,e.m_linearVelocity.x+=e.m_invMass*o*this.m_J.linear1.x,e.m_linearVelocity.y+=e.m_invMass*o*this.m_J.linear1.y,e.m_angularVelocity+=e.m_invI*o*this.m_J.angular1,i.m_linearVelocity.x+=i.m_invMass*o*this.m_J.linear2.x,i.m_linearVelocity.y+=i.m_invMass*o*this.m_J.linear2.y,i.m_angularVelocity+=i.m_invI*o*this.m_J.angular2},SolvePositionConstraints:function(){var t,e,i=this.m_body1,n=this.m_body2;t=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),e=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation();var o=this.m_constant-(t+this.m_ratio*e),s=-this.m_mass*o;return i.m_position.x+=i.m_invMass*s*this.m_J.linear1.x,i.m_position.y+=i.m_invMass*s*this.m_J.linear1.y,i.m_rotation+=i.m_invI*s*this.m_J.angular1,n.m_position.x+=n.m_invMass*s*this.m_J.linear2.x,n.m_position.y+=n.m_invMass*s*this.m_J.linear2.y,n.m_rotation+=n.m_invI*s*this.m_J.angular2,i.m_R.Set(i.m_rotation),n.m_R.Set(n.m_rotation),0<b2Settings.b2_linearSlop},m_ground1:null,m_ground2:null,m_revolute1:null,m_prismatic1:null,m_revolute2:null,m_prismatic2:null,m_groundAnchor1:new b2Vec2,m_groundAnchor2:new b2Vec2,m_localAnchor1:new b2Vec2,m_localAnchor2:new b2Vec2,m_J:new b2Jacobian,m_constant:null,m_ratio:null,m_mass:null,m_impulse:null})},function(t,e){var i=Class.create();Object.extend(i.prototype,b2JointDef.prototype),Object.extend(i.prototype,{initialize:function(){this.type=b2Joint.e_unknownJoint,this.userData=null,this.body1=null,this.body2=null,this.collideConnected=!1,this.anchorPoint1=new b2Vec2,this.anchorPoint2=new b2Vec2,this.type=b2Joint.e_distanceJoint},anchorPoint1:new b2Vec2,anchorPoint2:new b2Vec2})},function(t,e){var i=Class.create();Object.extend(i.prototype,b2Joint.prototype),Object.extend(i.prototype,{initialize:function(t){var e,i,n;this.m_node1=new b2JointNode,this.m_node2=new b2JointNode,this.m_type=t.type,this.m_prev=null,this.m_next=null,this.m_body1=t.body1,this.m_body2=t.body2,this.m_collideConnected=t.collideConnected,this.m_islandFlag=!1,this.m_userData=t.userData,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_u=new b2Vec2,e=this.m_body1.m_R,i=t.anchorPoint1.x-this.m_body1.m_position.x,n=t.anchorPoint1.y-this.m_body1.m_position.y,this.m_localAnchor1.x=i*e.col1.x+n*e.col1.y,this.m_localAnchor1.y=i*e.col2.x+n*e.col2.y,e=this.m_body2.m_R,i=t.anchorPoint2.x-this.m_body2.m_position.x,n=t.anchorPoint2.y-this.m_body2.m_position.y,this.m_localAnchor2.x=i*e.col1.x+n*e.col1.y,this.m_localAnchor2.y=i*e.col2.x+n*e.col2.y,i=t.anchorPoint2.x-t.anchorPoint1.x,n=t.anchorPoint2.y-t.anchorPoint1.y,this.m_length=Math.sqrt(i*i+n*n),this.m_impulse=0},PrepareVelocitySolver:function(){var t,e=(t=this.m_body1.m_R).col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y,i=t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y,n=(t=this.m_body2.m_R).col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y,o=t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y;this.m_u.x=this.m_body2.m_position.x+n-this.m_body1.m_position.x-e,this.m_u.y=this.m_body2.m_position.y+o-this.m_body1.m_position.y-i;var s=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);s>b2Settings.b2_linearSlop?this.m_u.Multiply(1/s):this.m_u.SetZero();var r=e*this.m_u.y-i*this.m_u.x,a=n*this.m_u.y-o*this.m_u.x;if(this.m_mass=this.m_body1.m_invMass+this.m_body1.m_invI*r*r+this.m_body2.m_invMass+this.m_body2.m_invI*a*a,this.m_mass=1/this.m_mass,b2World.s_enableWarmStarting){var l=this.m_impulse*this.m_u.x,m=this.m_impulse*this.m_u.y;this.m_body1.m_linearVelocity.x-=this.m_body1.m_invMass*l,this.m_body1.m_linearVelocity.y-=this.m_body1.m_invMass*m,this.m_body1.m_angularVelocity-=this.m_body1.m_invI*(e*m-i*l),this.m_body2.m_linearVelocity.x+=this.m_body2.m_invMass*l,this.m_body2.m_linearVelocity.y+=this.m_body2.m_invMass*m,this.m_body2.m_angularVelocity+=this.m_body2.m_invI*(n*m-o*l)}else this.m_impulse=0},SolveVelocityConstraints:function(t){var e,i=(e=this.m_body1.m_R).col1.x*this.m_localAnchor1.x+e.col2.x*this.m_localAnchor1.y,n=e.col1.y*this.m_localAnchor1.x+e.col2.y*this.m_localAnchor1.y,o=(e=this.m_body2.m_R).col1.x*this.m_localAnchor2.x+e.col2.x*this.m_localAnchor2.y,s=e.col1.y*this.m_localAnchor2.x+e.col2.y*this.m_localAnchor2.y,r=this.m_body1.m_linearVelocity.x+-this.m_body1.m_angularVelocity*n,a=this.m_body1.m_linearVelocity.y+this.m_body1.m_angularVelocity*i,l=this.m_body2.m_linearVelocity.x+-this.m_body2.m_angularVelocity*s,m=this.m_body2.m_linearVelocity.y+this.m_body2.m_angularVelocity*o,c=this.m_u.x*(l-r)+this.m_u.y*(m-a),h=-this.m_mass*c;this.m_impulse+=h;var u=h*this.m_u.x,_=h*this.m_u.y;this.m_body1.m_linearVelocity.x-=this.m_body1.m_invMass*u,this.m_body1.m_linearVelocity.y-=this.m_body1.m_invMass*_,this.m_body1.m_angularVelocity-=this.m_body1.m_invI*(i*_-n*u),this.m_body2.m_linearVelocity.x+=this.m_body2.m_invMass*u,this.m_body2.m_linearVelocity.y+=this.m_body2.m_invMass*_,this.m_body2.m_angularVelocity+=this.m_body2.m_invI*(o*_-s*u)},SolvePositionConstraints:function(){var t,e=(t=this.m_body1.m_R).col1.x*this.m_localAnchor1.x+t.col2.x*this.m_localAnchor1.y,i=t.col1.y*this.m_localAnchor1.x+t.col2.y*this.m_localAnchor1.y,n=(t=this.m_body2.m_R).col1.x*this.m_localAnchor2.x+t.col2.x*this.m_localAnchor2.y,o=t.col1.y*this.m_localAnchor2.x+t.col2.y*this.m_localAnchor2.y,s=this.m_body2.m_position.x+n-this.m_body1.m_position.x-e,r=this.m_body2.m_position.y+o-this.m_body1.m_position.y-i,a=Math.sqrt(s*s+r*r);s/=a,r/=a;var l=a-this.m_length;l=b2Math.b2Clamp(l,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);var m=-this.m_mass*l;this.m_u.Set(s,r);var c=m*this.m_u.x,h=m*this.m_u.y;return this.m_body1.m_position.x-=this.m_body1.m_invMass*c,this.m_body1.m_position.y-=this.m_body1.m_invMass*h,this.m_body1.m_rotation-=this.m_body1.m_invI*(e*h-i*c),this.m_body2.m_position.x+=this.m_body2.m_invMass*c,this.m_body2.m_position.y+=this.m_body2.m_invMass*h,this.m_body2.m_rotation+=this.m_body2.m_invI*(n*h-o*c),this.m_body1.m_R.Set(this.m_body1.m_rotation),this.m_body2.m_R.Set(this.m_body2.m_rotation),b2Math.b2Abs(l)<b2Settings.b2_linearSlop},GetAnchor1:function(){return b2Math.AddVV(this.m_body1.m_position,b2Math.b2MulMV(this.m_body1.m_R,this.m_localAnchor1))},GetAnchor2:function(){return b2Math.AddVV(this.m_body2.m_position,b2Math.b2MulMV(this.m_body2.m_R,this.m_localAnchor2))},GetReactionForce:function(t){var e=new b2Vec2;return e.SetV(this.m_u),e.Multiply(this.m_impulse*t),e},GetReactionTorque:function(t){return 0},m_localAnchor1:new b2Vec2,m_localAnchor2:new b2Vec2,m_u:new b2Vec2,m_impulse:null,m_mass:null,m_length:null})},function(t,e){var i=Class.create();Object.extend(i.prototype,b2Contact.prototype),Object.extend(i.prototype,{initialize:function(t,e){if(this.m_node1=new b2ContactNode,this.m_node2=new b2ContactNode,this.m_flags=0,!t||!e)return this.m_shape1=null,void(this.m_shape2=null);this.m_shape1=t,this.m_shape2=e,this.m_manifoldCount=0,this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction),this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution),this.m_prev=null,this.m_next=null,this.m_node1.contact=null,this.m_node1.prev=null,this.m_node1.next=null,this.m_node1.other=null,this.m_node2.contact=null,this.m_node2.prev=null,this.m_node2.next=null,this.m_node2.other=null,this.m0=new b2Manifold,this.m_manifold=[new b2Manifold],this.m_manifold[0].pointCount=0},m0:new b2Manifold,Evaluate:function(){for(var t=this.m_manifold[0],e=this.m0.points,i=0;i<t.pointCount;i++){var n=e[i],o=t.points[i];n.normalImpulse=o.normalImpulse,n.tangentImpulse=o.tangentImpulse,n.id=o.id.Copy()}if(this.m0.pointCount=t.pointCount,b2Collision.b2CollidePoly(t,this.m_shape1,this.m_shape2,!1),t.pointCount>0){for(var s=[!1,!1],r=0;r<t.pointCount;++r){var a=t.points[r];a.normalImpulse=0,a.tangentImpulse=0;for(var l=a.id.key,m=0;m<this.m0.pointCount;++m)if(1!=s[m]){var c=this.m0.points[m];if(c.id.key==l){s[m]=!0,a.normalImpulse=c.normalImpulse,a.tangentImpulse=c.tangentImpulse;break}}}this.m_manifoldCount=1}else this.m_manifoldCount=0},GetManifolds:function(){return this.m_manifold},m_manifold:[new b2Manifold]}),i.Create=function(t,e,n){return new i(t,e)},i.Destroy=function(t,e){}},function(t,e){var i=Class.create();Object.extend(i.prototype,b2Contact.prototype),Object.extend(i.prototype,{initialize:function(t,e){if(this.m_node1=new b2ContactNode,this.m_node2=new b2ContactNode,this.m_flags=0,!t||!e)return this.m_shape1=null,void(this.m_shape2=null);this.m_shape1=t,this.m_shape2=e,this.m_manifoldCount=0,this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction),this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution),this.m_prev=null,this.m_next=null,this.m_node1.contact=null,this.m_node1.prev=null,this.m_node1.next=null,this.m_node1.other=null,this.m_node2.contact=null,this.m_node2.prev=null,this.m_node2.next=null,this.m_node2.other=null,this.m_manifold=[new b2Manifold],b2Settings.b2Assert(this.m_shape1.m_type==b2Shape.e_polyShape),b2Settings.b2Assert(this.m_shape2.m_type==b2Shape.e_circleShape),this.m_manifold[0].pointCount=0,this.m_manifold[0].points[0].normalImpulse=0,this.m_manifold[0].points[0].tangentImpulse=0},Evaluate:function(){b2Collision.b2CollidePolyAndCircle(this.m_manifold[0],this.m_shape1,this.m_shape2,!1),this.m_manifold[0].pointCount>0?this.m_manifoldCount=1:this.m_manifoldCount=0},GetManifolds:function(){return this.m_manifold},m_manifold:[new b2Manifold]}),i.Create=function(t,e,n){return new i(t,e)},i.Destroy=function(t,e){}},function(t,e){var i=Class.create();Object.extend(i.prototype,b2Contact.prototype),Object.extend(i.prototype,{initialize:function(t,e){if(this.m_node1=new b2ContactNode,this.m_node2=new b2ContactNode,this.m_flags=0,!t||!e)return this.m_shape1=null,void(this.m_shape2=null);this.m_shape1=t,this.m_shape2=e,this.m_manifoldCount=0,this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction),this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution),this.m_prev=null,this.m_next=null,this.m_node1.contact=null,this.m_node1.prev=null,this.m_node1.next=null,this.m_node1.other=null,this.m_node2.contact=null,this.m_node2.prev=null,this.m_node2.next=null,this.m_node2.other=null},Evaluate:function(){},GetManifolds:function(){return null}})},function(t,e){Class.create().prototype={initialize:function(t,e,i){this.m_constraints=new Array,this.m_allocator=i;var n,o,s=0;for(this.m_constraintCount=0,s=0;s<e;++s)this.m_constraintCount+=t[s].GetManifoldCount();for(s=0;s<this.m_constraintCount;s++)this.m_constraints[s]=new b2ContactConstraint;var r=0;for(s=0;s<e;++s)for(var a=t[s],l=a.m_shape1.m_body,m=a.m_shape2.m_body,c=a.GetManifoldCount(),h=a.GetManifolds(),u=a.m_friction,_=a.m_restitution,p=l.m_linearVelocity.x,y=l.m_linearVelocity.y,d=m.m_linearVelocity.x,b=m.m_linearVelocity.y,f=l.m_angularVelocity,x=m.m_angularVelocity,v=0;v<c;++v){var g=h[v],S=g.normal.x,M=g.normal.y,A=this.m_constraints[r];A.body1=l,A.body2=m,A.manifold=g,A.normal.x=S,A.normal.y=M,A.pointCount=g.pointCount,A.friction=u,A.restitution=_;for(var w=0;w<A.pointCount;++w){var C=g.points[w],V=A.points[w];V.normalImpulse=C.normalImpulse,V.tangentImpulse=C.tangentImpulse,V.separation=C.separation;var I=C.position.x-l.m_position.x,P=C.position.y-l.m_position.y,E=C.position.x-m.m_position.x,B=C.position.y-m.m_position.y;n=V.localAnchor1,o=l.m_R,n.x=I*o.col1.x+P*o.col1.y,n.y=I*o.col2.x+P*o.col2.y,n=V.localAnchor2,o=m.m_R,n.x=E*o.col1.x+B*o.col1.y,n.y=E*o.col2.x+B*o.col2.y;var O=I*I+P*P,R=E*E+B*B,T=I*S+P*M,L=E*S+B*M,j=l.m_invMass+m.m_invMass;j+=l.m_invI*(O-T*T)+m.m_invI*(R-L*L),V.normalMass=1/j;var N=-S,F=I*M+P*N,J=E*M+B*N,D=l.m_invMass+m.m_invMass;D+=l.m_invI*(O-F*F)+m.m_invI*(R-J*J),V.tangentMass=1/D,V.velocityBias=0,V.separation>0&&(V.velocityBias=-60*V.separation);var k=d+-x*B-p- -f*P,$=b+x*E-y-f*I,z=A.normal.x*k+A.normal.y*$;z<-b2Settings.b2_velocityThreshold&&(V.velocityBias+=-A.restitution*z)}++r}},PreSolve:function(){for(var t,e,i=0;i<this.m_constraintCount;++i){var n=this.m_constraints[i],o=n.body1,s=n.body2,r=o.m_invMass,a=o.m_invI,l=s.m_invMass,m=s.m_invI,c=n.normal.x,h=n.normal.y,u=h,_=-c,p=0,y=0;if(b2World.s_enableWarmStarting)for(y=n.pointCount,p=0;p<y;++p){var d=n.points[p],b=d.normalImpulse*c+d.tangentImpulse*u,f=d.normalImpulse*h+d.tangentImpulse*_;e=o.m_R,t=d.localAnchor1;var x=e.col1.x*t.x+e.col2.x*t.y,v=e.col1.y*t.x+e.col2.y*t.y;e=s.m_R,t=d.localAnchor2;var g=e.col1.x*t.x+e.col2.x*t.y,S=e.col1.y*t.x+e.col2.y*t.y;o.m_angularVelocity-=a*(x*f-v*b),o.m_linearVelocity.x-=r*b,o.m_linearVelocity.y-=r*f,s.m_angularVelocity+=m*(g*f-S*b),s.m_linearVelocity.x+=l*b,s.m_linearVelocity.y+=l*f,d.positionImpulse=0}else for(y=n.pointCount,p=0;p<y;++p){var M=n.points[p];M.normalImpulse=0,M.tangentImpulse=0,M.positionImpulse=0}}},SolveVelocityConstraints:function(){for(var t,e,i,n,o,s,r,a,l,m,c,h=0,u=0;u<this.m_constraintCount;++u){var _=this.m_constraints[u],p=_.body1,y=_.body2,d=p.m_angularVelocity,b=p.m_linearVelocity,f=y.m_angularVelocity,x=y.m_linearVelocity,v=p.m_invMass,g=p.m_invI,S=y.m_invMass,M=y.m_invI,A=_.normal.x,w=_.normal.y,C=w,V=-A,I=_.pointCount;for(h=0;h<I;++h){t=_.points[h],m=p.m_R,c=t.localAnchor1,e=m.col1.x*c.x+m.col2.x*c.y,i=m.col1.y*c.x+m.col2.y*c.y,m=y.m_R,c=t.localAnchor2,n=m.col1.x*c.x+m.col2.x*c.y,o=m.col1.y*c.x+m.col2.y*c.y;var P=(x.x+-f*o-b.x- -d*i)*A+(x.y+f*n-b.y-d*e)*w;s=-t.normalMass*(P-t.velocityBias),a=(s=(r=b2Math.b2Max(t.normalImpulse+s,0))-t.normalImpulse)*A,l=s*w,b.x-=v*a,b.y-=v*l,d-=g*(e*l-i*a),x.x+=S*a,x.y+=S*l,f+=M*(n*l-o*a),t.normalImpulse=r;var E=(x.x+-f*o-b.x- -d*i)*C+(x.y+f*n-b.y-d*e)*V;s=t.tangentMass*-E;var B=_.friction*t.normalImpulse;a=(s=(r=b2Math.b2Clamp(t.tangentImpulse+s,-B,B))-t.tangentImpulse)*C,l=s*V,b.x-=v*a,b.y-=v*l,d-=g*(e*l-i*a),x.x+=S*a,x.y+=S*l,f+=M*(n*l-o*a),t.tangentImpulse=r}p.m_angularVelocity=d,y.m_angularVelocity=f}},SolvePositionConstraints:function(t){for(var e,i,n=0,o=0;o<this.m_constraintCount;++o){for(var s=this.m_constraints[o],r=s.body1,a=s.body2,l=r.m_position,m=r.m_rotation,c=a.m_position,h=a.m_rotation,u=r.m_invMass,_=r.m_invI,p=a.m_invMass,y=a.m_invI,d=s.normal.x,b=s.normal.y,f=s.pointCount,x=0;x<f;++x){var v=s.points[x];e=r.m_R,i=v.localAnchor1;var g=e.col1.x*i.x+e.col2.x*i.y,S=e.col1.y*i.x+e.col2.y*i.y;e=a.m_R,i=v.localAnchor2;var M=e.col1.x*i.x+e.col2.x*i.y,A=e.col1.y*i.x+e.col2.y*i.y,w=l.x+g,C=l.y+S,V=(c.x+M-w)*d+(c.y+A-C)*b+v.separation;n=b2Math.b2Min(n,V);var I=t*b2Math.b2Clamp(V+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),P=-v.normalMass*I,E=v.positionImpulse;v.positionImpulse=b2Math.b2Max(E+P,0);var B=(P=v.positionImpulse-E)*d,O=P*b;l.x-=u*B,l.y-=u*O,m-=_*(g*O-S*B),r.m_R.Set(m),c.x+=p*B,c.y+=p*O,h+=y*(M*O-A*B),a.m_R.Set(h)}r.m_rotation=m,a.m_rotation=h}return n>=-b2Settings.b2_linearSlop},PostSolve:function(){for(var t=0;t<this.m_constraintCount;++t)for(var e=this.m_constraints[t],i=e.manifold,n=0;n<e.pointCount;++n){var o=i.points[n],s=e.points[n];o.normalImpulse=s.normalImpulse,o.tangentImpulse=s.tangentImpulse}},m_allocator:null,m_constraints:new Array,m_constraintCount:0}},function(t,e){Class.create().prototype={createFcn:null,destroyFcn:null,primary:null,initialize:function(){}}},function(t,e){Class.create().prototype={other:null,contact:null,prev:null,next:null,initialize:function(){}}},function(t,e){Class.create().prototype={localAnchor1:new b2Vec2,localAnchor2:new b2Vec2,normalImpulse:null,tangentImpulse:null,positionImpulse:null,normalMass:null,tangentMass:null,separation:null,velocityBias:null,initialize:function(){this.localAnchor1=new b2Vec2,this.localAnchor2=new b2Vec2}}},function(t,e){Class.create().prototype={initialize:function(){this.normal=new b2Vec2,this.points=new Array(b2Settings.b2_maxManifoldPoints);for(var t=0;t<b2Settings.b2_maxManifoldPoints;t++)this.points[t]=new b2ContactConstraintPoint},points:null,normal:new b2Vec2,manifold:null,body1:null,body2:null,friction:null,restitution:null,pointCount:0}},function(t,e){var i=Class.create();i.prototype={GetManifolds:function(){return null},GetManifoldCount:function(){return this.m_manifoldCount},GetNext:function(){return this.m_next},GetShape1:function(){return this.m_shape1},GetShape2:function(){return this.m_shape2},initialize:function(t,e){if(this.m_node1=new b2ContactNode,this.m_node2=new b2ContactNode,this.m_flags=0,!t||!e)return this.m_shape1=null,void(this.m_shape2=null);this.m_shape1=t,this.m_shape2=e,this.m_manifoldCount=0,this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction),this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution),this.m_prev=null,this.m_next=null,this.m_node1.contact=null,this.m_node1.prev=null,this.m_node1.next=null,this.m_node1.other=null,this.m_node2.contact=null,this.m_node2.prev=null,this.m_node2.next=null,this.m_node2.other=null},Evaluate:function(){},m_flags:0,m_prev:null,m_next:null,m_node1:new b2ContactNode,m_node2:new b2ContactNode,m_shape1:null,m_shape2:null,m_manifoldCount:0,m_friction:null,m_restitution:null},i.e_islandFlag=1,i.e_destroyFlag=2,i.AddType=function(t,e,n,o){i.s_registers[n][o].createFcn=t,i.s_registers[n][o].destroyFcn=e,i.s_registers[n][o].primary=!0,n!=o&&(i.s_registers[o][n].createFcn=t,i.s_registers[o][n].destroyFcn=e,i.s_registers[o][n].primary=!1)},i.InitializeRegisters=function(){i.s_registers=new Array(b2Shape.e_shapeTypeCount);for(var t=0;t<b2Shape.e_shapeTypeCount;t++){i.s_registers[t]=new Array(b2Shape.e_shapeTypeCount);for(var e=0;e<b2Shape.e_shapeTypeCount;e++)i.s_registers[t][e]=new b2ContactRegister}i.AddType(b2CircleContact.Create,b2CircleContact.Destroy,b2Shape.e_circleShape,b2Shape.e_circleShape),i.AddType(b2PolyAndCircleContact.Create,b2PolyAndCircleContact.Destroy,b2Shape.e_polyShape,b2Shape.e_circleShape),i.AddType(b2PolyContact.Create,b2PolyContact.Destroy,b2Shape.e_polyShape,b2Shape.e_polyShape)},i.Create=function(t,e,n){0==i.s_initialized&&(i.InitializeRegisters(),i.s_initialized=!0);var o=t.m_type,s=e.m_type,r=i.s_registers[o][s].createFcn;if(r){if(i.s_registers[o][s].primary)return r(t,e,n);for(var a=r(e,t,n),l=0;l<a.GetManifoldCount();++l){var m=a.GetManifolds()[l];m.normal=m.normal.Negative()}return a}return null},i.Destroy=function(t,e){t.GetManifoldCount()>0&&(t.m_shape1.m_body.WakeUp(),t.m_shape2.m_body.WakeUp());var n=t.m_shape1.m_type,o=t.m_shape2.m_type;(0,i.s_registers[n][o].destroyFcn)(t,e)},i.s_registers=null,i.s_initialized=!1},function(t,e){var i=Class.create();i.prototype={initialize:function(){}},i.R1=new b2Mat22,i.R2=new b2Mat22,i.x1=new b2Vec2,i.x2=new b2Vec2,i.Conservative=function(t,e){var n=t.GetBody(),o=e.GetBody(),s=n.m_position.x-n.m_position0.x,r=n.m_position.y-n.m_position0.y,a=n.m_rotation-n.m_rotation0,l=o.m_position.x-o.m_position0.x,m=o.m_position.y-o.m_position0.y,c=o.m_rotation-o.m_rotation0,h=t.GetMaxRadius(),u=e.GetMaxRadius(),_=n.m_position0.x,p=n.m_position0.y,y=n.m_rotation0,b=o.m_position0.x,f=o.m_position0.y,x=o.m_rotation0,v=_,g=p,S=y,M=b,A=f,w=x;i.R1.Set(S),i.R2.Set(w),t.QuickSync(p1,i.R1),e.QuickSync(p2,i.R2);for(var C,V,I=0,P=0,E=!0,B=0;B<10;++B){var O=b2Distance.Distance(i.x1,i.x2,t,e);if(O<b2Settings.b2_linearSlop){E=0!=B;break}if(0==B){C=i.x2.x-i.x1.x,V=i.x2.y-i.x1.y;Math.sqrt(C*C+V*V);var R=C*(s-l)+V*(r-m)+Math.abs(a)*h+Math.abs(c)*u;if(Math.abs(R)<Number.MIN_VALUE){E=!1;break}P=1/R}var T=I+O*P;if(T<0||1<T){E=!1;break}if(T<(1+100*Number.MIN_VALUE)*I){E=!0;break}v=_+(I=T)*v1.x,g=p+I*v1.y,S=y+I*a,M=b+I*v2.x,A=f+I*v2.y,w=x+I*c,i.R1.Set(S),i.R2.Set(w),t.QuickSync(p1,i.R1),e.QuickSync(p2,i.R2)}if(E){C=i.x2.x-i.x1.x,V=i.x2.y-i.x1.y;var L=Math.sqrt(C*C+V*V);return L>FLT_EPSILON&&(d*=b2_linearSlop/L),n.IsStatic()?(n.m_position.x=v,n.m_position.y=g):(n.m_position.x=v-C,n.m_position.y=g-V),n.m_rotation=S,n.m_R.Set(S),n.QuickSyncShapes(),o.IsStatic()?(o.m_position.x=M,o.m_position.y=A):(o.m_position.x=M+C,o.m_position.y=A+V),o.m_position.x=M+C,o.m_position.y=A+V,o.m_rotation=w,o.m_R.Set(w),o.QuickSyncShapes(),!0}return t.QuickSync(n.m_position,n.m_R),e.QuickSync(o.m_position,o.m_R),!1}},function(t,e){var i=Class.create();Object.extend(i.prototype,b2Contact.prototype),Object.extend(i.prototype,{initialize:function(t,e){if(this.m_node1=new b2ContactNode,this.m_node2=new b2ContactNode,this.m_flags=0,!t||!e)return this.m_shape1=null,void(this.m_shape2=null);this.m_shape1=t,this.m_shape2=e,this.m_manifoldCount=0,this.m_friction=Math.sqrt(this.m_shape1.m_friction*this.m_shape2.m_friction),this.m_restitution=b2Math.b2Max(this.m_shape1.m_restitution,this.m_shape2.m_restitution),this.m_prev=null,this.m_next=null,this.m_node1.contact=null,this.m_node1.prev=null,this.m_node1.next=null,this.m_node1.other=null,this.m_node2.contact=null,this.m_node2.prev=null,this.m_node2.next=null,this.m_node2.other=null,this.m_manifold=[new b2Manifold],this.m_manifold[0].pointCount=0,this.m_manifold[0].points[0].normalImpulse=0,this.m_manifold[0].points[0].tangentImpulse=0},Evaluate:function(){b2Collision.b2CollideCircle(this.m_manifold[0],this.m_shape1,this.m_shape2,!1),this.m_manifold[0].pointCount>0?this.m_manifoldCount=1:this.m_manifoldCount=0},GetManifolds:function(){return this.m_manifold},m_manifold:[new b2Manifold]}),i.Create=function(t,e,n){return new i(t,e)},i.Destroy=function(t,e){}},function(t,e){var i=Class.create();i.prototype={NotifyJointDestroyed:function(t){},NotifyBoundaryViolated:function(t){return i.b2_freezeBody},initialize:function(){}},i.b2_freezeBody=0,i.b2_destroyBody=1},function(t,e){var i=Class.create();i.prototype={initialize:function(t,e,i){this.step=new b2TimeStep,this.m_contactManager=new b2ContactManager,this.m_listener=null,this.m_filter=b2CollisionFilter.b2_defaultFilter,this.m_bodyList=null,this.m_contactList=null,this.m_jointList=null,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_bodyDestroyList=null,this.m_allowSleep=i,this.m_gravity=e,this.m_contactManager.m_world=this,this.m_broadPhase=new b2BroadPhase(t,this.m_contactManager);var n=new b2BodyDef;this.m_groundBody=this.CreateBody(n)},SetListener:function(t){this.m_listener=t},SetFilter:function(t){this.m_filter=t},CreateBody:function(t){var e=new b2Body(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e},DestroyBody:function(t){t.m_flags&b2Body.e_destroyFlag||(t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_flags|=b2Body.e_destroyFlag,--this.m_bodyCount,t.m_prev=null,t.m_next=this.m_bodyDestroyList,this.m_bodyDestroyList=t)},CleanBodyList:function(){this.m_contactManager.m_destroyImmediate=!0;for(var t=this.m_bodyDestroyList;t;){var e=t;t=t.m_next;for(var i=e.m_jointList;i;){var n=i;i=i.next,this.m_listener&&this.m_listener.NotifyJointDestroyed(n.joint),this.DestroyJoint(n.joint)}e.Destroy()}this.m_bodyDestroyList=null,this.m_contactManager.m_destroyImmediate=!1},CreateJoint:function(t){var e=b2Joint.Create(t,this.m_blockAllocator);if(e.m_prev=null,e.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=e),this.m_jointList=e,++this.m_jointCount,e.m_node1.joint=e,e.m_node1.other=e.m_body2,e.m_node1.prev=null,e.m_node1.next=e.m_body1.m_jointList,e.m_body1.m_jointList&&(e.m_body1.m_jointList.prev=e.m_node1),e.m_body1.m_jointList=e.m_node1,e.m_node2.joint=e,e.m_node2.other=e.m_body1,e.m_node2.prev=null,e.m_node2.next=e.m_body2.m_jointList,e.m_body2.m_jointList&&(e.m_body2.m_jointList.prev=e.m_node2),e.m_body2.m_jointList=e.m_node2,0==t.collideConnected)for(var i=(t.body1.m_shapeCount<t.body2.m_shapeCount?t.body1:t.body2).m_shapeList;i;i=i.m_next)i.ResetProxy(this.m_broadPhase);return e},DestroyJoint:function(t){var e=t.m_collideConnected;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);var i=t.m_body1,n=t.m_body2;if(i.WakeUp(),n.WakeUp(),t.m_node1.prev&&(t.m_node1.prev.next=t.m_node1.next),t.m_node1.next&&(t.m_node1.next.prev=t.m_node1.prev),t.m_node1==i.m_jointList&&(i.m_jointList=t.m_node1.next),t.m_node1.prev=null,t.m_node1.next=null,t.m_node2.prev&&(t.m_node2.prev.next=t.m_node2.next),t.m_node2.next&&(t.m_node2.next.prev=t.m_node2.prev),t.m_node2==n.m_jointList&&(n.m_jointList=t.m_node2.next),t.m_node2.prev=null,t.m_node2.next=null,b2Joint.Destroy(t,this.m_blockAllocator),--this.m_jointCount,0==e)for(var o=(i.m_shapeCount<n.m_shapeCount?i:n).m_shapeList;o;o=o.m_next)o.ResetProxy(this.m_broadPhase)},GetGroundBody:function(){return this.m_groundBody},step:new b2TimeStep,Step:function(t,e){var i,n;this.step.dt=t,this.step.iterations=e,this.step.inv_dt=t>0?1/t:0,this.m_positionIterationCount=0,this.m_contactManager.CleanContactList(),this.CleanBodyList(),this.m_contactManager.Collide();var o=new b2Island(this.m_bodyCount,this.m_contactCount,this.m_jointCount,this.m_stackAllocator);for(i=this.m_bodyList;null!=i;i=i.m_next)i.m_flags&=~b2Body.e_islandFlag;for(var s=this.m_contactList;null!=s;s=s.m_next)s.m_flags&=~b2Contact.e_islandFlag;for(var r=this.m_jointList;null!=r;r=r.m_next)r.m_islandFlag=!1;this.m_bodyCount;for(var a=new Array(this.m_bodyCount),l=0;l<this.m_bodyCount;l++)a[l]=null;for(var m=this.m_bodyList;null!=m;m=m.m_next)if(!(m.m_flags&(b2Body.e_staticFlag|b2Body.e_islandFlag|b2Body.e_sleepFlag|b2Body.e_frozenFlag))){o.Clear();var c=0;for(a[c++]=m,m.m_flags|=b2Body.e_islandFlag;c>0;)if(i=a[--c],o.AddBody(i),i.m_flags&=~b2Body.e_sleepFlag,!(i.m_flags&b2Body.e_staticFlag)){for(var h=i.m_contactList;null!=h;h=h.next)h.contact.m_flags&b2Contact.e_islandFlag||(o.AddContact(h.contact),h.contact.m_flags|=b2Contact.e_islandFlag,(n=h.other).m_flags&b2Body.e_islandFlag||(a[c++]=n,n.m_flags|=b2Body.e_islandFlag));for(var u=i.m_jointList;null!=u;u=u.next)1!=u.joint.m_islandFlag&&(o.AddJoint(u.joint),u.joint.m_islandFlag=!0,(n=u.other).m_flags&b2Body.e_islandFlag||(a[c++]=n,n.m_flags|=b2Body.e_islandFlag))}o.Solve(this.step,this.m_gravity),this.m_positionIterationCount=b2Math.b2Max(this.m_positionIterationCount,b2Island.m_positionIterationCount),this.m_allowSleep&&o.UpdateSleep(t);for(var _=0;_<o.m_bodyCount;++_){if((i=o.m_bodies[_]).m_flags&b2Body.e_staticFlag&&(i.m_flags&=~b2Body.e_islandFlag),i.IsFrozen()&&this.m_listener)this.m_listener.NotifyBoundaryViolated(i)==b2WorldListener.b2_destroyBody&&(this.DestroyBody(i),i=null,o.m_bodies[_]=null)}}this.m_broadPhase.Commit()},Query:function(t,e,i){for(var n=new Array,o=this.m_broadPhase.QueryAABB(t,n,i),s=0;s<o;++s)e[s]=n[s];return o},GetBodyList:function(){return this.m_bodyList},GetJointList:function(){return this.m_jointList},GetContactList:function(){return this.m_contactList},m_blockAllocator:null,m_stackAllocator:null,m_broadPhase:null,m_contactManager:new b2ContactManager,m_bodyList:null,m_contactList:null,m_jointList:null,m_bodyCount:0,m_contactCount:0,m_jointCount:0,m_bodyDestroyList:null,m_gravity:null,m_allowSleep:null,m_groundBody:null,m_listener:null,m_filter:null,m_positionIterationCount:0},i.s_enablePositionCorrection=1,i.s_enableWarmStarting=1},function(t,e){Class.create().prototype={dt:null,inv_dt:null,iterations:0,initialize:function(){}}},function(t,e){var i=Class.create();i.prototype={initialize:function(t,e,i,n){var o=0;for(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=i,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_bodies=new Array(t),o=0;o<t;o++)this.m_bodies[o]=null;for(this.m_contacts=new Array(e),o=0;o<e;o++)this.m_contacts[o]=null;for(this.m_joints=new Array(i),o=0;o<i;o++)this.m_joints[o]=null;this.m_allocator=n},Clear:function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},Solve:function(t,e){var n,o=0;for(o=0;o<this.m_bodyCount;++o)0!=(n=this.m_bodies[o]).m_invMass&&(n.m_linearVelocity.Add(b2Math.MulFV(t.dt,b2Math.AddVV(e,b2Math.MulFV(n.m_invMass,n.m_force)))),n.m_angularVelocity+=t.dt*n.m_invI*n.m_torque,n.m_linearVelocity.Multiply(n.m_linearDamping),n.m_angularVelocity*=n.m_angularDamping,n.m_position0.SetV(n.m_position),n.m_rotation0=n.m_rotation);var s=new b2ContactSolver(this.m_contacts,this.m_contactCount,this.m_allocator);for(s.PreSolve(),o=0;o<this.m_jointCount;++o)this.m_joints[o].PrepareVelocitySolver();for(o=0;o<t.iterations;++o){s.SolveVelocityConstraints();for(var r=0;r<this.m_jointCount;++r)this.m_joints[r].SolveVelocityConstraints(t)}for(o=0;o<this.m_bodyCount;++o)0!=(n=this.m_bodies[o]).m_invMass&&(n.m_position.x+=t.dt*n.m_linearVelocity.x,n.m_position.y+=t.dt*n.m_linearVelocity.y,n.m_rotation+=t.dt*n.m_angularVelocity,n.m_R.Set(n.m_rotation));for(o=0;o<this.m_jointCount;++o)this.m_joints[o].PreparePositionSolver();if(b2World.s_enablePositionCorrection)for(i.m_positionIterationCount=0;i.m_positionIterationCount<t.iterations;++i.m_positionIterationCount){var a=s.SolvePositionConstraints(b2Settings.b2_contactBaumgarte),l=!0;for(o=0;o<this.m_jointCount;++o){var m=this.m_joints[o].SolvePositionConstraints();l=l&&m}if(a&&l)break}for(s.PostSolve(),o=0;o<this.m_bodyCount;++o)0!=(n=this.m_bodies[o]).m_invMass&&(n.m_R.Set(n.m_rotation),n.SynchronizeShapes(),n.m_force.Set(0,0),n.m_torque=0)},UpdateSleep:function(t){var e,i=0,n=Number.MAX_VALUE,o=b2Settings.b2_linearSleepTolerance*b2Settings.b2_linearSleepTolerance,s=b2Settings.b2_angularSleepTolerance*b2Settings.b2_angularSleepTolerance;for(i=0;i<this.m_bodyCount;++i)0!=(e=this.m_bodies[i]).m_invMass&&(0==(e.m_flags&b2Body.e_allowSleepFlag)&&(e.m_sleepTime=0,n=0),0==(e.m_flags&b2Body.e_allowSleepFlag)||e.m_angularVelocity*e.m_angularVelocity>s||b2Math.b2Dot(e.m_linearVelocity,e.m_linearVelocity)>o?(e.m_sleepTime=0,n=0):(e.m_sleepTime+=t,n=b2Math.b2Min(n,e.m_sleepTime)));if(n>=b2Settings.b2_timeToSleep)for(i=0;i<this.m_bodyCount;++i)(e=this.m_bodies[i]).m_flags|=b2Body.e_sleepFlag},AddBody:function(t){this.m_bodies[this.m_bodyCount++]=t},AddContact:function(t){this.m_contacts[this.m_contactCount++]=t},AddJoint:function(t){this.m_joints[this.m_jointCount++]=t},m_allocator:null,m_bodies:null,m_contacts:null,m_joints:null,m_bodyCount:0,m_jointCount:0,m_contactCount:0,m_bodyCapacity:0,m_contactCapacity:0,m_jointCapacity:0,m_positionError:null},i.m_positionIterationCount=0},function(t,e){var i=Class.create();Object.extend(i.prototype,b2PairCallback.prototype),Object.extend(i.prototype,{initialize:function(){this.m_nullContact=new b2NullContact,this.m_world=null,this.m_destroyImmediate=!1},PairAdded:function(t,e){var i=t,n=e,o=i.m_body,s=n.m_body;if(o.IsStatic()&&s.IsStatic())return this.m_nullContact;if(i.m_body==n.m_body)return this.m_nullContact;if(s.IsConnected(o))return this.m_nullContact;if(null!=this.m_world.m_filter&&0==this.m_world.m_filter.ShouldCollide(i,n))return this.m_nullContact;if(0==s.m_invMass){var r=i;i=n,n=r;var a=o;o=s,s=a}var l=b2Contact.Create(i,n,this.m_world.m_blockAllocator);return null==l?this.m_nullContact:(l.m_prev=null,l.m_next=this.m_world.m_contactList,null!=this.m_world.m_contactList&&(this.m_world.m_contactList.m_prev=l),this.m_world.m_contactList=l,this.m_world.m_contactCount++,l)},PairRemoved:function(t,e,i){if(null!=i){var n=i;n!=this.m_nullContact&&(1==this.m_destroyImmediate?(this.DestroyContact(n),n=null):n.m_flags|=b2Contact.e_destroyFlag)}},DestroyContact:function(t){if(t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_world.m_contactList&&(this.m_world.m_contactList=t.m_next),t.GetManifoldCount()>0){var e=t.m_shape1.m_body,i=t.m_shape2.m_body,n=t.m_node1,o=t.m_node2;e.WakeUp(),i.WakeUp(),n.prev&&(n.prev.next=n.next),n.next&&(n.next.prev=n.prev),n==e.m_contactList&&(e.m_contactList=n.next),n.prev=null,n.next=null,o.prev&&(o.prev.next=o.next),o.next&&(o.next.prev=o.prev),o==i.m_contactList&&(i.m_contactList=o.next),o.prev=null,o.next=null}b2Contact.Destroy(t,this.m_world.m_blockAllocator),--this.m_world.m_contactCount},CleanContactList:function(){for(var t=this.m_world.m_contactList;null!=t;){var e=t;t=t.m_next,e.m_flags&b2Contact.e_destroyFlag&&(this.DestroyContact(e),e=null)}},Collide:function(){for(var t,e,i,n,o=this.m_world.m_contactList;null!=o;o=o.m_next)if(!o.m_shape1.m_body.IsSleeping()||!o.m_shape2.m_body.IsSleeping()){var s=o.GetManifoldCount();o.Evaluate();var r=o.GetManifoldCount();0==s&&r>0?(t=o.m_shape1.m_body,e=o.m_shape2.m_body,i=o.m_node1,n=o.m_node2,i.contact=o,i.other=e,i.prev=null,i.next=t.m_contactList,null!=i.next&&(i.next.prev=o.m_node1),t.m_contactList=o.m_node1,n.contact=o,n.other=t,n.prev=null,n.next=e.m_contactList,null!=n.next&&(n.next.prev=n),e.m_contactList=n):s>0&&0==r&&(t=o.m_shape1.m_body,e=o.m_shape2.m_body,i=o.m_node1,n=o.m_node2,i.prev&&(i.prev.next=i.next),i.next&&(i.next.prev=i.prev),i==t.m_contactList&&(t.m_contactList=i.next),i.prev=null,i.next=null,n.prev&&(n.prev.next=n.next),n.next&&(n.next.prev=n.prev),n==e.m_contactList&&(e.m_contactList=n.next),n.prev=null,n.next=null)}},m_world:null,m_nullContact:new b2NullContact,m_destroyImmediate:null})},function(t,e){var i=Class.create();i.prototype={ShouldCollide:function(t,e){return t.m_groupIndex==e.m_groupIndex&&0!=t.m_groupIndex?t.m_groupIndex>0:0!=(t.m_maskBits&e.m_categoryBits)&&0!=(t.m_categoryBits&e.m_maskBits)},initialize:function(){}},i.b2_defaultFilter=new i},function(t,e){Class.create().prototype={initialize:function(){this.shapes=new Array,this.userData=null;for(var t=0;t<b2Settings.b2_maxShapesPerBody;t++)this.shapes[t]=null;this.position=new b2Vec2(0,0),this.rotation=0,this.linearVelocity=new b2Vec2(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.isSleeping=!1,this.preventRotation=!1},userData:null,shapes:new Array,position:null,rotation:null,linearVelocity:null,angularVelocity:null,linearDamping:null,angularDamping:null,allowSleep:null,isSleeping:null,preventRotation:null,AddShape:function(t){for(var e=0;e<b2Settings.b2_maxShapesPerBody;++e)if(null==this.shapes[e]){this.shapes[e]=t;break}}}},function(t,e){var i=Class.create();i.prototype={SetOriginPosition:function(t,e){if(!this.IsFrozen()){this.m_rotation=e,this.m_R.Set(this.m_rotation),this.m_position=b2Math.AddVV(t,b2Math.b2MulMV(this.m_R,this.m_center)),this.m_position0.SetV(this.m_position),this.m_rotation0=this.m_rotation;for(var i=this.m_shapeList;null!=i;i=i.m_next)i.Synchronize(this.m_position,this.m_R,this.m_position,this.m_R);this.m_world.m_broadPhase.Commit()}},GetOriginPosition:function(){return b2Math.SubtractVV(this.m_position,b2Math.b2MulMV(this.m_R,this.m_center))},SetCenterPosition:function(t,e){if(!this.IsFrozen()){this.m_rotation=e,this.m_R.Set(this.m_rotation),this.m_position.SetV(t),this.m_position0.SetV(this.m_position),this.m_rotation0=this.m_rotation;for(var i=this.m_shapeList;null!=i;i=i.m_next)i.Synchronize(this.m_position,this.m_R,this.m_position,this.m_R);this.m_world.m_broadPhase.Commit()}},GetCenterPosition:function(){return this.m_position},GetRotation:function(){return this.m_rotation},GetRotationMatrix:function(){return this.m_R},SetLinearVelocity:function(t){this.m_linearVelocity.SetV(t)},GetLinearVelocity:function(){return this.m_linearVelocity},SetAngularVelocity:function(t){this.m_angularVelocity=t},GetAngularVelocity:function(){return this.m_angularVelocity},ApplyForce:function(t,e){0==this.IsSleeping()&&(this.m_force.Add(t),this.m_torque+=b2Math.b2CrossVV(b2Math.SubtractVV(e,this.m_position),t))},ApplyTorque:function(t){0==this.IsSleeping()&&(this.m_torque+=t)},ApplyImpulse:function(t,e){0==this.IsSleeping()&&(this.m_linearVelocity.Add(b2Math.MulFV(this.m_invMass,t)),this.m_angularVelocity+=this.m_invI*b2Math.b2CrossVV(b2Math.SubtractVV(e,this.m_position),t))},GetMass:function(){return this.m_mass},GetInertia:function(){return this.m_I},GetWorldPoint:function(t){return b2Math.AddVV(this.m_position,b2Math.b2MulMV(this.m_R,t))},GetWorldVector:function(t){return b2Math.b2MulMV(this.m_R,t)},GetLocalPoint:function(t){return b2Math.b2MulTMV(this.m_R,b2Math.SubtractVV(t,this.m_position))},GetLocalVector:function(t){return b2Math.b2MulTMV(this.m_R,t)},IsStatic:function(){return(this.m_flags&i.e_staticFlag)==i.e_staticFlag},IsFrozen:function(){return(this.m_flags&i.e_frozenFlag)==i.e_frozenFlag},IsSleeping:function(){return(this.m_flags&i.e_sleepFlag)==i.e_sleepFlag},AllowSleeping:function(t){t?this.m_flags|=i.e_allowSleepFlag:(this.m_flags&=~i.e_allowSleepFlag,this.WakeUp())},WakeUp:function(){this.m_flags&=~i.e_sleepFlag,this.m_sleepTime=0},GetShapeList:function(){return this.m_shapeList},GetContactList:function(){return this.m_contactList},GetJointList:function(){return this.m_jointList},GetNext:function(){return this.m_next},GetUserData:function(){return this.m_userData},initialize:function(t,e){this.sMat0=new b2Mat22,this.m_position=new b2Vec2,this.m_R=new b2Mat22(0),this.m_position0=new b2Vec2;var n,o,s=0;this.m_flags=0,this.m_position.SetV(t.position),this.m_rotation=t.rotation,this.m_R.Set(this.m_rotation),this.m_position0.SetV(this.m_position),this.m_rotation0=this.m_rotation,this.m_world=e,this.m_linearDamping=b2Math.b2Clamp(1-t.linearDamping,0,1),this.m_angularDamping=b2Math.b2Clamp(1-t.angularDamping,0,1),this.m_force=new b2Vec2(0,0),this.m_torque=0,this.m_mass=0;var r=new Array(b2Settings.b2_maxShapesPerBody);for(s=0;s<b2Settings.b2_maxShapesPerBody;s++)r[s]=new b2MassData;for(this.m_shapeCount=0,this.m_center=new b2Vec2(0,0),s=0;s<b2Settings.b2_maxShapesPerBody&&null!=(n=t.shapes[s]);++s)o=r[s],n.ComputeMass(o),this.m_mass+=o.mass,this.m_center.x+=o.mass*(n.localPosition.x+o.center.x),this.m_center.y+=o.mass*(n.localPosition.y+o.center.y),++this.m_shapeCount;for(this.m_mass>0?(this.m_center.Multiply(1/this.m_mass),this.m_position.Add(b2Math.b2MulMV(this.m_R,this.m_center))):this.m_flags|=i.e_staticFlag,this.m_I=0,s=0;s<this.m_shapeCount;++s){n=t.shapes[s],o=r[s],this.m_I+=o.I;var a=b2Math.SubtractVV(b2Math.AddVV(n.localPosition,o.center),this.m_center);this.m_I+=o.mass*b2Math.b2Dot(a,a)}for(this.m_mass>0?this.m_invMass=1/this.m_mass:this.m_invMass=0,this.m_I>0&&0==t.preventRotation?this.m_invI=1/this.m_I:(this.m_I=0,this.m_invI=0),this.m_linearVelocity=b2Math.AddVV(t.linearVelocity,b2Math.b2CrossFV(t.angularVelocity,this.m_center)),this.m_angularVelocity=t.angularVelocity,this.m_jointList=null,this.m_contactList=null,this.m_prev=null,this.m_next=null,this.m_shapeList=null,s=0;s<this.m_shapeCount;++s){n=t.shapes[s];var l=b2Shape.Create(n,this,this.m_center);l.m_next=this.m_shapeList,this.m_shapeList=l}this.m_sleepTime=0,t.allowSleep&&(this.m_flags|=i.e_allowSleepFlag),t.isSleeping&&(this.m_flags|=i.e_sleepFlag),(this.m_flags&i.e_sleepFlag||0==this.m_invMass)&&(this.m_linearVelocity.Set(0,0),this.m_angularVelocity=0),this.m_userData=t.userData},Destroy:function(){for(var t=this.m_shapeList;t;){var e=t;t=t.m_next,b2Shape.Destroy(e)}},sMat0:new b2Mat22,SynchronizeShapes:function(){this.sMat0.Set(this.m_rotation0);for(var t=this.m_shapeList;null!=t;t=t.m_next)t.Synchronize(this.m_position0,this.sMat0,this.m_position,this.m_R)},QuickSyncShapes:function(){for(var t=this.m_shapeList;null!=t;t=t.m_next)t.QuickSync(this.m_position,this.m_R)},IsConnected:function(t){for(var e=this.m_jointList;null!=e;e=e.next)if(e.other==t)return 0==e.joint.m_collideConnected;return!1},Freeze:function(){this.m_flags|=i.e_frozenFlag,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0;for(var t=this.m_shapeList;null!=t;t=t.m_next)t.DestroyProxy()},m_flags:0,m_position:new b2Vec2,m_rotation:null,m_R:new b2Mat22(0),m_position0:new b2Vec2,m_rotation0:null,m_linearVelocity:null,m_angularVelocity:null,m_force:null,m_torque:null,m_center:null,m_world:null,m_prev:null,m_next:null,m_shapeList:null,m_shapeCount:0,m_jointList:null,m_contactList:null,m_mass:null,m_invMass:null,m_I:null,m_invI:null,m_linearDamping:null,m_angularDamping:null,m_sleepTime:null,m_userData:null},i.e_staticFlag=1,i.e_frozenFlag=2,i.e_islandFlag=4,i.e_sleepFlag=8,i.e_allowSleepFlag=16,i.e_destroyFlag=32},function(t,e){var i=Class.create();i.prototype={initialize:function(t,e){this.x=t,this.y=e},SetZero:function(){this.x=0,this.y=0},Set:function(t,e){this.x=t,this.y=e},SetV:function(t){this.x=t.x,this.y=t.y},Negative:function(){return new i(-this.x,-this.y)},Copy:function(){return new i(this.x,this.y)},Add:function(t){this.x+=t.x,this.y+=t.y},Subtract:function(t){this.x-=t.x,this.y-=t.y},Multiply:function(t){this.x*=t,this.y*=t},MulM:function(t){var e=this.x;this.x=t.col1.x*e+t.col2.x*this.y,this.y=t.col1.y*e+t.col2.y*this.y},MulTM:function(t){var e=b2Math.b2Dot(this,t.col1);this.y=b2Math.b2Dot(this,t.col2),this.x=e},CrossVF:function(t){var e=this.x;this.x=t*this.y,this.y=-t*e},CrossFV:function(t){var e=this.x;this.x=-t*this.y,this.y=t*e},MinV:function(t){this.x=this.x<t.x?this.x:t.x,this.y=this.y<t.y?this.y:t.y},MaxV:function(t){this.x=this.x>t.x?this.x:t.x,this.y=this.y>t.y?this.y:t.y},Abs:function(){this.x=Math.abs(this.x),this.y=Math.abs(this.y)},Length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},Normalize:function(){var t=this.Length();if(t<Number.MIN_VALUE)return 0;var e=1/t;return this.x*=e,this.y*=e,t},IsValid:function(){return b2Math.b2IsValid(this.x)&&b2Math.b2IsValid(this.y)},x:null,y:null},i.Make=function(t,e){return new i(t,e)}},function(t,e){var i=Class.create();i.prototype={initialize:function(){}},i.b2IsValid=function(t){return isFinite(t)},i.b2Dot=function(t,e){return t.x*e.x+t.y*e.y},i.b2CrossVV=function(t,e){return t.x*e.y-t.y*e.x},i.b2CrossVF=function(t,e){return new b2Vec2(e*t.y,-e*t.x)},i.b2CrossFV=function(t,e){return new b2Vec2(-t*e.y,t*e.x)},i.b2MulMV=function(t,e){return new b2Vec2(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y)},i.b2MulTMV=function(t,e){return new b2Vec2(i.b2Dot(e,t.col1),i.b2Dot(e,t.col2))},i.AddVV=function(t,e){return new b2Vec2(t.x+e.x,t.y+e.y)},i.SubtractVV=function(t,e){return new b2Vec2(t.x-e.x,t.y-e.y)},i.MulFV=function(t,e){return new b2Vec2(t*e.x,t*e.y)},i.AddMM=function(t,e){return new b2Mat22(0,i.AddVV(t.col1,e.col1),i.AddVV(t.col2,e.col2))},i.b2MulMM=function(t,e){return new b2Mat22(0,i.b2MulMV(t,e.col1),i.b2MulMV(t,e.col2))},i.b2MulTMM=function(t,e){var n=new b2Vec2(i.b2Dot(t.col1,e.col1),i.b2Dot(t.col2,e.col1)),o=new b2Vec2(i.b2Dot(t.col1,e.col2),i.b2Dot(t.col2,e.col2));return new b2Mat22(0,n,o)},i.b2Abs=function(t){return t>0?t:-t},i.b2AbsV=function(t){return new b2Vec2(i.b2Abs(t.x),i.b2Abs(t.y))},i.b2AbsM=function(t){return new b2Mat22(0,i.b2AbsV(t.col1),i.b2AbsV(t.col2))},i.b2Min=function(t,e){return t<e?t:e},i.b2MinV=function(t,e){return new b2Vec2(i.b2Min(t.x,e.x),i.b2Min(t.y,e.y))},i.b2Max=function(t,e){return t>e?t:e},i.b2MaxV=function(t,e){return new b2Vec2(i.b2Max(t.x,e.x),i.b2Max(t.y,e.y))},i.b2Clamp=function(t,e,n){return i.b2Max(e,i.b2Min(t,n))},i.b2ClampV=function(t,e,n){return i.b2MaxV(e,i.b2MinV(t,n))},i.b2Swap=function(t,e){var i=t[0];t[0]=e[0],e[0]=i},i.b2Random=function(){return 2*Math.random()-1},i.b2NextPowerOfTwo=function(t){return t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,t|=t>>8&16777215,(t|=t>>16&65535)+1},i.b2IsPowerOfTwo=function(t){return t>0&&0==(t&t-1)},i.tempVec2=new b2Vec2,i.tempVec3=new b2Vec2,i.tempVec4=new b2Vec2,i.tempVec5=new b2Vec2,i.tempMat=new b2Mat22},function(t,e){var i=Class.create();i.prototype={initialize:function(t,e,i){if(null==t&&(t=0),this.col1=new b2Vec2,this.col2=new b2Vec2,null!=e&&null!=i)this.col1.SetV(e),this.col2.SetV(i);else{var n=Math.cos(t),o=Math.sin(t);this.col1.x=n,this.col2.x=-o,this.col1.y=o,this.col2.y=n}},Set:function(t){var e=Math.cos(t),i=Math.sin(t);this.col1.x=e,this.col2.x=-i,this.col1.y=i,this.col2.y=e},SetVV:function(t,e){this.col1.SetV(t),this.col2.SetV(e)},Copy:function(){return new i(0,this.col1,this.col2)},SetM:function(t){this.col1.SetV(t.col1),this.col2.SetV(t.col2)},AddM:function(t){this.col1.x+=t.col1.x,this.col1.y+=t.col1.y,this.col2.x+=t.col2.x,this.col2.y+=t.col2.y},SetIdentity:function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},SetZero:function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},Invert:function(t){var e=this.col1.x,i=this.col2.x,n=this.col1.y,o=this.col2.y,s=e*o-i*n;return s=1/s,t.col1.x=s*o,t.col2.x=-s*i,t.col1.y=-s*n,t.col2.y=s*e,t},Solve:function(t,e,i){var n=this.col1.x,o=this.col2.x,s=this.col1.y,r=this.col2.y,a=n*r-o*s;return a=1/a,t.x=a*(r*e-o*i),t.y=a*(n*i-s*e),t},Abs:function(){this.col1.Abs(),this.col2.Abs()},col1:new b2Vec2,col2:new b2Vec2}},function(t,e){var i=Class.create();i.prototype={initialize:function(){}},i.USHRT_MAX=65535,i.b2_pi=Math.PI,i.b2_massUnitsPerKilogram=1,i.b2_timeUnitsPerSecond=1,i.b2_lengthUnitsPerMeter=30,i.b2_maxManifoldPoints=2,i.b2_maxShapesPerBody=64,i.b2_maxPolyVertices=8,i.b2_maxProxies=1024,i.b2_maxPairs=8*i.b2_maxProxies,i.b2_linearSlop=.005*i.b2_lengthUnitsPerMeter,i.b2_angularSlop=2/180*i.b2_pi,i.b2_velocityThreshold=1*i.b2_lengthUnitsPerMeter/i.b2_timeUnitsPerSecond,i.b2_maxLinearCorrection=.2*i.b2_lengthUnitsPerMeter,i.b2_maxAngularCorrection=8/180*i.b2_pi,i.b2_contactBaumgarte=.2,i.b2_timeToSleep=.5*i.b2_timeUnitsPerSecond,i.b2_linearSleepTolerance=.01*i.b2_lengthUnitsPerMeter/i.b2_timeUnitsPerSecond,i.b2_angularSleepTolerance=2/180/i.b2_timeUnitsPerSecond,i.b2Assert=function(t){t||(void 0).x++}},function(t,e){Class.create().prototype={initialize:function(){this.type=b2Shape.e_unknownShape,this.userData=null,this.localPosition=new b2Vec2(0,0),this.localRotation=0,this.friction=.2,this.restitution=0,this.density=0,this.categoryBits=1,this.maskBits=65535,this.groupIndex=0},ComputeMass:function(t){switch(t.center=new b2Vec2(0,0),0==this.density&&(t.mass=0,t.center.Set(0,0),t.I=0),this.type){case b2Shape.e_circleShape:t.mass=this.density*b2Settings.b2_pi*this.radius*this.radius,t.center.Set(0,0),t.I=.5*t.mass*this.radius*this.radius;break;case b2Shape.e_boxShape:t.mass=4*this.density*this.extents.x*this.extents.y,t.center.Set(0,0),t.I=t.mass/3*b2Math.b2Dot(this.extents,this.extents);break;case b2Shape.e_polyShape:b2Shape.PolyMass(t,this.vertices,this.vertexCount,this.density);break;default:t.mass=0,t.center.Set(0,0),t.I=0}},type:0,userData:null,localPosition:null,localRotation:null,friction:null,restitution:null,density:null,categoryBits:0,maskBits:0,groupIndex:0}},function(t,e){var i=Class.create();i.prototype={TestPoint:function(t){return!1},GetUserData:function(){return this.m_userData},GetType:function(){return this.m_type},GetBody:function(){return this.m_body},GetPosition:function(){return this.m_position},GetRotationMatrix:function(){return this.m_R},ResetProxy:function(t){},GetNext:function(){return this.m_next},initialize:function(t,e){this.m_R=new b2Mat22,this.m_position=new b2Vec2,this.m_userData=t.userData,this.m_friction=t.friction,this.m_restitution=t.restitution,this.m_body=e,this.m_proxyId=b2Pair.b2_nullProxy,this.m_maxRadius=0,this.m_categoryBits=t.categoryBits,this.m_maskBits=t.maskBits,this.m_groupIndex=t.groupIndex},DestroyProxy:function(){this.m_proxyId!=b2Pair.b2_nullProxy&&(this.m_body.m_world.m_broadPhase.DestroyProxy(this.m_proxyId),this.m_proxyId=b2Pair.b2_nullProxy)},Synchronize:function(t,e,i,n){},QuickSync:function(t,e){},Support:function(t,e,i){},GetMaxRadius:function(){return this.m_maxRadius},m_next:null,m_R:new b2Mat22,m_position:new b2Vec2,m_type:0,m_userData:null,m_body:null,m_friction:null,m_restitution:null,m_maxRadius:null,m_proxyId:0,m_categoryBits:0,m_maskBits:0,m_groupIndex:0},i.Create=function(t,e,n){switch(t.type){case i.e_circleShape:return new b2CircleShape(t,e,n);case i.e_boxShape:case i.e_polyShape:return new b2PolyShape(t,e,n)}return null},i.Destroy=function(t){t.m_proxyId!=b2Pair.b2_nullProxy&&t.m_body.m_world.m_broadPhase.DestroyProxy(t.m_proxyId)},i.e_unknownShape=-1,i.e_circleShape=0,i.e_boxShape=1,i.e_polyShape=2,i.e_meshShape=3,i.e_shapeTypeCount=4,i.PolyMass=function(t,e,i,n){var o=new b2Vec2;o.SetZero();for(var s=0,r=0,a=new b2Vec2(0,0),l=0;l<i;++l){var m=a,c=e[l],h=l+1<i?e[l+1]:e[0],u=b2Math.SubtractVV(c,m),_=b2Math.SubtractVV(h,m),p=b2Math.b2CrossVV(u,_),y=.5*p;s+=y;var d=new b2Vec2;d.SetV(m),d.Add(c),d.Add(h),d.Multiply(1/3*y),o.Add(d);var b=m.x,f=m.y,x=u.x,v=u.y,g=_.x,S=_.y;r+=p*(1/3*(.25*(x*x+g*x+g*g)+(b*x+b*g))+.5*b*b+(1/3*(.25*(v*v+S*v+S*S)+(f*v+f*S))+.5*f*f))}t.mass=n*s,o.Multiply(1/s),t.center=o,r=n*(r-s*b2Math.b2Dot(o,o)),t.I=r},i.PolyCentroid=function(t,e,i){for(var n=0,o=0,s=0,r=0;r<e;++r){var a=t[r].x,l=t[r].y,m=r+1<e?t[r+1].x:t[0].x,c=r+1<e?t[r+1].y:t[0].y,h=.5*((a-0)*(c-0)-(l-0)*(m-0));s+=h,n+=h*(1/3)*(0+a+m),o+=h*(1/3)*(0+l+c)}n*=1/s,o*=1/s,i.Set(n,o)}},function(t,e){var i=Class.create();Object.extend(i.prototype,b2Shape.prototype),Object.extend(i.prototype,{TestPoint:function(t){var e=new b2Vec2;e.SetV(t),e.Subtract(this.m_position),e.MulTM(this.m_R);for(var i=0;i<this.m_vertexCount;++i){var n=new b2Vec2;if(n.SetV(e),n.Subtract(this.m_vertices[i]),b2Math.b2Dot(this.m_normals[i],n)>0)return!1}return!0},initialize:function(t,e,n){this.m_R=new b2Mat22,this.m_position=new b2Vec2,this.m_userData=t.userData,this.m_friction=t.friction,this.m_restitution=t.restitution,this.m_body=e,this.m_proxyId=b2Pair.b2_nullProxy,this.m_maxRadius=0,this.m_categoryBits=t.categoryBits,this.m_maskBits=t.maskBits,this.m_groupIndex=t.groupIndex,this.syncAABB=new b2AABB,this.syncMat=new b2Mat22,this.m_localCentroid=new b2Vec2,this.m_localOBB=new b2OBB;var o,s,r,a=0,l=new b2AABB;this.m_vertices=new Array(b2Settings.b2_maxPolyVertices),this.m_coreVertices=new Array(b2Settings.b2_maxPolyVertices),this.m_normals=new Array(b2Settings.b2_maxPolyVertices),this.m_type=b2Shape.e_polyShape;var m=new b2Mat22(t.localRotation);if(t.type==b2Shape.e_boxShape){this.m_localCentroid.x=t.localPosition.x-n.x,this.m_localCentroid.y=t.localPosition.y-n.y;var c=t;this.m_vertexCount=4,o=c.extents.x,s=c.extents.y;var h=Math.max(0,o-2*b2Settings.b2_linearSlop),u=Math.max(0,s-2*b2Settings.b2_linearSlop);(r=this.m_vertices[0]=new b2Vec2).x=m.col1.x*o+m.col2.x*s,r.y=m.col1.y*o+m.col2.y*s,(r=this.m_vertices[1]=new b2Vec2).x=m.col1.x*-o+m.col2.x*s,r.y=m.col1.y*-o+m.col2.y*s,(r=this.m_vertices[2]=new b2Vec2).x=m.col1.x*-o+m.col2.x*-s,r.y=m.col1.y*-o+m.col2.y*-s,(r=this.m_vertices[3]=new b2Vec2).x=m.col1.x*o+m.col2.x*-s,r.y=m.col1.y*o+m.col2.y*-s,(r=this.m_coreVertices[0]=new b2Vec2).x=m.col1.x*h+m.col2.x*u,r.y=m.col1.y*h+m.col2.y*u,(r=this.m_coreVertices[1]=new b2Vec2).x=m.col1.x*-h+m.col2.x*u,r.y=m.col1.y*-h+m.col2.y*u,(r=this.m_coreVertices[2]=new b2Vec2).x=m.col1.x*-h+m.col2.x*-u,r.y=m.col1.y*-h+m.col2.y*-u,(r=this.m_coreVertices[3]=new b2Vec2).x=m.col1.x*h+m.col2.x*-u,r.y=m.col1.y*h+m.col2.y*-u}else{var _=t;this.m_vertexCount=_.vertexCount,b2Shape.PolyCentroid(_.vertices,_.vertexCount,i.tempVec);var p=i.tempVec.x,y=i.tempVec.y;for(this.m_localCentroid.x=t.localPosition.x+(m.col1.x*p+m.col2.x*y)-n.x,this.m_localCentroid.y=t.localPosition.y+(m.col1.y*p+m.col2.y*y)-n.y,a=0;a<this.m_vertexCount;++a){this.m_vertices[a]=new b2Vec2,this.m_coreVertices[a]=new b2Vec2,o=_.vertices[a].x-p,s=_.vertices[a].y-y,this.m_vertices[a].x=m.col1.x*o+m.col2.x*s,this.m_vertices[a].y=m.col1.y*o+m.col2.y*s;var d=this.m_vertices[a].x,b=this.m_vertices[a].y,f=Math.sqrt(d*d+b*b);f>Number.MIN_VALUE&&(d*=1/f,b*=1/f),this.m_coreVertices[a].x=this.m_vertices[a].x-2*b2Settings.b2_linearSlop*d,this.m_coreVertices[a].y=this.m_vertices[a].y-2*b2Settings.b2_linearSlop*b}}var x=Number.MAX_VALUE,v=Number.MAX_VALUE,g=-Number.MAX_VALUE,S=-Number.MAX_VALUE;for(this.m_maxRadius=0,a=0;a<this.m_vertexCount;++a){var M=this.m_vertices[a];x=Math.min(x,M.x),v=Math.min(v,M.y),g=Math.max(g,M.x),S=Math.max(S,M.y),this.m_maxRadius=Math.max(this.m_maxRadius,M.Length())}this.m_localOBB.R.SetIdentity(),this.m_localOBB.center.Set(.5*(x+g),.5*(v+S)),this.m_localOBB.extents.Set(.5*(g-x),.5*(S-v));var A=0,w=0;for(a=0;a<this.m_vertexCount;++a)this.m_normals[a]=new b2Vec2,A=a,w=a+1<this.m_vertexCount?a+1:0,this.m_normals[a].x=this.m_vertices[w].y-this.m_vertices[A].y,this.m_normals[a].y=-(this.m_vertices[w].x-this.m_vertices[A].x),this.m_normals[a].Normalize();for(a=0;a<this.m_vertexCount;++a)A=a,w=a+1<this.m_vertexCount?a+1:0;this.m_R.SetM(this.m_body.m_R),this.m_position.x=this.m_body.m_position.x+(this.m_R.col1.x*this.m_localCentroid.x+this.m_R.col2.x*this.m_localCentroid.y),this.m_position.y=this.m_body.m_position.y+(this.m_R.col1.y*this.m_localCentroid.x+this.m_R.col2.y*this.m_localCentroid.y),i.tAbsR.col1.x=this.m_R.col1.x*this.m_localOBB.R.col1.x+this.m_R.col2.x*this.m_localOBB.R.col1.y,i.tAbsR.col1.y=this.m_R.col1.y*this.m_localOBB.R.col1.x+this.m_R.col2.y*this.m_localOBB.R.col1.y,i.tAbsR.col2.x=this.m_R.col1.x*this.m_localOBB.R.col2.x+this.m_R.col2.x*this.m_localOBB.R.col2.y,i.tAbsR.col2.y=this.m_R.col1.y*this.m_localOBB.R.col2.x+this.m_R.col2.y*this.m_localOBB.R.col2.y,i.tAbsR.Abs(),o=i.tAbsR.col1.x*this.m_localOBB.extents.x+i.tAbsR.col2.x*this.m_localOBB.extents.y,s=i.tAbsR.col1.y*this.m_localOBB.extents.x+i.tAbsR.col2.y*this.m_localOBB.extents.y;var C=this.m_position.x+(this.m_R.col1.x*this.m_localOBB.center.x+this.m_R.col2.x*this.m_localOBB.center.y),V=this.m_position.y+(this.m_R.col1.y*this.m_localOBB.center.x+this.m_R.col2.y*this.m_localOBB.center.y);l.minVertex.x=C-o,l.minVertex.y=V-s,l.maxVertex.x=C+o,l.maxVertex.y=V+s;var I=this.m_body.m_world.m_broadPhase;I.InRange(l)?this.m_proxyId=I.CreateProxy(l,this):this.m_proxyId=b2Pair.b2_nullProxy,this.m_proxyId==b2Pair.b2_nullProxy&&this.m_body.Freeze()},syncAABB:new b2AABB,syncMat:new b2Mat22,Synchronize:function(t,e,i,n){if(this.m_R.SetM(n),this.m_position.x=this.m_body.m_position.x+(n.col1.x*this.m_localCentroid.x+n.col2.x*this.m_localCentroid.y),this.m_position.y=this.m_body.m_position.y+(n.col1.y*this.m_localCentroid.x+n.col2.y*this.m_localCentroid.y),this.m_proxyId!=b2Pair.b2_nullProxy){var o,s,r=e.col1,a=e.col2,l=this.m_localOBB.R.col1,m=this.m_localOBB.R.col2;this.syncMat.col1.x=r.x*l.x+a.x*l.y,this.syncMat.col1.y=r.y*l.x+a.y*l.y,this.syncMat.col2.x=r.x*m.x+a.x*m.y,this.syncMat.col2.y=r.y*m.x+a.y*m.y,this.syncMat.Abs(),o=this.m_localCentroid.x+this.m_localOBB.center.x,s=this.m_localCentroid.y+this.m_localOBB.center.y;var c=t.x+(e.col1.x*o+e.col2.x*s),h=t.y+(e.col1.y*o+e.col2.y*s);o=this.syncMat.col1.x*this.m_localOBB.extents.x+this.syncMat.col2.x*this.m_localOBB.extents.y,s=this.syncMat.col1.y*this.m_localOBB.extents.x+this.syncMat.col2.y*this.m_localOBB.extents.y,this.syncAABB.minVertex.x=c-o,this.syncAABB.minVertex.y=h-s,this.syncAABB.maxVertex.x=c+o,this.syncAABB.maxVertex.y=h+s,r=n.col1,a=n.col2,l=this.m_localOBB.R.col1,m=this.m_localOBB.R.col2,this.syncMat.col1.x=r.x*l.x+a.x*l.y,this.syncMat.col1.y=r.y*l.x+a.y*l.y,this.syncMat.col2.x=r.x*m.x+a.x*m.y,this.syncMat.col2.y=r.y*m.x+a.y*m.y,this.syncMat.Abs(),o=this.m_localCentroid.x+this.m_localOBB.center.x,s=this.m_localCentroid.y+this.m_localOBB.center.y,c=i.x+(n.col1.x*o+n.col2.x*s),h=i.y+(n.col1.y*o+n.col2.y*s),o=this.syncMat.col1.x*this.m_localOBB.extents.x+this.syncMat.col2.x*this.m_localOBB.extents.y,s=this.syncMat.col1.y*this.m_localOBB.extents.x+this.syncMat.col2.y*this.m_localOBB.extents.y,this.syncAABB.minVertex.x=Math.min(this.syncAABB.minVertex.x,c-o),this.syncAABB.minVertex.y=Math.min(this.syncAABB.minVertex.y,h-s),this.syncAABB.maxVertex.x=Math.max(this.syncAABB.maxVertex.x,c+o),this.syncAABB.maxVertex.y=Math.max(this.syncAABB.maxVertex.y,h+s);var u=this.m_body.m_world.m_broadPhase;u.InRange(this.syncAABB)?u.MoveProxy(this.m_proxyId,this.syncAABB):this.m_body.Freeze()}},QuickSync:function(t,e){this.m_R.SetM(e),this.m_position.x=t.x+(e.col1.x*this.m_localCentroid.x+e.col2.x*this.m_localCentroid.y),this.m_position.y=t.y+(e.col1.y*this.m_localCentroid.x+e.col2.y*this.m_localCentroid.y)},ResetProxy:function(t){if(this.m_proxyId!=b2Pair.b2_nullProxy){t.GetProxy(this.m_proxyId);t.DestroyProxy(this.m_proxyId),null;var e=b2Math.b2MulMM(this.m_R,this.m_localOBB.R),i=b2Math.b2AbsM(e),n=b2Math.b2MulMV(i,this.m_localOBB.extents),o=b2Math.b2MulMV(this.m_R,this.m_localOBB.center);o.Add(this.m_position);var s=new b2AABB;s.minVertex.SetV(o),s.minVertex.Subtract(n),s.maxVertex.SetV(o),s.maxVertex.Add(n),t.InRange(s)?this.m_proxyId=t.CreateProxy(s,this):this.m_proxyId=b2Pair.b2_nullProxy,this.m_proxyId==b2Pair.b2_nullProxy&&this.m_body.Freeze()}},Support:function(t,e,i){for(var n=t*this.m_R.col1.x+e*this.m_R.col1.y,o=t*this.m_R.col2.x+e*this.m_R.col2.y,s=0,r=this.m_coreVertices[0].x*n+this.m_coreVertices[0].y*o,a=1;a<this.m_vertexCount;++a){var l=this.m_coreVertices[a].x*n+this.m_coreVertices[a].y*o;l>r&&(s=a,r=l)}i.Set(this.m_position.x+(this.m_R.col1.x*this.m_coreVertices[s].x+this.m_R.col2.x*this.m_coreVertices[s].y),this.m_position.y+(this.m_R.col1.y*this.m_coreVertices[s].x+this.m_R.col2.y*this.m_coreVertices[s].y))},m_localCentroid:new b2Vec2,m_localOBB:new b2OBB,m_vertices:null,m_coreVertices:null,m_vertexCount:0,m_normals:null}),i.tempVec=new b2Vec2,i.tAbsR=new b2Mat22},function(t,e){var i=Class.create();Object.extend(i.prototype,b2ShapeDef.prototype),Object.extend(i.prototype,{initialize:function(){this.type=b2Shape.e_unknownShape,this.userData=null,this.localPosition=new b2Vec2(0,0),this.localRotation=0,this.friction=.2,this.restitution=0,this.density=0,this.categoryBits=1,this.maskBits=65535,this.groupIndex=0,this.vertices=new Array(b2Settings.b2_maxPolyVertices),this.type=b2Shape.e_polyShape,this.vertexCount=0;for(var t=0;t<b2Settings.b2_maxPolyVertices;t++)this.vertices[t]=new b2Vec2},vertices:new Array(b2Settings.b2_maxPolyVertices),vertexCount:0})},function(t,e){Class.create().prototype={mass:0,center:new b2Vec2(0,0),I:0,initialize:function(){this.center=new b2Vec2(0,0)}}},function(t,e){var i=Class.create();Object.extend(i.prototype,b2Shape.prototype),Object.extend(i.prototype,{TestPoint:function(t){var e=new b2Vec2;return e.SetV(t),e.Subtract(this.m_position),b2Math.b2Dot(e,e)<=this.m_radius*this.m_radius},initialize:function(t,e,i){this.m_R=new b2Mat22,this.m_position=new b2Vec2,this.m_userData=t.userData,this.m_friction=t.friction,this.m_restitution=t.restitution,this.m_body=e,this.m_proxyId=b2Pair.b2_nullProxy,this.m_maxRadius=0,this.m_categoryBits=t.categoryBits,this.m_maskBits=t.maskBits,this.m_groupIndex=t.groupIndex,this.m_localPosition=new b2Vec2;var n=t;this.m_localPosition.Set(t.localPosition.x-i.x,t.localPosition.y-i.y),this.m_type=b2Shape.e_circleShape,this.m_radius=n.radius,this.m_R.SetM(this.m_body.m_R);var o=this.m_R.col1.x*this.m_localPosition.x+this.m_R.col2.x*this.m_localPosition.y,s=this.m_R.col1.y*this.m_localPosition.x+this.m_R.col2.y*this.m_localPosition.y;this.m_position.x=this.m_body.m_position.x+o,this.m_position.y=this.m_body.m_position.y+s,this.m_maxRadius=Math.sqrt(o*o+s*s)+this.m_radius;var r=new b2AABB;r.minVertex.Set(this.m_position.x-this.m_radius,this.m_position.y-this.m_radius),r.maxVertex.Set(this.m_position.x+this.m_radius,this.m_position.y+this.m_radius);var a=this.m_body.m_world.m_broadPhase;a.InRange(r)?this.m_proxyId=a.CreateProxy(r,this):this.m_proxyId=b2Pair.b2_nullProxy,this.m_proxyId==b2Pair.b2_nullProxy&&this.m_body.Freeze()},Synchronize:function(t,e,i,n){if(this.m_R.SetM(n),this.m_position.x=n.col1.x*this.m_localPosition.x+n.col2.x*this.m_localPosition.y+i.x,this.m_position.y=n.col1.y*this.m_localPosition.x+n.col2.y*this.m_localPosition.y+i.y,this.m_proxyId!=b2Pair.b2_nullProxy){var o=t.x+(e.col1.x*this.m_localPosition.x+e.col2.x*this.m_localPosition.y),s=t.y+(e.col1.y*this.m_localPosition.x+e.col2.y*this.m_localPosition.y),r=Math.min(o,this.m_position.x),a=Math.min(s,this.m_position.y),l=Math.max(o,this.m_position.x),m=Math.max(s,this.m_position.y),c=new b2AABB;c.minVertex.Set(r-this.m_radius,a-this.m_radius),c.maxVertex.Set(l+this.m_radius,m+this.m_radius);var h=this.m_body.m_world.m_broadPhase;h.InRange(c)?h.MoveProxy(this.m_proxyId,c):this.m_body.Freeze()}},QuickSync:function(t,e){this.m_R.SetM(e),this.m_position.x=e.col1.x*this.m_localPosition.x+e.col2.x*this.m_localPosition.y+t.x,this.m_position.y=e.col1.y*this.m_localPosition.x+e.col2.y*this.m_localPosition.y+t.y},ResetProxy:function(t){if(this.m_proxyId!=b2Pair.b2_nullProxy){t.GetProxy(this.m_proxyId);t.DestroyProxy(this.m_proxyId),null;var e=new b2AABB;e.minVertex.Set(this.m_position.x-this.m_radius,this.m_position.y-this.m_radius),e.maxVertex.Set(this.m_position.x+this.m_radius,this.m_position.y+this.m_radius),t.InRange(e)?this.m_proxyId=t.CreateProxy(e,this):this.m_proxyId=b2Pair.b2_nullProxy,this.m_proxyId==b2Pair.b2_nullProxy&&this.m_body.Freeze()}},Support:function(t,e,i){var n=Math.sqrt(t*t+e*e);t/=n,e/=n,i.Set(this.m_position.x+this.m_radius*t,this.m_position.y+this.m_radius*e)},m_localPosition:new b2Vec2,m_radius:null})},function(t,e){var i=Class.create();Object.extend(i.prototype,b2ShapeDef.prototype),Object.extend(i.prototype,{initialize:function(){this.type=b2Shape.e_unknownShape,this.userData=null,this.localPosition=new b2Vec2(0,0),this.localRotation=0,this.friction=.2,this.restitution=0,this.density=0,this.categoryBits=1,this.maskBits=65535,this.groupIndex=0,this.type=b2Shape.e_circleShape,this.radius=1},radius:null})},function(t,e){var i=Class.create();Object.extend(i.prototype,b2ShapeDef.prototype),Object.extend(i.prototype,{initialize:function(){this.type=b2Shape.e_unknownShape,this.userData=null,this.localPosition=new b2Vec2(0,0),this.localRotation=0,this.friction=.2,this.restitution=0,this.density=0,this.categoryBits=1,this.maskBits=65535,this.groupIndex=0,this.type=b2Shape.e_boxShape,this.extents=new b2Vec2(1,1)},extents:null})},function(t,e){Class.create().prototype={set_referenceFace:function(t){this._referenceFace=t,this._m_id._key=4294967040&this._m_id._key|255&this._referenceFace},get_referenceFace:function(){return this._referenceFace},_referenceFace:0,set_incidentEdge:function(t){this._incidentEdge=t,this._m_id._key=4294902015&this._m_id._key|this._incidentEdge<<8&65280},get_incidentEdge:function(){return this._incidentEdge},_incidentEdge:0,set_incidentVertex:function(t){this._incidentVertex=t,this._m_id._key=4278255615&this._m_id._key|this._incidentVertex<<16&16711680},get_incidentVertex:function(){return this._incidentVertex},_incidentVertex:0,set_flip:function(t){this._flip=t,this._m_id._key=16777215&this._m_id._key|this._flip<<24&4278190080},get_flip:function(){return this._flip},_flip:0,_m_id:null,initialize:function(){}}},function(t,e){Class.create().prototype={v:new b2Vec2,id:new b2ContactID,initialize:function(){this.v=new b2Vec2,this.id=new b2ContactID}}},function(t,e){Class.create().prototype={GetNext:function(){return this.lowerBounds[0]},SetNext:function(t){this.lowerBounds[0]=t},IsValid:function(){return this.overlapCount!=b2BroadPhase.b2_invalid},lowerBounds:[0,0],upperBounds:[0,0],overlapCount:0,timeStamp:0,userData:null,initialize:function(){this.lowerBounds=[0,0],this.upperBounds=[0,0]}}},function(t,e){var i=Class.create();i.prototype={initialize:function(){var t=0;for(this.m_hashTable=new Array(b2Pair.b2_tableCapacity),t=0;t<b2Pair.b2_tableCapacity;++t)this.m_hashTable[t]=b2Pair.b2_nullPair;for(this.m_pairs=new Array(b2Settings.b2_maxPairs),t=0;t<b2Settings.b2_maxPairs;++t)this.m_pairs[t]=new b2Pair;for(this.m_pairBuffer=new Array(b2Settings.b2_maxPairs),t=0;t<b2Settings.b2_maxPairs;++t)this.m_pairBuffer[t]=new b2BufferedPair;for(t=0;t<b2Settings.b2_maxPairs;++t)this.m_pairs[t].proxyId1=b2Pair.b2_nullProxy,this.m_pairs[t].proxyId2=b2Pair.b2_nullProxy,this.m_pairs[t].userData=null,this.m_pairs[t].status=0,this.m_pairs[t].next=t+1;this.m_pairs[b2Settings.b2_maxPairs-1].next=b2Pair.b2_nullPair,this.m_pairCount=0},Initialize:function(t,e){this.m_broadPhase=t,this.m_callback=e},AddBufferedPair:function(t,e){var i=this.AddPair(t,e);0==i.IsBuffered()&&(i.SetBuffered(),this.m_pairBuffer[this.m_pairBufferCount].proxyId1=i.proxyId1,this.m_pairBuffer[this.m_pairBufferCount].proxyId2=i.proxyId2,++this.m_pairBufferCount),i.ClearRemoved(),b2BroadPhase.s_validate&&this.ValidateBuffer()},RemoveBufferedPair:function(t,e){var i=this.Find(t,e);null!=i&&(0==i.IsBuffered()&&(i.SetBuffered(),this.m_pairBuffer[this.m_pairBufferCount].proxyId1=i.proxyId1,this.m_pairBuffer[this.m_pairBufferCount].proxyId2=i.proxyId2,++this.m_pairBufferCount),i.SetRemoved(),b2BroadPhase.s_validate&&this.ValidateBuffer())},Commit:function(){var t=0,e=0,i=this.m_broadPhase.m_proxyPool;for(t=0;t<this.m_pairBufferCount;++t){var n=this.Find(this.m_pairBuffer[t].proxyId1,this.m_pairBuffer[t].proxyId2);n.ClearBuffered();var o=i[n.proxyId1],s=i[n.proxyId2];n.IsRemoved()?(1==n.IsFinal()&&this.m_callback.PairRemoved(o.userData,s.userData,n.userData),this.m_pairBuffer[e].proxyId1=n.proxyId1,this.m_pairBuffer[e].proxyId2=n.proxyId2,++e):0==n.IsFinal()&&(n.userData=this.m_callback.PairAdded(o.userData,s.userData),n.SetFinal())}for(t=0;t<e;++t)this.RemovePair(this.m_pairBuffer[t].proxyId1,this.m_pairBuffer[t].proxyId2);this.m_pairBufferCount=0,b2BroadPhase.s_validate&&this.ValidateTable()},AddPair:function(t,e){if(t>e){var n=t;t=e,e=n}var o=i.Hash(t,e)&b2Pair.b2_tableMask,s=s=this.FindHash(t,e,o);if(null!=s)return s;var r=this.m_freePair;return s=this.m_pairs[r],this.m_freePair=s.next,s.proxyId1=t,s.proxyId2=e,s.status=0,s.userData=null,s.next=this.m_hashTable[o],this.m_hashTable[o]=r,++this.m_pairCount,s},RemovePair:function(t,e){if(t>e){var n=t;t=e,e=n}for(var o=i.Hash(t,e)&b2Pair.b2_tableMask,s=this.m_hashTable[o],r=null;s!=b2Pair.b2_nullPair;){if(i.Equals(this.m_pairs[s],t,e)){var a=s;r?r.next=this.m_pairs[s].next:this.m_hashTable[o]=this.m_pairs[s].next;var l=this.m_pairs[a],m=l.userData;return l.next=this.m_freePair,l.proxyId1=b2Pair.b2_nullProxy,l.proxyId2=b2Pair.b2_nullProxy,l.userData=null,l.status=0,this.m_freePair=a,--this.m_pairCount,m}s=(r=this.m_pairs[s]).next}return null},Find:function(t,e){if(t>e){var n=t;t=e,e=n}var o=i.Hash(t,e)&b2Pair.b2_tableMask;return this.FindHash(t,e,o)},FindHash:function(t,e,n){for(var o=this.m_hashTable[n];o!=b2Pair.b2_nullPair&&0==i.Equals(this.m_pairs[o],t,e);)o=this.m_pairs[o].next;return o==b2Pair.b2_nullPair?null:this.m_pairs[o]},ValidateBuffer:function(){},ValidateTable:function(){},m_broadPhase:null,m_callback:null,m_pairs:null,m_freePair:0,m_pairCount:0,m_pairBuffer:null,m_pairBufferCount:0,m_hashTable:null},i.Hash=function(t,e){var i=e<<16&4294901760|t;return i=~i+(i<<15&4294934528),i^=i>>12&1048575,i+=i<<2&4294967292,i^=i>>4&268435455,i*=2057,i^=i>>16&65535},i.Equals=function(t,e,i){return t.proxyId1==e&&t.proxyId2==i},i.EqualsPair=function(t,e){return t.proxyId1==e.proxyId1&&t.proxyId2==e.proxyId2}},function(t,e){Class.create().prototype={PairAdded:function(t,e){return null},PairRemoved:function(t,e,i){},initialize:function(){}}},function(t,e){var i=Class.create();i.prototype={SetBuffered:function(){this.status|=i.e_pairBuffered},ClearBuffered:function(){this.status&=~i.e_pairBuffered},IsBuffered:function(){return(this.status&i.e_pairBuffered)==i.e_pairBuffered},SetRemoved:function(){this.status|=i.e_pairRemoved},ClearRemoved:function(){this.status&=~i.e_pairRemoved},IsRemoved:function(){return(this.status&i.e_pairRemoved)==i.e_pairRemoved},SetFinal:function(){this.status|=i.e_pairFinal},IsFinal:function(){return(this.status&i.e_pairFinal)==i.e_pairFinal},userData:null,proxyId1:0,proxyId2:0,next:0,status:0,initialize:function(){}},i.b2_nullPair=b2Settings.USHRT_MAX,i.b2_nullProxy=b2Settings.USHRT_MAX,i.b2_tableCapacity=b2Settings.b2_maxPairs,i.b2_tableMask=i.b2_tableCapacity-1,i.e_pairBuffered=1,i.e_pairRemoved=2,i.e_pairFinal=4},function(t,e){Class.create().prototype={R:new b2Mat22,center:new b2Vec2,extents:new b2Vec2,initialize:function(){this.R=new b2Mat22,this.center=new b2Vec2,this.extents=new b2Vec2}}},function(t,e){Class.create().prototype={initialize:function(){this.points=new Array(b2Settings.b2_maxManifoldPoints);for(var t=0;t<b2Settings.b2_maxManifoldPoints;t++)this.points[t]=new b2ContactPoint;this.normal=new b2Vec2},points:null,normal:null,pointCount:0}},function(t,e){var i=Class.create();i.prototype={initialize:function(){}},i.ProcessTwo=function(t,e,i,n,o){var s=-o[1].x,r=-o[1].y,a=o[0].x-o[1].x,l=o[0].y-o[1].y,m=Math.sqrt(a*a+l*l),c=s*(a/=m)+r*(l/=m);return c<=0||m<Number.MIN_VALUE?(t.SetV(i[1]),e.SetV(n[1]),i[0].SetV(i[1]),n[0].SetV(n[1]),o[0].SetV(o[1]),1):(c/=m,t.x=i[1].x+c*(i[0].x-i[1].x),t.y=i[1].y+c*(i[0].y-i[1].y),e.x=n[1].x+c*(n[0].x-n[1].x),e.y=n[1].y+c*(n[0].y-n[1].y),2)},i.ProcessThree=function(t,e,i,n,o){var s=o[0].x,r=o[0].y,a=o[1].x,l=o[1].y,m=o[2].x,c=o[2].y,h=a-s,u=l-r,_=m-s,p=c-r,y=m-a,d=c-l,b=-(s*_+r*p),f=m*_+c*p,x=-(a*y+l*d),v=m*y+c*d;if(f<=0&&v<=0)return t.SetV(i[2]),e.SetV(n[2]),i[0].SetV(i[2]),n[0].SetV(n[2]),o[0].SetV(o[2]),1;var g=h*p-u*_,S=g*(s*l-r*a),M=g*(a*c-l*m);if(M<=0&&x>=0&&v>=0){var A=x/(x+v);return t.x=i[1].x+A*(i[2].x-i[1].x),t.y=i[1].y+A*(i[2].y-i[1].y),e.x=n[1].x+A*(n[2].x-n[1].x),e.y=n[1].y+A*(n[2].y-n[1].y),i[0].SetV(i[2]),n[0].SetV(n[2]),o[0].SetV(o[2]),2}var w=g*(m*r-c*s);if(w<=0&&b>=0&&f>=0){A=b/(b+f);return t.x=i[0].x+A*(i[2].x-i[0].x),t.y=i[0].y+A*(i[2].y-i[0].y),e.x=n[0].x+A*(n[2].x-n[0].x),e.y=n[0].y+A*(n[2].y-n[0].y),i[1].SetV(i[2]),n[1].SetV(n[2]),o[1].SetV(o[2]),2}var C=M+w+S,V=M*(C=1/C),I=w*C,P=1-V-I;return t.x=V*i[0].x+I*i[1].x+P*i[2].x,t.y=V*i[0].y+I*i[1].y+P*i[2].y,e.x=V*n[0].x+I*n[1].x+P*n[2].x,e.y=V*n[0].y+I*n[1].y+P*n[2].y,3},i.InPoinsts=function(t,e,i){for(var n=0;n<i;++n)if(t.x==e[n].x&&t.y==e[n].y)return!0;return!1},i.Distance=function(t,e,n,o){var s=new Array(3),r=new Array(3),a=new Array(3),l=0;t.SetV(n.m_position),e.SetV(o.m_position);for(var m=0,c=0;c<20;++c){var h=e.x-t.x,u=e.y-t.y,_=n.Support(h,u),p=o.Support(-h,-u);m=h*h+u*u;var y=p.x-_.x,d=p.y-_.y;if(m-b2Dot(h*y+u*d)<=.01*m)return 0==l&&(t.SetV(_),e.SetV(p)),i.g_GJK_Iterations=c,Math.sqrt(m);switch(l){case 0:s[0].SetV(_),r[0].SetV(p),a[0]=w,t.SetV(s[0]),e.SetV(r[0]),++l;break;case 1:s[1].SetV(_),r[1].SetV(p),a[1].x=y,a[1].y=d,l=i.ProcessTwo(t,e,s,r,a);break;case 2:s[2].SetV(_),r[2].SetV(p),a[2].x=y,a[2].y=d,l=i.ProcessThree(t,e,s,r,a)}if(3==l)return i.g_GJK_Iterations=c,0;for(var b=-Number.MAX_VALUE,f=0;f<l;++f)b=b2Math.b2Max(b,a[f].x*a[f].x+a[f].y*a[f].y);if(3==l||m<=100*Number.MIN_VALUE*b)return i.g_GJK_Iterations=c,Math.sqrt(m)}return i.g_GJK_Iterations=20,Math.sqrt(m)},i.g_GJK_Iterations=0},function(t,e){Class.create().prototype={position:new b2Vec2,separation:null,normalImpulse:null,tangentImpulse:null,id:new b2ContactID,initialize:function(){this.position=new b2Vec2,this.id=new b2ContactID}}},function(t,e){var i=Class.create();i.prototype={initialize:function(){this.features=new Features,this.features._m_id=this},Set:function(t){this.set_key(t._key)},Copy:function(){var t=new i;return t.set_key(this._key),t},get_key:function(){return this._key},set_key:function(t){this._key=t,this.features._referenceFace=255&this._key,this.features._incidentEdge=(65280&this._key)>>8&255,this.features._incidentVertex=(16711680&this._key)>>16&255,this.features._flip=(4278190080&this._key)>>24&255},features:new Features,_key:0}},function(t,e){var i=Class.create();i.prototype={initialize:function(){}},i.b2_nullFeature=255,i.ClipSegmentToLine=function(t,e,i,n){var o=0,s=e[0].v,r=e[1].v,a=b2Math.b2Dot(i,e[0].v)-n,l=b2Math.b2Dot(i,e[1].v)-n;if(a<=0&&(t[o++]=e[0]),l<=0&&(t[o++]=e[1]),a*l<0){var m=a/(a-l),c=t[o].v;c.x=s.x+m*(r.x-s.x),c.y=s.y+m*(r.y-s.y),t[o].id=a>0?e[0].id:e[1].id,++o}return o},i.EdgeSeparation=function(t,e,i){var n=t.m_vertices,o=i.m_vertexCount,s=i.m_vertices,r=t.m_normals[e].x,a=t.m_normals[e].y,l=r,m=t.m_R,c=r=m.col1.x*l+m.col2.x*a,h=a=m.col1.y*l+m.col2.y*a;l=c*(m=i.m_R).col1.x+h*m.col1.y,h=c*m.col2.x+h*m.col2.y,c=l;for(var u=0,_=Number.MAX_VALUE,p=0;p<o;++p){var y=s[p],d=y.x*c+y.y*h;d<_&&(_=d,u=p)}m=t.m_R;var b=t.m_position.x+(m.col1.x*n[e].x+m.col2.x*n[e].y),f=t.m_position.y+(m.col1.y*n[e].x+m.col2.y*n[e].y);m=i.m_R;var x=i.m_position.x+(m.col1.x*s[u].x+m.col2.x*s[u].y),v=i.m_position.y+(m.col1.y*s[u].x+m.col2.y*s[u].y);return(x-=b)*r+(v-=f)*a},i.FindMaxSeparation=function(t,e,n,o){for(var s=e.m_vertexCount,r=n.m_position.x-e.m_position.x,a=n.m_position.y-e.m_position.y,l=r*e.m_R.col1.x+a*e.m_R.col1.y,m=r*e.m_R.col2.x+a*e.m_R.col2.y,c=0,h=-Number.MAX_VALUE,u=0;u<s;++u){var _=e.m_normals[u].x*l+e.m_normals[u].y*m;_>h&&(h=_,c=u)}var p=i.EdgeSeparation(e,c,n);if(p>0&&0==o)return p;var y=c-1>=0?c-1:s-1,d=i.EdgeSeparation(e,y,n);if(d>0&&0==o)return d;var b=c+1<s?c+1:0,f=i.EdgeSeparation(e,b,n);if(f>0&&0==o)return f;var x,v=0,g=0;if(d>p&&d>f)g=-1,v=y,x=d;else{if(!(f>p))return t[0]=c,p;g=1,v=b,x=f}for(;;){if(c=-1==g?v-1>=0?v-1:s-1:v+1<s?v+1:0,(p=i.EdgeSeparation(e,c,n))>0&&0==o)return p;if(!(p>x))break;v=c,x=p}return t[0]=v,x},i.FindIncidentEdge=function(t,e,i,n){var o=e.m_vertexCount,s=e.m_vertices,r=n.m_vertexCount,a=n.m_vertices,l=i,m=s[i+1==o?0:i+1],c=m.x,h=m.y,u=c-=(m=s[l]).x;c=h-=m.y,h=-u;var _=1/Math.sqrt(c*c+h*h),p=c*=_,y=h*=_;u=p;var d=e.m_R,b=p=d.col1.x*u+d.col2.x*y,f=y=d.col1.y*u+d.col2.y*y;u=b*(d=n.m_R).col1.x+f*d.col1.y,f=b*d.col2.x+f*d.col2.y,b=u;for(var x,v=0,g=0,S=Number.MAX_VALUE,M=0;M<r;++M){var A=M,w=M+1<r?M+1:0,C=(m=a[w]).x,V=m.y;u=C-=(m=a[A]).x,C=V-=m.y,V=-u;var I=(C*=_=1/Math.sqrt(C*C+V*V))*b+(V*=_)*f;I<S&&(S=I,v=A,g=w)}(m=(x=t[0]).v).SetV(a[v]),m.MulM(n.m_R),m.Add(n.m_position),x.id.features.referenceFace=i,x.id.features.incidentEdge=v,x.id.features.incidentVertex=v,(m=(x=t[1]).v).SetV(a[g]),m.MulM(n.m_R),m.Add(n.m_position),x.id.features.referenceFace=i,x.id.features.incidentEdge=v,x.id.features.incidentVertex=g},i.b2CollidePolyTempVec=new b2Vec2,i.b2CollidePoly=function(t,e,n,o){t.pointCount=0;var s=0,r=[s],a=i.FindMaxSeparation(r,e,n,o);if(s=r[0],!(a>0&&0==o)){var l=0,m=[l],c=i.FindMaxSeparation(m,n,e,o);if(l=m[0],!(c>0&&0==o)){var h,u,_=0,p=0;c>.98*a+.001?(h=n,u=e,_=l,p=1):(h=e,u=n,_=s,p=0);var y=[new ClipVertex,new ClipVertex];i.FindIncidentEdge(y,h,_,u);var d=h.m_vertexCount,b=h.m_vertices,f=b[_],x=_+1<d?b[_+1]:b[0],v=(x.x,f.x,x.y,f.y,x.x-f.x),g=x.y-f.y,S=v,M=h.m_R;v=M.col1.x*S+M.col2.x*g,g=M.col1.y*S+M.col2.y*g;var A=1/Math.sqrt(v*v+g*g),w=v*=A,C=g*=A;S=w,w=C,C=-S;var V=f.x,I=f.y;S=V,V=(M=h.m_R).col1.x*S+M.col2.x*I,I=M.col1.y*S+M.col2.y*I,V+=h.m_position.x,I+=h.m_position.y;var P=x.x,E=x.y;S=P,P=(M=h.m_R).col1.x*S+M.col2.x*E,E=M.col1.y*S+M.col2.y*E;var B=w*V+C*I,O=-(v*V+g*I),R=v*(P+=h.m_position.x)+g*(E+=h.m_position.y),T=[new ClipVertex,new ClipVertex],L=[new ClipVertex,new ClipVertex];if(i.b2CollidePolyTempVec.Set(-v,-g),!(i.ClipSegmentToLine(T,y,i.b2CollidePolyTempVec,O)<2||(i.b2CollidePolyTempVec.Set(v,g),i.ClipSegmentToLine(L,T,i.b2CollidePolyTempVec,R)<2))){p?t.normal.Set(-w,-C):t.normal.Set(w,C);for(var j=0,N=0;N<b2Settings.b2_maxManifoldPoints;++N){var F=L[N].v,J=w*F.x+C*F.y-B;if(J<=0||1==o){var D=t.points[j];D.separation=J,D.position.SetV(L[N].v),D.id.Set(L[N].id),D.id.features.flip=p,++j}}t.pointCount=j}}}},i.b2CollideCircle=function(t,e,i,n){t.pointCount=0;var o=i.m_position.x-e.m_position.x,s=i.m_position.y-e.m_position.y,r=o*o+s*s,a=e.m_radius+i.m_radius;if(!(r>a*a&&0==n)){var l;if(r<Number.MIN_VALUE)l=-a,t.normal.Set(0,1);else{var m=Math.sqrt(r);l=m-a;var c=1/m;t.normal.x=c*o,t.normal.y=c*s}t.pointCount=1;var h=t.points[0];h.id.set_key(0),h.separation=l,h.position.x=i.m_position.x-i.m_radius*t.normal.x,h.position.y=i.m_position.y-i.m_radius*t.normal.y}},i.b2CollidePolyAndCircle=function(t,e,n,o){var s,r,a;t.pointCount=0;var l,m=n.m_position.x-e.m_position.x,c=n.m_position.y-e.m_position.y,h=e.m_R,u=m*h.col1.x+c*h.col1.y;c=m*h.col2.x+c*h.col2.y,m=u;for(var _=0,p=-Number.MAX_VALUE,y=n.m_radius,d=0;d<e.m_vertexCount;++d){var b=e.m_normals[d].x*(m-e.m_vertices[d].x)+e.m_normals[d].y*(c-e.m_vertices[d].y);if(b>y)return;b>p&&(p=b,_=d)}if(p<Number.MIN_VALUE){t.pointCount=1;var f=e.m_normals[_];return t.normal.x=h.col1.x*f.x+h.col2.x*f.y,t.normal.y=h.col1.y*f.x+h.col2.y*f.y,(s=t.points[0]).id.features.incidentEdge=_,s.id.features.incidentVertex=i.b2_nullFeature,s.id.features.referenceFace=i.b2_nullFeature,s.id.features.flip=0,s.position.x=n.m_position.x-y*t.normal.x,s.position.y=n.m_position.y-y*t.normal.y,void(s.separation=p-y)}var x=_,v=x+1<e.m_vertexCount?x+1:0,g=e.m_vertices[v].x-e.m_vertices[x].x,S=e.m_vertices[v].y-e.m_vertices[x].y,M=Math.sqrt(g*g+S*S);if(g/=M,S/=M,M<Number.MIN_VALUE){if(r=m-e.m_vertices[x].x,a=c-e.m_vertices[x].y,r/=l=Math.sqrt(r*r+a*a),a/=l,l>y)return;return t.pointCount=1,t.normal.Set(h.col1.x*r+h.col2.x*a,h.col1.y*r+h.col2.y*a),(s=t.points[0]).id.features.incidentEdge=i.b2_nullFeature,s.id.features.incidentVertex=x,s.id.features.referenceFace=i.b2_nullFeature,s.id.features.flip=0,s.position.x=n.m_position.x-y*t.normal.x,s.position.y=n.m_position.y-y*t.normal.y,void(s.separation=l-y)}var A,w,C=(m-e.m_vertices[x].x)*g+(c-e.m_vertices[x].y)*S;(s=t.points[0]).id.features.incidentEdge=i.b2_nullFeature,s.id.features.incidentVertex=i.b2_nullFeature,s.id.features.referenceFace=i.b2_nullFeature,s.id.features.flip=0,C<=0?(A=e.m_vertices[x].x,w=e.m_vertices[x].y,s.id.features.incidentVertex=x):C>=M?(A=e.m_vertices[v].x,w=e.m_vertices[v].y,s.id.features.incidentVertex=v):(A=g*C+e.m_vertices[x].x,w=S*C+e.m_vertices[x].y,s.id.features.incidentEdge=x),r=m-A,a=c-w,r/=l=Math.sqrt(r*r+a*a),a/=l,l>y||(t.pointCount=1,t.normal.Set(h.col1.x*r+h.col2.x*a,h.col1.y*r+h.col2.y*a),s.position.x=n.m_position.x-y*t.normal.x,s.position.y=n.m_position.y-y*t.normal.y,s.separation=l-y)},i.b2TestOverlap=function(t,e){var i=e.minVertex,n=t.maxVertex,o=i.x-n.x,s=i.y-n.y;i=t.minVertex,n=e.maxVertex;var r=i.x-n.x,a=i.y-n.y;return!(o>0||s>0)&&!(r>0||a>0)}},function(t,e){Class.create().prototype={proxyId1:0,proxyId2:0,initialize:function(){}}},function(t,e){var i=Class.create();i.prototype={initialize:function(t,e){this.m_pairManager=new b2PairManager,this.m_proxyPool=new Array(b2Settings.b2_maxPairs),this.m_bounds=new Array(2*b2Settings.b2_maxProxies),this.m_queryResults=new Array(b2Settings.b2_maxProxies),this.m_quantizationFactor=new b2Vec2;var n=0;for(this.m_pairManager.Initialize(this,e),this.m_worldAABB=t,this.m_proxyCount=0,n=0;n<b2Settings.b2_maxProxies;n++)this.m_queryResults[n]=0;for(this.m_bounds=new Array(2),n=0;n<2;n++){this.m_bounds[n]=new Array(2*b2Settings.b2_maxProxies);for(var o=0;o<2*b2Settings.b2_maxProxies;o++)this.m_bounds[n][o]=new b2Bound}var s,r=t.maxVertex.x,a=t.maxVertex.y;for(r-=t.minVertex.x,a-=t.minVertex.y,this.m_quantizationFactor.x=b2Settings.USHRT_MAX/r,this.m_quantizationFactor.y=b2Settings.USHRT_MAX/a,n=0;n<b2Settings.b2_maxProxies-1;++n)s=new b2Proxy,this.m_proxyPool[n]=s,s.SetNext(n+1),s.timeStamp=0,s.overlapCount=i.b2_invalid,s.userData=null;s=new b2Proxy,this.m_proxyPool[b2Settings.b2_maxProxies-1]=s,s.SetNext(b2Pair.b2_nullProxy),s.timeStamp=0,s.overlapCount=i.b2_invalid,s.userData=null,this.m_freeProxy=0,this.m_timeStamp=1,this.m_queryResultCount=0},InRange:function(t){var e,i,n,o;return e=t.minVertex.x,i=t.minVertex.y,e-=this.m_worldAABB.maxVertex.x,i-=this.m_worldAABB.maxVertex.y,n=this.m_worldAABB.minVertex.x,o=this.m_worldAABB.minVertex.y,n-=t.maxVertex.x,o-=t.maxVertex.y,e=b2Math.b2Max(e,n),i=b2Math.b2Max(i,o),b2Math.b2Max(e,i)<0},GetProxy:function(t){return t==b2Pair.b2_nullProxy||0==this.m_proxyPool[t].IsValid()?null:this.m_proxyPool[t]},CreateProxy:function(t,e){var i,n=0,o=this.m_freeProxy;i=this.m_proxyPool[o],this.m_freeProxy=i.GetNext(),i.overlapCount=0,i.userData=e;var s=2*this.m_proxyCount,r=new Array,a=new Array;this.ComputeBounds(r,a,t);for(var l=0;l<2;++l){var m=this.m_bounds[l],c=0,h=0,u=[c],_=[h];this.Query(u,_,r[l],a[l],m,s,l),c=u[0],h=_[0];var p,y,d=new Array,b=0,f=s-h;for(b=0;b<f;b++)d[b]=new b2Bound,p=d[b],y=m[h+b],p.value=y.value,p.proxyId=y.proxyId,p.stabbingCount=y.stabbingCount;f=d.length;var x=h+2;for(b=0;b<f;b++)y=d[b],(p=m[x+b]).value=y.value,p.proxyId=y.proxyId,p.stabbingCount=y.stabbingCount;for(d=new Array,f=h-c,b=0;b<f;b++)d[b]=new b2Bound,p=d[b],y=m[c+b],p.value=y.value,p.proxyId=y.proxyId,p.stabbingCount=y.stabbingCount;for(f=d.length,x=c+1,b=0;b<f;b++)y=d[b],(p=m[x+b]).value=y.value,p.proxyId=y.proxyId,p.stabbingCount=y.stabbingCount;for(++h,m[c].value=r[l],m[c].proxyId=o,m[h].value=a[l],m[h].proxyId=o,m[c].stabbingCount=0==c?0:m[c-1].stabbingCount,m[h].stabbingCount=m[h-1].stabbingCount,n=c;n<h;++n)m[n].stabbingCount++;for(n=c;n<s+2;++n){var v=this.m_proxyPool[m[n].proxyId];m[n].IsLower()?v.lowerBounds[l]=n:v.upperBounds[l]=n}}++this.m_proxyCount;for(var g=0;g<this.m_queryResultCount;++g)this.m_pairManager.AddBufferedPair(o,this.m_queryResults[g]);return this.m_pairManager.Commit(),this.m_queryResultCount=0,this.IncrementTimeStamp(),o},DestroyProxy:function(t){for(var e=this.m_proxyPool[t],n=2*this.m_proxyCount,o=0;o<2;++o){var s,r,a=this.m_bounds[o],l=e.lowerBounds[o],m=e.upperBounds[o],c=a[l].value,h=a[m].value,u=new Array,_=0,p=m-l-1;for(_=0;_<p;_++)u[_]=new b2Bound,s=u[_],r=a[l+1+_],s.value=r.value,s.proxyId=r.proxyId,s.stabbingCount=r.stabbingCount;p=u.length;var y=l;for(_=0;_<p;_++)r=u[_],(s=a[y+_]).value=r.value,s.proxyId=r.proxyId,s.stabbingCount=r.stabbingCount;for(u=new Array,p=n-m-1,_=0;_<p;_++)u[_]=new b2Bound,s=u[_],r=a[m+1+_],s.value=r.value,s.proxyId=r.proxyId,s.stabbingCount=r.stabbingCount;for(p=u.length,y=m-1,_=0;_<p;_++)r=u[_],(s=a[y+_]).value=r.value,s.proxyId=r.proxyId,s.stabbingCount=r.stabbingCount;p=n-2;for(var d=l;d<p;++d){var b=this.m_proxyPool[a[d].proxyId];a[d].IsLower()?b.lowerBounds[o]=d:b.upperBounds[o]=d}p=m-1;for(var f=l;f<p;++f)a[f].stabbingCount--;this.Query([0],[0],c,h,a,n-2,o)}for(var x=0;x<this.m_queryResultCount;++x)this.m_pairManager.RemoveBufferedPair(t,this.m_queryResults[x]);this.m_pairManager.Commit(),this.m_queryResultCount=0,this.IncrementTimeStamp(),e.userData=null,e.overlapCount=i.b2_invalid,e.lowerBounds[0]=i.b2_invalid,e.lowerBounds[1]=i.b2_invalid,e.upperBounds[0]=i.b2_invalid,e.upperBounds[1]=i.b2_invalid,e.SetNext(this.m_freeProxy),this.m_freeProxy=t,--this.m_proxyCount},MoveProxy:function(t,e){var i,n,o,s,r=0,a=0,l=0;if(!(t==b2Pair.b2_nullProxy||b2Settings.b2_maxProxies<=t)&&0!=e.IsValid()){var m=2*this.m_proxyCount,c=this.m_proxyPool[t],h=new b2BoundValues;this.ComputeBounds(h.lowerValues,h.upperValues,e);var u=new b2BoundValues;for(r=0;r<2;++r)u.lowerValues[r]=this.m_bounds[r][c.lowerBounds[r]].value,u.upperValues[r]=this.m_bounds[r][c.upperBounds[r]].value;for(r=0;r<2;++r){var _=this.m_bounds[r],p=c.lowerBounds[r],y=c.upperBounds[r],d=h.lowerValues[r],b=h.upperValues[r],f=d-_[p].value,x=b-_[y].value;if(_[p].value=d,_[y].value=b,f<0)for(a=p;a>0&&d<_[a-1].value;){i=_[a];var v=(n=_[a-1]).proxyId,g=this.m_proxyPool[n.proxyId];n.stabbingCount++,1==n.IsUpper()?(this.TestOverlap(h,g)&&this.m_pairManager.AddBufferedPair(t,v),g.upperBounds[r]++,i.stabbingCount++):(g.lowerBounds[r]++,i.stabbingCount--),c.lowerBounds[r]--,i.Swap(n),--a}if(x>0)for(a=y;a<m-1&&_[a+1].value<=b;)i=_[a],l=(o=_[a+1]).proxyId,s=this.m_proxyPool[l],o.stabbingCount++,1==o.IsLower()?(this.TestOverlap(h,s)&&this.m_pairManager.AddBufferedPair(t,l),s.lowerBounds[r]--,i.stabbingCount++):(s.upperBounds[r]--,i.stabbingCount--),c.upperBounds[r]++,i.Swap(o),a++;if(f>0)for(a=p;a<m-1&&_[a+1].value<=d;)i=_[a],l=(o=_[a+1]).proxyId,s=this.m_proxyPool[l],o.stabbingCount--,o.IsUpper()?(this.TestOverlap(u,s)&&this.m_pairManager.RemoveBufferedPair(t,l),s.upperBounds[r]--,i.stabbingCount--):(s.lowerBounds[r]--,i.stabbingCount++),c.lowerBounds[r]++,i.Swap(o),a++;if(x<0)for(a=y;a>0&&b<_[a-1].value;)i=_[a],v=(n=_[a-1]).proxyId,g=this.m_proxyPool[v],n.stabbingCount--,1==n.IsLower()?(this.TestOverlap(u,g)&&this.m_pairManager.RemoveBufferedPair(t,v),g.lowerBounds[r]++,i.stabbingCount--):(g.upperBounds[r]++,i.stabbingCount++),c.upperBounds[r]--,i.Swap(n),a--}}},Commit:function(){this.m_pairManager.Commit()},QueryAABB:function(t,e,i){var n=new Array,o=new Array;this.ComputeBounds(n,o,t);var s=[0],r=[0];this.Query(s,r,n[0],o[0],this.m_bounds[0],2*this.m_proxyCount,0),this.Query(s,r,n[1],o[1],this.m_bounds[1],2*this.m_proxyCount,1);for(var a=0,l=0;l<this.m_queryResultCount&&a<i;++l,++a){var m=this.m_proxyPool[this.m_queryResults[l]];e[l]=m.userData}return this.m_queryResultCount=0,this.IncrementTimeStamp(),a},Validate:function(){for(var t=0;t<2;++t)for(var e=this.m_bounds[t],i=2*this.m_proxyCount,n=0;n<i;++n){1==e[n].IsLower()?0:0}},ComputeBounds:function(t,e,i){var n=i.minVertex.x,o=i.minVertex.y;n=b2Math.b2Min(n,this.m_worldAABB.maxVertex.x),o=b2Math.b2Min(o,this.m_worldAABB.maxVertex.y),n=b2Math.b2Max(n,this.m_worldAABB.minVertex.x),o=b2Math.b2Max(o,this.m_worldAABB.minVertex.y);var s=i.maxVertex.x,r=i.maxVertex.y;s=b2Math.b2Min(s,this.m_worldAABB.maxVertex.x),r=b2Math.b2Min(r,this.m_worldAABB.maxVertex.y),s=b2Math.b2Max(s,this.m_worldAABB.minVertex.x),r=b2Math.b2Max(r,this.m_worldAABB.minVertex.y),t[0]=this.m_quantizationFactor.x*(n-this.m_worldAABB.minVertex.x)&b2Settings.USHRT_MAX-1,e[0]=this.m_quantizationFactor.x*(s-this.m_worldAABB.minVertex.x)&65535|1,t[1]=this.m_quantizationFactor.y*(o-this.m_worldAABB.minVertex.y)&b2Settings.USHRT_MAX-1,e[1]=this.m_quantizationFactor.y*(r-this.m_worldAABB.minVertex.y)&65535|1},TestOverlapValidate:function(t,e){for(var i=0;i<2;++i){var n=this.m_bounds[i];if(n[t.lowerBounds[i]].value>n[e.upperBounds[i]].value)return!1;if(n[t.upperBounds[i]].value<n[e.lowerBounds[i]].value)return!1}return!0},TestOverlap:function(t,e){for(var i=0;i<2;++i){var n=this.m_bounds[i];if(t.lowerValues[i]>n[e.upperBounds[i]].value)return!1;if(t.upperValues[i]<n[e.lowerBounds[i]].value)return!1}return!0},Query:function(t,e,n,o,s,r,a){for(var l=i.BinarySearch(s,r,n),m=i.BinarySearch(s,r,o),c=l;c<m;++c)s[c].IsLower()&&this.IncrementOverlapCount(s[c].proxyId);if(l>0)for(var h=l-1,u=s[h].stabbingCount;u;){if(s[h].IsLower())l<=this.m_proxyPool[s[h].proxyId].upperBounds[a]&&(this.IncrementOverlapCount(s[h].proxyId),--u);--h}t[0]=l,e[0]=m},IncrementOverlapCount:function(t){var e=this.m_proxyPool[t];e.timeStamp<this.m_timeStamp?(e.timeStamp=this.m_timeStamp,e.overlapCount=1):(e.overlapCount=2,this.m_queryResults[this.m_queryResultCount]=t,++this.m_queryResultCount)},IncrementTimeStamp:function(){if(this.m_timeStamp==b2Settings.USHRT_MAX){for(var t=0;t<b2Settings.b2_maxProxies;++t)this.m_proxyPool[t].timeStamp=0;this.m_timeStamp=1}else++this.m_timeStamp},m_pairManager:new b2PairManager,m_proxyPool:new Array(b2Settings.b2_maxPairs),m_freeProxy:0,m_bounds:new Array(2*b2Settings.b2_maxProxies),m_queryResults:new Array(b2Settings.b2_maxProxies),m_queryResultCount:0,m_worldAABB:null,m_quantizationFactor:new b2Vec2,m_proxyCount:0,m_timeStamp:0},i.s_validate=!1,i.b2_invalid=b2Settings.USHRT_MAX,i.b2_nullEdge=b2Settings.USHRT_MAX,i.BinarySearch=function(t,e,i){for(var n=0,o=e-1;n<=o;){var s=Math.floor((n+o)/2);if(t[s].value>i)o=s-1;else{if(!(t[s].value<i))return s;n=s+1}}return n}},function(t,e){Class.create().prototype={lowerValues:[0,0],upperValues:[0,0],initialize:function(){this.lowerValues=[0,0],this.upperValues=[0,0]}}},function(t,e){Class.create().prototype={IsLower:function(){return 0==(1&this.value)},IsUpper:function(){return 1==(1&this.value)},Swap:function(t){var e=this.value,i=this.proxyId,n=this.stabbingCount;this.value=t.value,this.proxyId=t.proxyId,this.stabbingCount=t.stabbingCount,t.value=e,t.proxyId=i,t.stabbingCount=n},value:0,proxyId:0,stabbingCount:0,initialize:function(){}}},function(t,e){Class.create().prototype={IsValid:function(){var t=this.maxVertex.x,e=this.maxVertex.y;t=this.maxVertex.x,e=this.maxVertex.y,t-=this.minVertex.x,e-=this.minVertex.y;var i=t>=0&&e>=0;return i=i&&this.minVertex.IsValid()&&this.maxVertex.IsValid()},minVertex:new b2Vec2,maxVertex:new b2Vec2,initialize:function(){this.minVertex=new b2Vec2,this.maxVertex=new b2Vec2}}},function(t,e,i){i(81),i(80),i(79),i(78),i(77),i(76),i(75),i(74),i(73),i(72),i(71),i(70),i(69),i(68),i(67),i(66),i(65),i(64),i(63),i(62),i(61),i(60),i(59),i(58),i(57),i(56),i(55),i(54),i(53),i(52),i(51),i(50),i(49),i(48),i(47),i(46),i(45),i(44),i(43),i(42),i(41),i(40),i(39),i(38),i(37),i(36),i(35),i(34),i(33),i(32),i(31),i(30),i(29),i(28),i(27),i(26),i(25),i(24),i(23),i(22),i(21),i(20),i(19),i(18),t.exports=i(17)}]);